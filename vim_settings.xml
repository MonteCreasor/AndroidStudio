<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks>
      <mark key="P" line="66" column="0" filename="$USER_HOME$/doug/WebCrawler/image-crawler/src/main/java/edu/vanderbilt/crawlers/framework/ImageCrawlerBase.java" protocol="file" />
      <mark key="R" line="64" column="8" filename="$USER_HOME$/40au/examples/MyApp/app/src/main/java/apps/monte/myapplication/LineView.java" protocol="file" />
      <mark key="T" line="953" column="16" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/io.apptik.widget/multislider/1.3/783ba5d8cd73e829ff38c9b35d35f4599f8938a5/multislider-1.3-sources.jar!/io/apptik/widget/MultiSlider.java" protocol="file" />
      <mark key="J" line="300" column="0" filename="$USER_HOME$/mooc2/downloader/app/src/main/java/vandy/mooc/assignments/framework/utils/UriUtils.java" protocol="file" />
    </globalmarks>
    <filemarks>
      <file name="$USER_HOME$/android/samples/architecture/u2020/src/internalDebug/res/values/debug_styles.xml" timestamp="1529901631740">
        <mark key="[" line="12" column="0" />
        <mark key="]" line="12" column="74" />
        <mark key="." line="18" column="0" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/settings/SettingsActivity.kt" timestamp="1529889445165">
        <mark key="[" line="7" column="0" />
        <mark key="]" line="7" column="0" />
        <mark key="." line="7" column="0" />
      </file>
      <file name="$USER_HOME$/android/samples/architecture/u2020/src/main/res/values/styles.xml" timestamp="1529892023084" />
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/data/ApiEndpoint.kt" timestamp="1529809537200">
        <mark key="[" line="13" column="0" />
        <mark key="]" line="13" column="0" />
        <mark key="." line="13" column="0" />
        <mark key="^" line="12" column="15" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/DebugMainActivity.kt" timestamp="1529901498833">
        <mark key="[" line="21" column="0" />
        <mark key="]" line="21" column="0" />
        <mark key="." line="21" column="0" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/res/layout/settings_dialog_fragment.xml" timestamp="1529892411128">
        <mark key="a" line="85" column="5" />
        <mark key="'" line="73" column="4" />
        <mark key="[" line="72" column="0" />
        <mark key="]" line="72" column="42" />
        <mark key="^" line="148" column="41" />
        <mark key="." line="72" column="0" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/res/values/styles.xml" timestamp="1529891753278">
        <mark key="[" line="21" column="0" />
        <mark key="]" line="21" column="0" />
        <mark key="^" line="16" column="77" />
        <mark key="." line="21" column="0" />
      </file>
      <file name="/fragment.kt" timestamp="1529700074852">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainActivity.kt" timestamp="1529893614022">
        <mark key="[" line="123" column="39" />
        <mark key="]" line="123" column="39" />
        <mark key="." line="123" column="39" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/forms/ListAdapter.kt" timestamp="1529893646582">
        <mark key="[" line="38" column="45" />
        <mark key="]" line="38" column="45" />
        <mark key="." line="38" column="45" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/res/values/colors.xml" timestamp="1529891855966">
        <mark key="[" line="4" column="17" />
        <mark key="]" line="4" column="16" />
        <mark key="^" line="4" column="16" />
        <mark key="." line="4" column="16" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/alerts/CheckBoxAlert.kt" timestamp="1529860053409">
        <mark key="[" line="36" column="32" />
        <mark key="]" line="36" column="32" />
        <mark key="^" line="28" column="31" />
        <mark key="." line="36" column="32" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/res/values/colors.xml" timestamp="1529891846532">
        <mark key="[" line="1" column="0" />
        <mark key="]" line="1" column="0" />
        <mark key="." line="1" column="0" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/App.kt" timestamp="1529823711498">
        <mark key="[" line="13" column="34" />
        <mark key="]" line="13" column="34" />
        <mark key="^" line="13" column="16" />
        <mark key="." line="13" column="34" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/res/values/styles.xml" timestamp="1529901703706">
        <mark key="[" line="53" column="0" />
        <mark key="]" line="53" column="0" />
        <mark key="." line="53" column="0" />
        <mark key="^" line="37" column="56" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/BindingAdapter.kt" timestamp="1529877284443">
        <mark key="a" line="31" column="6" />
        <mark key="'" line="23" column="11" />
        <mark key="[" line="29" column="0" />
        <mark key="]" line="29" column="62" />
        <mark key="^" line="47" column="8" />
        <mark key="." line="47" column="8" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/Prefs.kt" timestamp="1529868032738">
        <mark key="[" line="150" column="25" />
        <mark key="]" line="150" column="43" />
        <mark key="^" line="150" column="43" />
        <mark key="." line="150" column="43" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/NetworkVarianceAdapter.kt" timestamp="1529886849695">
        <mark key="[" line="8" column="37" />
        <mark key="]" line="8" column="37" />
        <mark key="^" line="8" column="36" />
        <mark key="." line="8" column="37" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/camera/CameraFragment.kt" timestamp="1529893699926">
        <mark key="[" line="18" column="28" />
        <mark key="]" line="18" column="28" />
        <mark key="." line="18" column="28" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/SpinnerAdapter.kt" timestamp="1529886537138">
        <mark key="[" line="41" column="18" />
        <mark key="]" line="41" column="18" />
        <mark key="^" line="41" column="18" />
        <mark key="." line="41" column="18" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/EnumSpinnerAdapter.kt" timestamp="1529872373376">
        <mark key="[" line="34" column="0" />
        <mark key="]" line="36" column="0" />
        <mark key="^" line="46" column="56" />
        <mark key="." line="34" column="0" />
      </file>
      <file name="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" timestamp="1529900835143">
        <mark key="'" line="47" column="7" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" timestamp="1529901216759">
        <mark key="a" line="208" column="20" />
        <mark key="'" line="79" column="56" />
        <mark key="[" line="45" column="8" />
        <mark key="]" line="45" column="8" />
        <mark key="." line="45" column="37" />
        <mark key="^" line="45" column="62" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/LoggingLevelAdapter.kt" timestamp="1529892590554">
        <mark key="[" line="34" column="19" />
        <mark key="]" line="34" column="20" />
        <mark key="^" line="34" column="22" />
        <mark key="." line="34" column="19" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/DebugSettings.kt" timestamp="1529817480762">
        <mark key="[" line="124" column="27" />
        <mark key="]" line="124" column="28" />
        <mark key="^" line="124" column="26" />
        <mark key="." line="124" column="28" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/DrawerLayout.java" timestamp="1529900853520">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="0" />
        <mark key="." line="0" column="0" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/forms/FormsFragment.kt" timestamp="1529893658399">
        <mark key="[" line="64" column="40" />
        <mark key="]" line="64" column="40" />
        <mark key="." line="64" column="40" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/NetworkDelayAdapter.kt" timestamp="1529886965553">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="3" column="0" />
        <mark key="^" line="7" column="28" />
        <mark key="." line="3" column="0" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/model/db/Device.kt" timestamp="1529806209838">
        <mark key="[" line="6" column="0" />
        <mark key="]" line="6" column="0" />
        <mark key="." line="6" column="0" />
        <mark key="^" line="5" column="39" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/common/Prefs.kt" timestamp="1529859986198">
        <mark key="[" line="147" column="4" />
        <mark key="]" line="147" column="12" />
        <mark key="." line="147" column="12" />
        <mark key="^" line="147" column="12" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/StringResSpinnerAdapter.kt" timestamp="1529885178332">
        <mark key="[" line="8" column="0" />
        <mark key="]" line="8" column="0" />
        <mark key="^" line="5" column="29" />
        <mark key="." line="8" column="0" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/StringSpinnerAdapter.kt" timestamp="1529872672711">
        <mark key="[" line="30" column="5" />
        <mark key="]" line="31" column="3" />
        <mark key="^" line="31" column="3" />
        <mark key="." line="31" column="3" />
      </file>
      <file name="$USER_HOME$/android/samples/architecture/u2020/src/main/res/values/colors.xml" timestamp="1529891597100">
        <mark key="a" line="4" column="15" />
        <mark key="[" line="4" column="0" />
        <mark key="]" line="6" column="54" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/NonConsumingScrimInsetsFrameLayout.kt" timestamp="1529901028641">
        <mark key="[" line="60" column="0" />
        <mark key="]" line="60" column="32" />
        <mark key="^" line="60" column="12" />
        <mark key="." line="60" column="0" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/form/FormFragment.kt" timestamp="1529889233326">
        <mark key="[" line="254" column="15" />
        <mark key="]" line="254" column="15" />
        <mark key="^" line="254" column="19" />
        <mark key="." line="254" column="15" />
      </file>
      <file name="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/AnimationSpeedAdapter.kt" timestamp="1529872252272">
        <mark key="[" line="20" column="93" />
        <mark key="]" line="20" column="94" />
        <mark key="." line="20" column="94" />
        <mark key="^" line="20" column="94" />
      </file>
      <file name="/fragment.java" timestamp="1529900571466">
        <mark key="[" line="0" column="0" />
      </file>
    </filemarks>
    <jumps>
      <jump line="34" column="42" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="110" column="53" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="36" column="0" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="176" column="9" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="177" column="80" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="13" column="25" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="193" column="95" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="53" column="40" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="162" column="4" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="50" column="37" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="52" column="19" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="180" column="69" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="181" column="70" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="182" column="65" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="184" column="70" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="187" column="9" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="188" column="64" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="189" column="67" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="190" column="76" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="191" column="79" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="192" column="85" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="232" column="54" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="83" column="0" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="142" column="47" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="51" column="45" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="178" column="62" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="183" column="8" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="143" column="0" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="172" column="49" filename="$USER_HOME$/ccs/intake/versions.gradle" />
      <jump line="99" column="13" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="80" column="0" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="151" column="4" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="189" column="4" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="150" column="11" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="148" column="28" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="149" column="25" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="155" column="28" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="32" column="0" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/IntSpinnerAdapter.kt" />
      <jump line="33" column="26" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/IntSpinnerAdapter.kt" />
      <jump line="295" column="23" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="221" column="32" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="54" column="9" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/BindingAdapter.kt" />
      <jump line="22" column="11" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/BindingAdapter.kt" />
      <jump line="12" column="38" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="256" column="40" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="257" column="50" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="258" column="50" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="320" column="28" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="335" column="22" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="555" column="54" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="562" column="16" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="572" column="20" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="574" column="20" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="575" column="42" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="579" column="16" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainViewModel.kt" />
      <jump line="18" column="42" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/EnumCheckedListAdapter.kt" />
      <jump line="19" column="16" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/EnumCheckedListAdapter.kt" />
      <jump line="21" column="51" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/EnumCheckedListAdapter.kt" />
      <jump line="28" column="40" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/EnumCheckedListAdapter.kt" />
      <jump line="24" column="11" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainActivity.kt" />
      <jump line="169" column="14" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainActivity.kt" />
      <jump line="178" column="16" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/MainActivity.kt" />
      <jump line="148" column="44" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/scanner/ScannerFragment.kt" />
      <jump line="135" column="8" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/scanner/ScannerFragment.kt" />
      <jump line="134" column="8" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/scanner/ScannerFragment.kt" />
      <jump line="2" column="14" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/scanner/ScannerFragment.kt" />
      <jump line="139" column="26" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/scanner/ScannerFragment.kt" />
      <jump line="52" column="20" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/ui/scanner/ScannerFragment.kt" />
      <jump line="14" column="0" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/NetworkDelayAdapter.kt" />
      <jump line="16" column="8" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/NetworkDelayAdapter.kt" />
      <jump line="19" column="8" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/NetworkDelayAdapter.kt" />
      <jump line="11" column="42" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/NetworkDelayAdapter.kt" />
      <jump line="8" column="71" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/ResSpinnerAdapter.kt" />
      <jump line="11" column="36" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/ResSpinnerAdapter.kt" />
      <jump line="15" column="28" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/ResSpinnerAdapter.kt" />
      <jump line="17" column="30" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/ResSpinnerAdapter.kt" />
      <jump line="19" column="46" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/ResSpinnerAdapter.kt" />
      <jump line="12" column="23" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/ResSpinnerAdapter.kt" />
      <jump line="10" column="51" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/IntResSpinnerAdapter.kt" />
      <jump line="30" column="26" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/adapters/SpinnerAdapter.kt" />
      <jump line="232" column="19" filename="$USER_HOME$/ccs/intake/app/src/main/java/monte/apps/kiosk/common/Permissions.kt" />
      <jump line="134" column="52" filename="$USER_HOME$/ccs/intake/app/build.gradle" />
      <jump line="119" column="33" filename="$USER_HOME$/ccs/intake/app/src/dev/res/layout/settings_dialog_fragment.xml" />
      <jump line="214" column="0" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="273" column="25" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="73" column="4" filename="$USER_HOME$/ccs/intake/app/src/dev/res/layout/settings_dialog_fragment.xml" />
      <jump line="432" column="46" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" />
      <jump line="48" column="7" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" />
      <jump line="49" column="7" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" />
      <jump line="50" column="7" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" />
      <jump line="51" column="7" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" />
      <jump line="64" column="0" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" />
      <jump line="17" column="8" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" />
      <jump line="19" column="14" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" />
      <jump line="47" column="7" filename="$USER_HOME$/.gradle/caches/modules-2/files-2.1/androidx.drawerlayout/drawerlayout/1.0.0-alpha3/3091915df570eb2ff0a8e0298552cba023a9b0bc/drawerlayout-1.0.0-alpha3-sources.jar!/androidx/drawerlayout/widget/DrawerLayout.java" />
      <jump line="45" column="38" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="396" column="70" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="397" column="30" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="400" column="18" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
      <jump line="79" column="56" filename="$USER_HOME$/ccs/intake/app/src/dev/java/monte/tools/settings/ui/BaseFragment.kt" />
    </jumps>
    <registers>
      <register name="&quot;" type="2">
        <text encoding="base64">ICAgICAgICA8aXRlbSBuYW1lPSJhbmRyb2lkOnRleHRDb2xvciI+P2FuZHJvaWQ6YXR0ci90ZXh0Q29sb3JQcmltYXJ5PC9pdGVtPgo=</text>
      </register>
      <register name="g" type="4">
        <keys>
          <key char="65535" code="27" mods="0" />
          <key char="107" code="0" mods="0" />
          <key char="107" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="107" code="0" mods="0" />
          <key char="107" code="0" mods="0" />
          <key char="65535" code="27" mods="0" />
          <key char="71" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="96" code="0" mods="0" />
          <key char="49" code="0" mods="0" />
          <key char="71" code="0" mods="0" />
          <key char="65535" code="27" mods="0" />
        </keys>
      </register>
      <register name="k" type="4">
        <keys>
          <key char="107" code="0" mods="0" />
          <key char="107" code="0" mods="0" />
          <key char="107" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="114" code="0" mods="0" />
          <key char="117" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="65535" code="27" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="102" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="115" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="98" code="0" mods="0" />
          <key char="98" code="0" mods="0" />
          <key char="98" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="27" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="64" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="64" code="0" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="65535" code="27" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="27" mods="0" />
          <key char="117" code="0" mods="0" />
          <key char="117" code="0" mods="0" />
          <key char="114" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="114" code="0" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="64" code="0" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="65535" code="27" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="65535" code="27" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="108" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="104" code="0" mods="0" />
          <key char="120" code="0" mods="0" />
          <key char="106" code="0" mods="0" />
          <key char="107" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="65535" code="27" mods="0" />
        </keys>
      </register>
      <register name="-" type="4">
        <text>00ff00</text>
      </register>
      <register name="/" type="4">
        <text>activity</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">ICAgIDxpdGVtIG5hbWU9ImFuZHJvaWQ6dGV4dENvbG9yIj4/YW5kcm9pZDphdHRyL3RleHRDb2xvclNlY29uZGFyeTwvaXRlbT4K</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">ICAgICAgICA8aXRlbSBuYW1lPSJhbmRyb2lkOnRleHRDb2xvciI+P2FuZHJvaWQ6YXR0ci90ZXh0Q29sb3JQcmltYXJ5PC9pdGVtPgo=</text>
      </register>
      <register name="q" type="4">
        <text />
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICAgICAgICA8aXRlbSBuYW1lPSJhbmRyb2lkOnRleHRDb2xvciI+P2FuZHJvaWQ6YXR0ci90ZXh0Q29sb3JQcmltYXJ5PC9pdGVtPgo=</text>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAgIHByaXZhdGUgbGF0ZWluaXQgdmFyIGRyYXdlckxheW91dDogRHJhd2VyTGF5b3V0Cg==</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgIDxpdGVtIG5hbWU9ImFuZHJvaWQ6YmFja2dyb3VuZFRpbnQiPiMwMGZmMDA8L2l0ZW0+Cg==</text>
      </register>
      <register name="5" type="2">
        <text encoding="base64">Cg==</text>
      </register>
      <register name="u" type="4">
        <text />
      </register>
      <register name="6" type="2">
        <text encoding="base64">ICAgIGlpRgo=</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">cGFja2FnZSBtb250ZS50b29scy5zZXR0aW5ncy51aTsKCmltcG9ydCBzdGF0aWMgYW5kcm9pZHguYW5ub3RhdGlvbi5SZXN0cmljdFRvLlNjb3BlLkxJQlJBUllfR1JPVVA7CgppbXBvcnQgYW5kcm9pZC5hbm5vdGF0aW9uLlN1cHByZXNzTGludDsKaW1wb3J0IGFuZHJvaWQuYW5ub3RhdGlvbi5UYXJnZXRBcGk7CmltcG9ydCBhbmRyb2lkLmNvbnRlbnQuQ29udGV4dDsKaW1wb3J0IGFuZHJvaWQuY29udGVudC5yZXMuVHlwZWRBcnJheTsKaW1wb3J0IGFuZHJvaWQuZ3JhcGhpY3MuQ2FudmFzOwppbXBvcnQgYW5kcm9pZC5ncmFwaGljcy5NYXRyaXg7CmltcG9ydCBhbmRyb2lkLmdyYXBoaWNzLlBhaW50OwppbXBvcnQgYW5kcm9pZC5ncmFwaGljcy5QaXhlbEZvcm1hdDsKaW1wb3J0IGFuZHJvaWQuZ3JhcGhpY3MuUmVjdDsKaW1wb3J0IGFuZHJvaWQuZ3JhcGhpY3MuZHJhd2FibGUuQ29sb3JEcmF3YWJsZTsKaW1wb3J0IGFuZHJvaWQuZ3JhcGhpY3MuZHJhd2FibGUuRHJhd2FibGU7CmltcG9ydCBhbmRyb2lkLm9zLkJ1aWxkOwppbXBvcnQgYW5kcm9pZC5vcy5QYXJjZWw7CmltcG9ydCBhbmRyb2lkLm9zLlBhcmNlbGFibGU7CmltcG9ydCBhbmRyb2lkLm9zLlN5c3RlbUNsb2NrOwppbXBvcnQgYW5kcm9pZC51dGlsLkF0dHJpYnV0ZVNldDsKaW1wb3J0IGFuZHJvaWQudmlldy5HcmF2aXR5OwppbXBvcnQgYW5kcm9pZC52aWV3LklucHV0RGV2aWNlOwppbXBvcnQgYW5kcm9pZC52aWV3LktleUV2ZW50OwppbXBvcnQgYW5kcm9pZC52aWV3Lk1vdGlvbkV2ZW50OwppbXBvcnQgYW5kcm9pZC52aWV3LlZpZXc7CmltcG9ydCBhbmRyb2lkLnZpZXcuVmlld0dyb3VwOwppbXBvcnQgYW5kcm9pZC52aWV3LlZpZXdQYXJlbnQ7CmltcG9ydCBhbmRyb2lkLnZpZXcuV2luZG93SW5zZXRzOwppbXBvcnQgYW5kcm9pZC52aWV3LmFjY2Vzc2liaWxpdHkuQWNjZXNzaWJpbGl0eUV2ZW50OwoKaW1wb3J0IGFuZHJvaWR4LmFubm90YXRpb24uQ29sb3JJbnQ7CmltcG9ydCBhbmRyb2lkeC5hbm5vdGF0aW9uLkRyYXdhYmxlUmVzOwppbXBvcnQgYW5kcm9pZHguYW5ub3RhdGlvbi5JbnREZWY7CmltcG9ydCBhbmRyb2lkeC5hbm5vdGF0aW9uLk5vbk51bGw7CmltcG9ydCBhbmRyb2lkeC5hbm5vdGF0aW9uLk51bGxhYmxlOwppbXBvcnQgYW5kcm9pZHguYW5ub3RhdGlvbi5SZXN0cmljdFRvOwppbXBvcnQgYW5kcm9pZHguY29yZS5jb250ZW50LkNvbnRleHRDb21wYXQ7CmltcG9ydCBhbmRyb2lkeC5jb3JlLmdyYXBoaWNzLmRyYXdhYmxlLkRyYXdhYmxlQ29tcGF0OwppbXBvcnQgYW5kcm9pZHguY29yZS52aWV3LkFjY2Vzc2liaWxpdHlEZWxlZ2F0ZUNvbXBhdDsKaW1wb3J0IGFuZHJvaWR4LmNvcmUudmlldy5HcmF2aXR5Q29tcGF0OwppbXBvcnQgYW5kcm9pZHguY29yZS52aWV3LlZpZXdDb21wYXQ7CmltcG9ydCBhbmRyb2lkeC5jb3JlLnZpZXcuYWNjZXNzaWJpbGl0eS5BY2Nlc3NpYmlsaXR5Tm9kZUluZm9Db21wYXQ7CmltcG9ydCBhbmRyb2lkeC5jb3JlLnZpZXcuYWNjZXNzaWJpbGl0eS5BY2Nlc3NpYmlsaXR5Tm9kZUluZm9Db21wYXQuQWNjZXNzaWJpbGl0eUFjdGlvbkNvbXBhdDsKaW1wb3J0IGFuZHJvaWR4LmN1c3RvbXZpZXcudmlldy5BYnNTYXZlZFN0YXRlOwppbXBvcnQgYW5kcm9pZHguY3VzdG9tdmlldy53aWRnZXQuVmlld0RyYWdIZWxwZXI7CgppbXBvcnQgamF2YS5sYW5nLmFubm90YXRpb24uUmV0ZW50aW9uOwppbXBvcnQgamF2YS5sYW5nLmFubm90YXRpb24uUmV0ZW50aW9uUG9saWN5OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoKLyoqCiAqIERyYXdlckxheW91dCBhY3RzIGFzIGEgdG9wLWxldmVsIGNvbnRhaW5lciBmb3Igd2luZG93IGNvbnRlbnQgdGhhdCBhbGxvd3MgZm9yCiAqIGludGVyYWN0aXZlICJkcmF3ZXIiIHZpZXdzIHRvIGJlIHB1bGxlZCBvdXQgZnJvbSBvbmUgb3IgYm90aCB2ZXJ0aWNhbCBlZGdlcyBvZiB0aGUgd2luZG93LgogKgogKiA8cD5EcmF3ZXIgcG9zaXRpb25pbmcgYW5kIGxheW91dCBpcyBjb250cm9sbGVkIHVzaW5nIHRoZSA8Y29kZT5hbmRyb2lkOmxheW91dF9ncmF2aXR5PC9jb2RlPgogKiBhdHRyaWJ1dGUgb24gY2hpbGQgdmlld3MgY29ycmVzcG9uZGluZyB0byB3aGljaCBzaWRlIG9mIHRoZSB2aWV3IHlvdSB3YW50IHRoZSBkcmF3ZXIKICogdG8gZW1lcmdlIGZyb206IGxlZnQgb3IgcmlnaHQgKG9yIHN0YXJ0L2VuZCBvbiBwbGF0Zm9ybSB2ZXJzaW9ucyB0aGF0IHN1cHBvcnQgbGF5b3V0IGRpcmVjdGlvbi4pCiAqIE5vdGUgdGhhdCB5b3UgY2FuIG9ubHkgaGF2ZSBvbmUgZHJhd2VyIHZpZXcgZm9yIGVhY2ggdmVydGljYWwgZWRnZSBvZiB0aGUgd2luZG93LiBJZiB5b3VyCiAqIGxheW91dCBjb25maWd1cmVzIG1vcmUgdGhhbiBvbmUgZHJhd2VyIHZpZXcgcGVyIHZlcnRpY2FsIGVkZ2Ugb2YgdGhlIHdpbmRvdywgYW4gZXhjZXB0aW9uIHdpbGwKICogYmUgdGhyb3duIGF0IHJ1bnRpbWUuCiAqIDwvcD4KICoKICogPHA+VG8gdXNlIGEgRHJhd2VyTGF5b3V0LCBwb3NpdGlvbiB5b3VyIHByaW1hcnkgY29udGVudCB2aWV3IGFzIHRoZSBmaXJzdCBjaGlsZCB3aXRoCiAqIHdpZHRoIGFuZCBoZWlnaHQgb2YgPGNvZGU+bWF0Y2hfcGFyZW50PC9jb2RlPiBhbmQgbm8gPGNvZGU+bGF5b3V0X2dyYXZpdHk+PC9jb2RlPi4KICogQWRkIGRyYXdlcnMgYXMgY2hpbGQgdmlld3MgYWZ0ZXIgdGhlIG1haW4gY29udGVudCB2aWV3IGFuZCBzZXQgdGhlIDxjb2RlPmxheW91dF9ncmF2aXR5PC9jb2RlPgogKiBhcHByb3ByaWF0ZWx5LiBEcmF3ZXJzIGNvbW1vbmx5IHVzZSA8Y29kZT5tYXRjaF9wYXJlbnQ8L2NvZGU+IGZvciBoZWlnaHQgd2l0aCBhIGZpeGVkIHdpZHRoLjwvcD4KICoKICogPHA+e0BsaW5rIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkRyYXdlckxpc3RlbmVyfSBjYW4gYmUgdXNlZCB0byBtb25pdG9yIHRoZSBzdGF0ZSBhbmQgbW90aW9uIG9mIGRyYXdlciB2aWV3cy4KICogQXZvaWQgcGVyZm9ybWluZyBleHBlbnNpdmUgb3BlcmF0aW9ucyBzdWNoIGFzIGxheW91dCBkdXJpbmcgYW5pbWF0aW9uIGFzIGl0IGNhbiBjYXVzZQogKiBzdHV0dGVyaW5nOyB0cnkgdG8gcGVyZm9ybSBleHBlbnNpdmUgb3BlcmF0aW9ucyBkdXJpbmcgdGhlIHtAbGluayAjU1RBVEVfSURMRX0gc3RhdGUuCiAqIHtAbGluayBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5TaW1wbGVEcmF3ZXJMaXN0ZW5lcn0gb2ZmZXJzIGRlZmF1bHQvbm8tb3AgaW1wbGVtZW50YXRpb25zIG9mIGVhY2ggY2FsbGJhY2sgbWV0aG9kLjwvcD4KICoKICogPHA+QXMgcGVyIHRoZSA8YSBocmVmPSJ7QGRvY1Jvb3R9ZGVzaWduL3BhdHRlcm5zL25hdmlnYXRpb24tZHJhd2VyLmh0bWwiPkFuZHJvaWQgRGVzaWduCiAqIGd1aWRlPC9hPiwgYW55IGRyYXdlcnMgcG9zaXRpb25lZCB0byB0aGUgbGVmdC9zdGFydCBzaG91bGQKICogYWx3YXlzIGNvbnRhaW4gY29udGVudCBmb3IgbmF2aWdhdGluZyBhcm91bmQgdGhlIGFwcGxpY2F0aW9uLCB3aGVyZWFzIGFueSBkcmF3ZXJzCiAqIHBvc2l0aW9uZWQgdG8gdGhlIHJpZ2h0L2VuZCBzaG91bGQgYWx3YXlzIGNvbnRhaW4gYWN0aW9ucyB0byB0YWtlIG9uIHRoZSBjdXJyZW50IGNvbnRlbnQuCiAqIFRoaXMgcHJlc2VydmVzIHRoZSBzYW1lIG5hdmlnYXRpb24gbGVmdCwgYWN0aW9ucyByaWdodCBzdHJ1Y3R1cmUgcHJlc2VudCBpbiB0aGUgQWN0aW9uIEJhcgogKiBhbmQgZWxzZXdoZXJlLjwvcD4KICoKICogPHA+Rm9yIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgaG93IHRvIHVzZSBEcmF3ZXJMYXlvdXQsIHJlYWQgPGEKICogaHJlZj0ie0Bkb2NSb290fXRyYWluaW5nL2ltcGxlbWVudGluZy1uYXZpZ2F0aW9uL25hdi1kcmF3ZXIuaHRtbCI+Q3JlYXRpbmcgYSBOYXZpZ2F0aW9uCiAqIERyYXdlcjwvYT4uPC9wPgogKi8KcHVibGljIGNsYXNzIERyYXdlckxheW91dCBleHRlbmRzIFZpZXdHcm91cCB7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgVEFHID0gIkRyYXdlckxheW91dCI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50W10gVEhFTUVfQVRUUlMgPSB7CiAgICAgICAgICAgIGFuZHJvaWQuUi5hdHRyLmNvbG9yUHJpbWFyeURhcmsKICAgIH07CgogICAgQEludERlZih7U1RBVEVfSURMRSwgU1RBVEVfRFJBR0dJTkcsIFNUQVRFX1NFVFRMSU5HfSkKICAgIEBSZXRlbnRpb24oUmV0ZW50aW9uUG9saWN5LlNPVVJDRSkKICAgIHByaXZhdGUgQGludGVyZmFjZSBTdGF0ZSB7fQoKICAgIC8qKgogICAgICogSW5kaWNhdGVzIHRoYXQgYW55IGRyYXdlcnMgYXJlIGluIGFuIGlkbGUsIHNldHRsZWQgc3RhdGUuIE5vIGFuaW1hdGlvbiBpcyBpbiBwcm9ncmVzcy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RBVEVfSURMRSA9IFZpZXdEcmFnSGVscGVyLlNUQVRFX0lETEU7CgogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgdGhhdCBhIGRyYXdlciBpcyBjdXJyZW50bHkgYmVpbmcgZHJhZ2dlZCBieSB0aGUgdXNlci4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RBVEVfRFJBR0dJTkcgPSBWaWV3RHJhZ0hlbHBlci5TVEFURV9EUkFHR0lORzsKCiAgICAvKioKICAgICAqIEluZGljYXRlcyB0aGF0IGEgZHJhd2VyIGlzIGluIHRoZSBwcm9jZXNzIG9mIHNldHRsaW5nIHRvIGEgZmluYWwgcG9zaXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNUQVRFX1NFVFRMSU5HID0gVmlld0RyYWdIZWxwZXIuU1RBVEVfU0VUVExJTkc7CgogICAgQEludERlZih7TE9DS19NT0RFX1VOTE9DS0VELCBMT0NLX01PREVfTE9DS0VEX0NMT1NFRCwgTE9DS19NT0RFX0xPQ0tFRF9PUEVOLAogICAgICAgICAgICBMT0NLX01PREVfVU5ERUZJTkVEfSkKICAgIEBSZXRlbnRpb24oUmV0ZW50aW9uUG9saWN5LlNPVVJDRSkKICAgIHByaXZhdGUgQGludGVyZmFjZSBMb2NrTW9kZSB7fQoKICAgIC8qKgogICAgICogVGhlIGRyYXdlciBpcyB1bmxvY2tlZC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTE9DS19NT0RFX1VOTE9DS0VEID0gMDsKCiAgICAvKioKICAgICAqIFRoZSBkcmF3ZXIgaXMgbG9ja2VkIGNsb3NlZC4gVGhlIHVzZXIgbWF5IG5vdCBvcGVuIGl0LCB0aG91Z2gKICAgICAqIHRoZSBhcHAgbWF5IG9wZW4gaXQgcHJvZ3JhbW1hdGljYWxseS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTE9DS19NT0RFX0xPQ0tFRF9DTE9TRUQgPSAxOwoKICAgIC8qKgogICAgICogVGhlIGRyYXdlciBpcyBsb2NrZWQgb3Blbi4gVGhlIHVzZXIgbWF5IG5vdCBjbG9zZSBpdCwgdGhvdWdoIHRoZSBhcHAKICAgICAqIG1heSBjbG9zZSBpdCBwcm9ncmFtbWF0aWNhbGx5LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0NLX01PREVfTE9DS0VEX09QRU4gPSAyOwoKICAgIC8qKgogICAgICogVGhlIGRyYXdlcidzIGxvY2sgc3RhdGUgaXMgcmVzZXQgdG8gZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTE9DS19NT0RFX1VOREVGSU5FRCA9IDM7CgogICAgQEludERlZih2YWx1ZSA9IHtHcmF2aXR5LkxFRlQsIEdyYXZpdHkuUklHSFQsIEdyYXZpdHlDb21wYXQuU1RBUlQsIEdyYXZpdHlDb21wYXQuRU5EfSwKICAgICAgICAgICAgZmxhZyA9IHRydWUpCiAgICBAUmV0ZW50aW9uKFJldGVudGlvblBvbGljeS5TT1VSQ0UpCiAgICBwcml2YXRlIEBpbnRlcmZhY2UgRWRnZUdyYXZpdHkge30KCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1JTl9EUkFXRVJfTUFSR0lOID0gNjQ7IC8vIGRwCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRFJBV0VSX0VMRVZBVElPTiA9IDEwOyAvL2RwCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IERFRkFVTFRfU0NSSU1fQ09MT1IgPSAweDk5MDAwMDAwOwoKICAgIC8qKgogICAgICogTGVuZ3RoIG9mIHRpbWUgdG8gZGVsYXkgYmVmb3JlIHBlZWtpbmcgdGhlIGRyYXdlci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFBFRUtfREVMQVkgPSAxNjA7IC8vIG1zCgogICAgLyoqCiAgICAgKiBNaW5pbXVtIHZlbG9jaXR5IHRoYXQgd2lsbCBiZSBkZXRlY3RlZCBhcyBhIGZsaW5nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNSU5fRkxJTkdfVkVMT0NJVFkgPSA0MDA7IC8vIGRpcHMgcGVyIHNlY29uZAoKICAgIC8qKgogICAgICogRXhwZXJpbWVudGFsIGZlYXR1cmUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGJvb2xlYW4gQUxMT1dfRURHRV9MT0NLID0gZmFsc2U7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgYm9vbGVhbiBDSElMRFJFTl9ESVNBTExPV19JTlRFUkNFUFQgPSB0cnVlOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGZsb2F0IFRPVUNIX1NMT1BfU0VOU0lUSVZJVFkgPSAxLmY7CgogICAgc3RhdGljIGZpbmFsIGludFtdIExBWU9VVF9BVFRSUyA9IG5ldyBpbnRbXSB7CiAgICAgICAgICAgIGFuZHJvaWQuUi5hdHRyLmxheW91dF9ncmF2aXR5CiAgICB9OwoKICAgIC8qKiBXaGV0aGVyIHdlIGNhbiB1c2UgTk9fSElERV9ERVNDRU5EQU5UUyBhY2Nlc3NpYmlsaXR5IGltcG9ydGFuY2UuICovCiAgICBzdGF0aWMgZmluYWwgYm9vbGVhbiBDQU5fSElERV9ERVNDRU5EQU5UUyA9IEJ1aWxkLlZFUlNJT04uU0RLX0lOVCA+PSAxOTsKCiAgICAvKiogV2hldGhlciB0aGUgZHJhd2VyIHNoYWRvdyBjb21lcyBmcm9tIHNldHRpbmcgZWxldmF0aW9uIG9uIHRoZSBkcmF3ZXIuICovCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBib29sZWFuIFNFVF9EUkFXRVJfU0hBRE9XX0ZST01fRUxFVkFUSU9OID0KICAgICAgICAgICAgQnVpbGQuVkVSU0lPTi5TREtfSU5UID49IDIxOwoKICAgIHByaXZhdGUgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuQ2hpbGRBY2Nlc3NpYmlsaXR5RGVsZWdhdGUgbUNoaWxkQWNjZXNzaWJpbGl0eURlbGVnYXRlID0KICAgICAgICAgICAgbmV3IGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkNoaWxkQWNjZXNzaWJpbGl0eURlbGVnYXRlKCk7CiAgICBwcml2YXRlIGZsb2F0IG1EcmF3ZXJFbGV2YXRpb247CgogICAgcHJpdmF0ZSBpbnQgbU1pbkRyYXdlck1hcmdpbjsKCiAgICBwcml2YXRlIGludCBtU2NyaW1Db2xvciA9IERFRkFVTFRfU0NSSU1fQ09MT1I7CiAgICBwcml2YXRlIGZsb2F0IG1TY3JpbU9wYWNpdHk7CiAgICBwcml2YXRlIFBhaW50IG1TY3JpbVBhaW50ID0gbmV3IFBhaW50KCk7CgogICAgcHJpdmF0ZSBmaW5hbCBWaWV3RHJhZ0hlbHBlciBtTGVmdERyYWdnZXI7CiAgICBwcml2YXRlIGZpbmFsIFZpZXdEcmFnSGVscGVyIG1SaWdodERyYWdnZXI7CiAgICBwcml2YXRlIGZpbmFsIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LlZpZXdEcmFnQ2FsbGJhY2sgbUxlZnRDYWxsYmFjazsKICAgIHByaXZhdGUgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuVmlld0RyYWdDYWxsYmFjayBtUmlnaHRDYWxsYmFjazsKICAgIHByaXZhdGUgaW50IG1EcmF3ZXJTdGF0ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBtSW5MYXlvdXQ7CiAgICBwcml2YXRlIGJvb2xlYW4gbUZpcnN0TGF5b3V0ID0gdHJ1ZTsKCiAgICBwcml2YXRlIEBMb2NrTW9kZSBpbnQgbUxvY2tNb2RlTGVmdCA9IExPQ0tfTU9ERV9VTkRFRklORUQ7CiAgICBwcml2YXRlIEBMb2NrTW9kZSBpbnQgbUxvY2tNb2RlUmlnaHQgPSBMT0NLX01PREVfVU5ERUZJTkVEOwogICAgcHJpdmF0ZSBATG9ja01vZGUgaW50IG1Mb2NrTW9kZVN0YXJ0ID0gTE9DS19NT0RFX1VOREVGSU5FRDsKICAgIHByaXZhdGUgQExvY2tNb2RlIGludCBtTG9ja01vZGVFbmQgPSBMT0NLX01PREVfVU5ERUZJTkVEOwoKICAgIHByaXZhdGUgYm9vbGVhbiBtRGlzYWxsb3dJbnRlcmNlcHRSZXF1ZXN0ZWQ7CiAgICBwcml2YXRlIGJvb2xlYW4gbUNoaWxkcmVuQ2FuY2VsZWRUb3VjaDsKCiAgICBwcml2YXRlIEBOdWxsYWJsZQogICAgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuRHJhd2VyTGlzdGVuZXIgbUxpc3RlbmVyOwogICAgcHJpdmF0ZSBMaXN0PGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkRyYXdlckxpc3RlbmVyPiBtTGlzdGVuZXJzOwoKICAgIHByaXZhdGUgZmxvYXQgbUluaXRpYWxNb3Rpb25YOwogICAgcHJpdmF0ZSBmbG9hdCBtSW5pdGlhbE1vdGlvblk7CgogICAgcHJpdmF0ZSBEcmF3YWJsZSBtU3RhdHVzQmFyQmFja2dyb3VuZDsKICAgIHByaXZhdGUgRHJhd2FibGUgbVNoYWRvd0xlZnRSZXNvbHZlZDsKICAgIHByaXZhdGUgRHJhd2FibGUgbVNoYWRvd1JpZ2h0UmVzb2x2ZWQ7CgogICAgcHJpdmF0ZSBDaGFyU2VxdWVuY2UgbVRpdGxlTGVmdDsKICAgIHByaXZhdGUgQ2hhclNlcXVlbmNlIG1UaXRsZVJpZ2h0OwoKICAgIHByaXZhdGUgT2JqZWN0IG1MYXN0SW5zZXRzOwogICAgcHJpdmF0ZSBib29sZWFuIG1EcmF3U3RhdHVzQmFyQmFja2dyb3VuZDsKCiAgICAvKiogU2hhZG93IGRyYXdhYmxlcyBmb3IgZGlmZmVyZW50IGdyYXZpdHkgKi8KICAgIHByaXZhdGUgRHJhd2FibGUgbVNoYWRvd1N0YXJ0ID0gbnVsbDsKICAgIHByaXZhdGUgRHJhd2FibGUgbVNoYWRvd0VuZCA9IG51bGw7CiAgICBwcml2YXRlIERyYXdhYmxlIG1TaGFkb3dMZWZ0ID0gbnVsbDsKICAgIHByaXZhdGUgRHJhd2FibGUgbVNoYWRvd1JpZ2h0ID0gbnVsbDsKCiAgICBwcml2YXRlIGZpbmFsIEFycmF5TGlzdDxWaWV3PiBtTm9uRHJhd2VyVmlld3M7CgogICAgcHJpdmF0ZSBSZWN0IG1DaGlsZEhpdFJlY3Q7CiAgICBwcml2YXRlIE1hdHJpeCBtQ2hpbGRJbnZlcnRlZE1hdHJpeDsKCiAgICAvKioKICAgICAqIExpc3RlbmVyIGZvciBtb25pdG9yaW5nIGV2ZW50cyBhYm91dCBkcmF3ZXJzLgogICAgICovCiAgICBwdWJsaWMgaW50ZXJmYWNlIERyYXdlckxpc3RlbmVyIHsKICAgICAgICAvKioKICAgICAgICAgKiBDYWxsZWQgd2hlbiBhIGRyYXdlcidzIHBvc2l0aW9uIGNoYW5nZXMuCiAgICAgICAgICogQHBhcmFtIGRyYXdlclZpZXcgVGhlIGNoaWxkIHZpZXcgdGhhdCB3YXMgbW92ZWQKICAgICAgICAgKiBAcGFyYW0gc2xpZGVPZmZzZXQgVGhlIG5ldyBvZmZzZXQgb2YgdGhpcyBkcmF3ZXIgd2l0aGluIGl0cyByYW5nZSwgZnJvbSAwLTEKICAgICAgICAgKi8KICAgICAgICB2b2lkIG9uRHJhd2VyU2xpZGUoQE5vbk51bGwgVmlldyBkcmF3ZXJWaWV3LCBmbG9hdCBzbGlkZU9mZnNldCk7CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuIGEgZHJhd2VyIGhhcyBzZXR0bGVkIGluIGEgY29tcGxldGVseSBvcGVuIHN0YXRlLgogICAgICAgICAqIFRoZSBkcmF3ZXIgaXMgaW50ZXJhY3RpdmUgYXQgdGhpcyBwb2ludC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBkcmF3ZXJWaWV3IERyYXdlciB2aWV3IHRoYXQgaXMgbm93IG9wZW4KICAgICAgICAgKi8KICAgICAgICB2b2lkIG9uRHJhd2VyT3BlbmVkKEBOb25OdWxsIFZpZXcgZHJhd2VyVmlldyk7CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuIGEgZHJhd2VyIGhhcyBzZXR0bGVkIGluIGEgY29tcGxldGVseSBjbG9zZWQgc3RhdGUuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZHJhd2VyVmlldyBEcmF3ZXIgdmlldyB0aGF0IGlzIG5vdyBjbG9zZWQKICAgICAgICAgKi8KICAgICAgICB2b2lkIG9uRHJhd2VyQ2xvc2VkKEBOb25OdWxsIFZpZXcgZHJhd2VyVmlldyk7CgogICAgICAgIC8qKgogICAgICAgICAqIENhbGxlZCB3aGVuIHRoZSBkcmF3ZXIgbW90aW9uIHN0YXRlIGNoYW5nZXMuIFRoZSBuZXcgc3RhdGUgd2lsbAogICAgICAgICAqIGJlIG9uZSBvZiB7QGxpbmsgI1NUQVRFX0lETEV9LCB7QGxpbmsgI1NUQVRFX0RSQUdHSU5HfSBvciB7QGxpbmsgI1NUQVRFX1NFVFRMSU5HfS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBuZXdTdGF0ZSBUaGUgbmV3IGRyYXdlciBtb3Rpb24gc3RhdGUKICAgICAgICAgKi8KICAgICAgICB2b2lkIG9uRHJhd2VyU3RhdGVDaGFuZ2VkKEBTdGF0ZSBpbnQgbmV3U3RhdGUpOwogICAgfQoKICAgIC8qKgogICAgICogU3R1Yi9uby1vcCBpbXBsZW1lbnRhdGlvbnMgb2YgYWxsIG1ldGhvZHMgb2Yge0BsaW5rIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkRyYXdlckxpc3RlbmVyfS4KICAgICAqIE92ZXJyaWRlIHRoaXMgaWYgeW91IG9ubHkgY2FyZSBhYm91dCBhIGZldyBvZiB0aGUgYXZhaWxhYmxlIGNhbGxiYWNrIG1ldGhvZHMuCiAgICAgKi8KICAgIHB1YmxpYyBhYnN0cmFjdCBzdGF0aWMgY2xhc3MgU2ltcGxlRHJhd2VyTGlzdGVuZXIgaW1wbGVtZW50cyBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5EcmF3ZXJMaXN0ZW5lciB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgb25EcmF3ZXJTbGlkZShWaWV3IGRyYXdlclZpZXcsIGZsb2F0IHNsaWRlT2Zmc2V0KSB7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvbkRyYXdlck9wZW5lZChWaWV3IGRyYXdlclZpZXcpIHsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9uRHJhd2VyQ2xvc2VkKFZpZXcgZHJhd2VyVmlldykgewogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgb25EcmF3ZXJTdGF0ZUNoYW5nZWQoaW50IG5ld1N0YXRlKSB7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBEcmF3ZXJMYXlvdXQoQE5vbk51bGwgQ29udGV4dCBjb250ZXh0KSB7CiAgICAgICAgdGhpcyhjb250ZXh0LCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgRHJhd2VyTGF5b3V0KEBOb25OdWxsIENvbnRleHQgY29udGV4dCwgQE51bGxhYmxlIEF0dHJpYnV0ZVNldCBhdHRycykgewogICAgICAgIHRoaXMoY29udGV4dCwgYXR0cnMsIDApOwogICAgfQoKICAgIHB1YmxpYyBEcmF3ZXJMYXlvdXQoQE5vbk51bGwgQ29udGV4dCBjb250ZXh0LCBATnVsbGFibGUgQXR0cmlidXRlU2V0IGF0dHJzLCBpbnQgZGVmU3R5bGUpIHsKICAgICAgICBzdXBlcihjb250ZXh0LCBhdHRycywgZGVmU3R5bGUpOwogICAgICAgIHNldERlc2NlbmRhbnRGb2N1c2FiaWxpdHkoVmlld0dyb3VwLkZPQ1VTX0FGVEVSX0RFU0NFTkRBTlRTKTsKICAgICAgICBmaW5hbCBmbG9hdCBkZW5zaXR5ID0gZ2V0UmVzb3VyY2VzKCkuZ2V0RGlzcGxheU1ldHJpY3MoKS5kZW5zaXR5OwogICAgICAgIG1NaW5EcmF3ZXJNYXJnaW4gPSAoaW50KSAoTUlOX0RSQVdFUl9NQVJHSU4gKiBkZW5zaXR5ICsgMC41Zik7CiAgICAgICAgZmluYWwgZmxvYXQgbWluVmVsID0gTUlOX0ZMSU5HX1ZFTE9DSVRZICogZGVuc2l0eTsKCiAgICAgICAgbUxlZnRDYWxsYmFjayA9IG5ldyBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5WaWV3RHJhZ0NhbGxiYWNrKEdyYXZpdHkuTEVGVCk7CiAgICAgICAgbVJpZ2h0Q2FsbGJhY2sgPSBuZXcgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuVmlld0RyYWdDYWxsYmFjayhHcmF2aXR5LlJJR0hUKTsKCiAgICAgICAgbUxlZnREcmFnZ2VyID0gVmlld0RyYWdIZWxwZXIuY3JlYXRlKHRoaXMsIFRPVUNIX1NMT1BfU0VOU0lUSVZJVFksIG1MZWZ0Q2FsbGJhY2spOwogICAgICAgIG1MZWZ0RHJhZ2dlci5zZXRFZGdlVHJhY2tpbmdFbmFibGVkKFZpZXdEcmFnSGVscGVyLkVER0VfTEVGVCk7CiAgICAgICAgbUxlZnREcmFnZ2VyLnNldE1pblZlbG9jaXR5KG1pblZlbCk7CiAgICAgICAgbUxlZnRDYWxsYmFjay5zZXREcmFnZ2VyKG1MZWZ0RHJhZ2dlcik7CgogICAgICAgIG1SaWdodERyYWdnZXIgPSBWaWV3RHJhZ0hlbHBlci5jcmVhdGUodGhpcywgVE9VQ0hfU0xPUF9TRU5TSVRJVklUWSwgbVJpZ2h0Q2FsbGJhY2spOwogICAgICAgIG1SaWdodERyYWdnZXIuc2V0RWRnZVRyYWNraW5nRW5hYmxlZChWaWV3RHJhZ0hlbHBlci5FREdFX1JJR0hUKTsKICAgICAgICBtUmlnaHREcmFnZ2VyLnNldE1pblZlbG9jaXR5KG1pblZlbCk7CiAgICAgICAgbVJpZ2h0Q2FsbGJhY2suc2V0RHJhZ2dlcihtUmlnaHREcmFnZ2VyKTsKCiAgICAgICAgLy8gU28gdGhhdCB3ZSBjYW4gY2F0Y2ggdGhlIGJhY2sgYnV0dG9uCiAgICAgICAgc2V0Rm9jdXNhYmxlSW5Ub3VjaE1vZGUodHJ1ZSk7CgogICAgICAgIFZpZXdDb21wYXQuc2V0SW1wb3J0YW50Rm9yQWNjZXNzaWJpbGl0eSh0aGlzLAogICAgICAgICAgICAgICAgVmlld0NvbXBhdC5JTVBPUlRBTlRfRk9SX0FDQ0VTU0lCSUxJVFlfWUVTKTsKCiAgICAgICAgVmlld0NvbXBhdC5zZXRBY2Nlc3NpYmlsaXR5RGVsZWdhdGUodGhpcywgbmV3IGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkFjY2Vzc2liaWxpdHlEZWxlZ2F0ZSgpKTsKICAgICAgICBzZXRNb3Rpb25FdmVudFNwbGl0dGluZ0VuYWJsZWQoZmFsc2UpOwogICAgICAgIGlmIChWaWV3Q29tcGF0LmdldEZpdHNTeXN0ZW1XaW5kb3dzKHRoaXMpKSB7CiAgICAgICAgICAgIGlmIChCdWlsZC5WRVJTSU9OLlNES19JTlQgPj0gMjEpIHsKICAgICAgICAgICAgICAgIHNldE9uQXBwbHlXaW5kb3dJbnNldHNMaXN0ZW5lcihuZXcgVmlldy5PbkFwcGx5V2luZG93SW5zZXRzTGlzdGVuZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgQFRhcmdldEFwaSgyMSkKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgV2luZG93SW5zZXRzIG9uQXBwbHlXaW5kb3dJbnNldHMoVmlldyB2aWV3LCBXaW5kb3dJbnNldHMgaW5zZXRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0IGRyYXdlckxheW91dCA9IChhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dCkgdmlldzsKICAgICAgICAgICAgICAgICAgICAgICAgZHJhd2VyTGF5b3V0LnNldENoaWxkSW5zZXRzKGluc2V0cywgaW5zZXRzLmdldFN5c3RlbVdpbmRvd0luc2V0VG9wKCkgPiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluc2V0cy5jb25zdW1lU3lzdGVtV2luZG93SW5zZXRzKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXRTeXN0ZW1VaVZpc2liaWxpdHkoVmlldy5TWVNURU1fVUlfRkxBR19MQVlPVVRfU1RBQkxFCiAgICAgICAgICAgICAgICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19MQVlPVVRfRlVMTFNDUkVFTik7CiAgICAgICAgICAgICAgICBmaW5hbCBUeXBlZEFycmF5IGEgPSBjb250ZXh0Lm9idGFpblN0eWxlZEF0dHJpYnV0ZXMoVEhFTUVfQVRUUlMpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBtU3RhdHVzQmFyQmFja2dyb3VuZCA9IGEuZ2V0RHJhd2FibGUoMCk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGEucmVjeWNsZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbVN0YXR1c0JhckJhY2tncm91bmQgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBtRHJhd2VyRWxldmF0aW9uID0gRFJBV0VSX0VMRVZBVElPTiAqIGRlbnNpdHk7CgogICAgICAgIG1Ob25EcmF3ZXJWaWV3cyA9IG5ldyBBcnJheUxpc3Q8Vmlldz4oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgdGhlIGJhc2UgZWxldmF0aW9uIG9mIHRoZSBkcmF3ZXIocykgcmVsYXRpdmUgdG8gdGhlIHBhcmVudCwgaW4gcGl4ZWxzLiBOb3RlIHRoYXQgdGhlCiAgICAgKiBlbGV2YXRpb24gY2hhbmdlIGlzIG9ubHkgc3VwcG9ydGVkIGluIEFQSSAyMSBhbmQgYWJvdmUuCiAgICAgKgogICAgICogQHBhcmFtIGVsZXZhdGlvbiBUaGUgYmFzZSBkZXB0aCBwb3NpdGlvbiBvZiB0aGUgdmlldywgaW4gcGl4ZWxzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREcmF3ZXJFbGV2YXRpb24oZmxvYXQgZWxldmF0aW9uKSB7CiAgICAgICAgbURyYXdlckVsZXZhdGlvbiA9IGVsZXZhdGlvbjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGdldENoaWxkQ291bnQoKTsgaSsrKSB7CiAgICAgICAgICAgIFZpZXcgY2hpbGQgPSBnZXRDaGlsZEF0KGkpOwogICAgICAgICAgICBpZiAoaXNEcmF3ZXJWaWV3KGNoaWxkKSkgewogICAgICAgICAgICAgICAgVmlld0NvbXBhdC5zZXRFbGV2YXRpb24oY2hpbGQsIG1EcmF3ZXJFbGV2YXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhlIGJhc2UgZWxldmF0aW9uIG9mIHRoZSBkcmF3ZXIocykgcmVsYXRpdmUgdG8gdGhlIHBhcmVudCwgaW4gcGl4ZWxzLiBOb3RlIHRoYXQgdGhlCiAgICAgKiBlbGV2YXRpb24gY2hhbmdlIGlzIG9ubHkgc3VwcG9ydGVkIGluIEFQSSAyMSBhbmQgYWJvdmUuIEZvciB1bnN1cHBvcnRlZCBBUEkgbGV2ZWxzLCAwIHdpbGwKICAgICAqIGJlIHJldHVybmVkIGFzIHRoZSBlbGV2YXRpb24uCiAgICAgKgogICAgICogQHJldHVybiBUaGUgYmFzZSBkZXB0aCBwb3NpdGlvbiBvZiB0aGUgdmlldywgaW4gcGl4ZWxzLgogICAgICovCiAgICBwdWJsaWMgZmxvYXQgZ2V0RHJhd2VyRWxldmF0aW9uKCkgewogICAgICAgIGlmIChTRVRfRFJBV0VSX1NIQURPV19GUk9NX0VMRVZBVElPTikgewogICAgICAgICAgICByZXR1cm4gbURyYXdlckVsZXZhdGlvbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDBmOwogICAgfQoKICAgIC8qKgogICAgICogQGhpZGUgSW50ZXJuYWwgdXNlIG9ubHk7IGNhbGxlZCB0byBhcHBseSB3aW5kb3cgaW5zZXRzIHdoZW4gY29uZmlndXJlZAogICAgICogd2l0aCBmaXRzU3lzdGVtV2luZG93cz0idHJ1ZSIKICAgICAqLwogICAgQFJlc3RyaWN0VG8oTElCUkFSWV9HUk9VUCkKICAgIHB1YmxpYyB2b2lkIHNldENoaWxkSW5zZXRzKE9iamVjdCBpbnNldHMsIGJvb2xlYW4gZHJhdykgewogICAgICAgIG1MYXN0SW5zZXRzID0gaW5zZXRzOwogICAgICAgIG1EcmF3U3RhdHVzQmFyQmFja2dyb3VuZCA9IGRyYXc7CiAgICAgICAgc2V0V2lsbE5vdERyYXcoIWRyYXcgJiYgZ2V0QmFja2dyb3VuZCgpID09IG51bGwpOwogICAgICAgIHJlcXVlc3RMYXlvdXQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIHNpbXBsZSBkcmF3YWJsZSB1c2VkIGZvciB0aGUgbGVmdCBvciByaWdodCBzaGFkb3cuIFRoZSBkcmF3YWJsZSBwcm92aWRlZCBtdXN0IGhhdmUgYQogICAgICogbm9uemVybyBpbnRyaW5zaWMgd2lkdGguIEZvciBBUEkgMjEgYW5kIGFib3ZlLCBhbiBlbGV2YXRpb24gd2lsbCBiZSBzZXQgb24gdGhlIGRyYXdlcgogICAgICogaW5zdGVhZCBvZiB1c2luZyB0aGUgcHJvdmlkZWQgc2hhZG93IGRyYXdhYmxlLgogICAgICoKICAgICAqIDxwPk5vdGUgdGhhdCBmb3IgYmV0dGVyIHN1cHBvcnQgZm9yIGJvdGggbGVmdC10by1yaWdodCBhbmQgcmlnaHQtdG8tbGVmdCBsYXlvdXQKICAgICAqIGRpcmVjdGlvbnMsIGEgZHJhd2FibGUgZm9yIFJUTCBsYXlvdXQgKGluIGFkZGl0aW9uYWwgdG8gdGhlIG9uZSBpbiBMVFIgbGF5b3V0KSBjYW4gYmUKICAgICAqIGRlZmluZWQgd2l0aCBhIHJlc291cmNlIHF1YWxpZmllciAibGRydGwiIGZvciBBUEkgMTcgYW5kIGFib3ZlIHdpdGggdGhlIGdyYXZpdHkKICAgICAqIHtAbGluayBHcmF2aXR5Q29tcGF0I1NUQVJUfS4gQWx0ZXJuYXRpdmVseSwgZm9yIEFQSSAyMyBhbmQgYWJvdmUsIHRoZSBkcmF3YWJsZSBjYW4KICAgICAqIGF1dG8tbWlycm9yZWQgc3VjaCB0aGF0IHRoZSBkcmF3YWJsZSB3aWxsIGJlIG1pcnJvcmVkIGluIFJUTCBsYXlvdXQuPC9wPgogICAgICoKICAgICAqIEBwYXJhbSBzaGFkb3dEcmF3YWJsZSBTaGFkb3cgZHJhd2FibGUgdG8gdXNlIGF0IHRoZSBlZGdlIG9mIGEgZHJhd2VyCiAgICAgKiBAcGFyYW0gZ3Jhdml0eSBXaGljaCBkcmF3ZXIgdGhlIHNoYWRvdyBzaG91bGQgYXBwbHkgdG8KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RHJhd2VyU2hhZG93KERyYXdhYmxlIHNoYWRvd0RyYXdhYmxlLCBARWRnZUdyYXZpdHkgaW50IGdyYXZpdHkpIHsKICAgICAgICAvKgogICAgICAgICAqIFRPRE8gU29tZW9uZSBzb21lZGF5IG1pZ2h0IHdhbnQgdG8gc2V0IG1vcmUgY29tcGxleCBkcmF3YWJsZXMgaGVyZS4KICAgICAgICAgKiBUaGV5J3JlIHByb2JhYmx5IG51dHMsIGJ1dCB3ZSBtaWdodCB3YW50IHRvIGNvbnNpZGVyIHJlZ2lzdGVyaW5nIGNhbGxiYWNrcywKICAgICAgICAgKiBzZXR0aW5nIHN0YXRlcywgZXRjLiBwcm9wZXJseS4KICAgICAgICAgKi8KICAgICAgICBpZiAoU0VUX0RSQVdFUl9TSEFET1dfRlJPTV9FTEVWQVRJT04pIHsKICAgICAgICAgICAgLy8gTm8gb3AuIERyYXdlciBzaGFkb3cgd2lsbCBjb21lIGZyb20gc2V0dGluZyBhbiBlbGV2YXRpb24gb24gdGhlIGRyYXdlci4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoKGdyYXZpdHkgJiBHcmF2aXR5Q29tcGF0LlNUQVJUKSA9PSBHcmF2aXR5Q29tcGF0LlNUQVJUKSB7CiAgICAgICAgICAgIG1TaGFkb3dTdGFydCA9IHNoYWRvd0RyYXdhYmxlOwogICAgICAgIH0gZWxzZSBpZiAoKGdyYXZpdHkgJiBHcmF2aXR5Q29tcGF0LkVORCkgPT0gR3Jhdml0eUNvbXBhdC5FTkQpIHsKICAgICAgICAgICAgbVNoYWRvd0VuZCA9IHNoYWRvd0RyYXdhYmxlOwogICAgICAgIH0gZWxzZSBpZiAoKGdyYXZpdHkgJiBHcmF2aXR5LkxFRlQpID09IEdyYXZpdHkuTEVGVCkgewogICAgICAgICAgICBtU2hhZG93TGVmdCA9IHNoYWRvd0RyYXdhYmxlOwogICAgICAgIH0gZWxzZSBpZiAoKGdyYXZpdHkgJiBHcmF2aXR5LlJJR0hUKSA9PSBHcmF2aXR5LlJJR0hUKSB7CiAgICAgICAgICAgIG1TaGFkb3dSaWdodCA9IHNoYWRvd0RyYXdhYmxlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmVzb2x2ZVNoYWRvd0RyYXdhYmxlcygpOwogICAgICAgIGludmFsaWRhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIHNpbXBsZSBkcmF3YWJsZSB1c2VkIGZvciB0aGUgbGVmdCBvciByaWdodCBzaGFkb3cuIFRoZSBkcmF3YWJsZSBwcm92aWRlZCBtdXN0IGhhdmUgYQogICAgICogbm9uemVybyBpbnRyaW5zaWMgd2lkdGguIEZvciBBUEkgMjEgYW5kIGFib3ZlLCBhbiBlbGV2YXRpb24gd2lsbCBiZSBzZXQgb24gdGhlIGRyYXdlcgogICAgICogaW5zdGVhZCBvZiB1c2luZyB0aGUgcHJvdmlkZWQgc2hhZG93IGRyYXdhYmxlLgogICAgICoKICAgICAqIDxwPk5vdGUgdGhhdCBmb3IgYmV0dGVyIHN1cHBvcnQgZm9yIGJvdGggbGVmdC10by1yaWdodCBhbmQgcmlnaHQtdG8tbGVmdCBsYXlvdXQKICAgICAqIGRpcmVjdGlvbnMsIGEgZHJhd2FibGUgZm9yIFJUTCBsYXlvdXQgKGluIGFkZGl0aW9uYWwgdG8gdGhlIG9uZSBpbiBMVFIgbGF5b3V0KSBjYW4gYmUKICAgICAqIGRlZmluZWQgd2l0aCBhIHJlc291cmNlIHF1YWxpZmllciAibGRydGwiIGZvciBBUEkgMTcgYW5kIGFib3ZlIHdpdGggdGhlIGdyYXZpdHkKICAgICAqIHtAbGluayBHcmF2aXR5Q29tcGF0I1NUQVJUfS4gQWx0ZXJuYXRpdmVseSwgZm9yIEFQSSAyMyBhbmQgYWJvdmUsIHRoZSBkcmF3YWJsZSBjYW4KICAgICAqIGF1dG8tbWlycm9yZWQgc3VjaCB0aGF0IHRoZSBkcmF3YWJsZSB3aWxsIGJlIG1pcnJvcmVkIGluIFJUTCBsYXlvdXQuPC9wPgogICAgICoKICAgICAqIEBwYXJhbSByZXNJZCBSZXNvdXJjZSBpZCBvZiBhIHNoYWRvdyBkcmF3YWJsZSB0byB1c2UgYXQgdGhlIGVkZ2Ugb2YgYSBkcmF3ZXIKICAgICAqIEBwYXJhbSBncmF2aXR5IFdoaWNoIGRyYXdlciB0aGUgc2hhZG93IHNob3VsZCBhcHBseSB0bwogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREcmF3ZXJTaGFkb3coQERyYXdhYmxlUmVzIGludCByZXNJZCwgQEVkZ2VHcmF2aXR5IGludCBncmF2aXR5KSB7CiAgICAgICAgc2V0RHJhd2VyU2hhZG93KENvbnRleHRDb21wYXQuZ2V0RHJhd2FibGUoZ2V0Q29udGV4dCgpLCByZXNJZCksIGdyYXZpdHkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGEgY29sb3IgdG8gdXNlIGZvciB0aGUgc2NyaW0gdGhhdCBvYnNjdXJlcyBwcmltYXJ5IGNvbnRlbnQgd2hpbGUgYSBkcmF3ZXIgaXMgb3Blbi4KICAgICAqCiAgICAgKiBAcGFyYW0gY29sb3IgQ29sb3IgdG8gdXNlIGluIDB4QUFSUkdHQkIgZm9ybWF0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTY3JpbUNvbG9yKEBDb2xvckludCBpbnQgY29sb3IpIHsKICAgICAgICBtU2NyaW1Db2xvciA9IGNvbG9yOwogICAgICAgIGludmFsaWRhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIGxpc3RlbmVyIHRvIGJlIG5vdGlmaWVkIG9mIGRyYXdlciBldmVudHMuIE5vdGUgdGhhdCB0aGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkCiAgICAgKiBhbmQgeW91IHNob3VsZCB1c2Uge0BsaW5rICNhZGREcmF3ZXJMaXN0ZW5lcihhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5EcmF3ZXJMaXN0ZW5lcil9IHRvIGFkZCBhIGxpc3RlbmVyIGFuZAogICAgICoge0BsaW5rICNyZW1vdmVEcmF3ZXJMaXN0ZW5lcihhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5EcmF3ZXJMaXN0ZW5lcil9IHRvIHJlbW92ZSBhIHJlZ2lzdGVyZWQgbGlzdGVuZXIuCiAgICAgKgogICAgICogQHBhcmFtIGxpc3RlbmVyIExpc3RlbmVyIHRvIG5vdGlmeSB3aGVuIGRyYXdlciBldmVudHMgb2NjdXIKICAgICAqIEBkZXByZWNhdGVkIFVzZSB7QGxpbmsgI2FkZERyYXdlckxpc3RlbmVyKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkRyYXdlckxpc3RlbmVyKX0KICAgICAqIEBzZWUgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuRHJhd2VyTGlzdGVuZXIKICAgICAqIEBzZWUgI2FkZERyYXdlckxpc3RlbmVyKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkRyYXdlckxpc3RlbmVyKQogICAgICogQHNlZSAjcmVtb3ZlRHJhd2VyTGlzdGVuZXIoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuRHJhd2VyTGlzdGVuZXIpCiAgICAgKi8KICAgIEBEZXByZWNhdGVkCiAgICBwdWJsaWMgdm9pZCBzZXREcmF3ZXJMaXN0ZW5lcihhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5EcmF3ZXJMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIC8vIFRoZSBsb2dpYyBpbiB0aGlzIG1ldGhvZCBlbXVsYXRlcyB3aGF0IHdlIGhhZCBiZWZvcmUgc3VwcG9ydCBmb3IgbXVsdGlwbGUKICAgICAgICAvLyByZWdpc3RlcmVkIGxpc3RlbmVycy4KICAgICAgICBpZiAobUxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgICAgICAgcmVtb3ZlRHJhd2VyTGlzdGVuZXIobUxpc3RlbmVyKTsKICAgICAgICB9CiAgICAgICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsKICAgICAgICAgICAgYWRkRHJhd2VyTGlzdGVuZXIobGlzdGVuZXIpOwogICAgICAgIH0KICAgICAgICAvLyBVcGRhdGUgdGhlIGRlcHJlY2F0ZWQgZmllbGQgc28gdGhhdCB3ZSBjYW4gcmVtb3ZlIHRoZSBwYXNzZWQgbGlzdGVuZXIgdGhlIG5leHQKICAgICAgICAvLyB0aW1lIHdlJ3JlIGNhbGxlZAogICAgICAgIG1MaXN0ZW5lciA9IGxpc3RlbmVyOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgc3BlY2lmaWVkIGxpc3RlbmVyIHRvIHRoZSBsaXN0IG9mIGxpc3RlbmVycyB0aGF0IHdpbGwgYmUgbm90aWZpZWQgb2YgZHJhd2VyIGV2ZW50cy4KICAgICAqCiAgICAgKiBAcGFyYW0gbGlzdGVuZXIgTGlzdGVuZXIgdG8gbm90aWZ5IHdoZW4gZHJhd2VyIGV2ZW50cyBvY2N1ci4KICAgICAqIEBzZWUgI3JlbW92ZURyYXdlckxpc3RlbmVyKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkRyYXdlckxpc3RlbmVyKQogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGREcmF3ZXJMaXN0ZW5lcihATm9uTnVsbCBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5EcmF3ZXJMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIGlmIChsaXN0ZW5lciA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKG1MaXN0ZW5lcnMgPT0gbnVsbCkgewogICAgICAgICAgICBtTGlzdGVuZXJzID0gbmV3IEFycmF5TGlzdDxhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5EcmF3ZXJMaXN0ZW5lcj4oKTsKICAgICAgICB9CiAgICAgICAgbUxpc3RlbmVycy5hZGQobGlzdGVuZXIpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGxpc3RlbmVyIGZyb20gdGhlIGxpc3Qgb2YgbGlzdGVuZXJzIHRoYXQgd2lsbCBiZSBub3RpZmllZCBvZiBkcmF3ZXIKICAgICAqIGV2ZW50cy4KICAgICAqCiAgICAgKiBAcGFyYW0gbGlzdGVuZXIgTGlzdGVuZXIgdG8gcmVtb3ZlIGZyb20gYmVpbmcgbm90aWZpZWQgb2YgZHJhd2VyIGV2ZW50cwogICAgICogQHNlZSAjYWRkRHJhd2VyTGlzdGVuZXIoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuRHJhd2VyTGlzdGVuZXIpCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlbW92ZURyYXdlckxpc3RlbmVyKEBOb25OdWxsIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkRyYXdlckxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgaWYgKGxpc3RlbmVyID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAobUxpc3RlbmVycyA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIFRoaXMgY2FuIGhhcHBlbiBpZiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgYmVmb3JlIHRoZSBmaXJzdCBjYWxsIHRvIGFkZERyYXdlckxpc3RlbmVyCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbUxpc3RlbmVycy5yZW1vdmUobGlzdGVuZXIpOwogICAgfQoKICAgIC8qKgogICAgICogRW5hYmxlIG9yIGRpc2FibGUgaW50ZXJhY3Rpb24gd2l0aCBhbGwgZHJhd2Vycy4KICAgICAqCiAgICAgKiA8cD5UaGlzIGFsbG93cyB0aGUgYXBwbGljYXRpb24gdG8gcmVzdHJpY3QgdGhlIHVzZXIncyBhYmlsaXR5IHRvIG9wZW4gb3IgY2xvc2UKICAgICAqIGFueSBkcmF3ZXIgd2l0aGluIHRoaXMgbGF5b3V0LiBEcmF3ZXJMYXlvdXQgd2lsbCBzdGlsbCByZXNwb25kIHRvIGNhbGxzIHRvCiAgICAgKiB7QGxpbmsgI29wZW5EcmF3ZXIoaW50KX0sIHtAbGluayAjY2xvc2VEcmF3ZXIoaW50KX0gYW5kIGZyaWVuZHMgaWYgYSBkcmF3ZXIgaXMgbG9ja2VkLjwvcD4KICAgICAqCiAgICAgKiA8cD5Mb2NraW5nIGRyYXdlcnMgb3BlbiBvciBjbG9zZWQgd2lsbCBpbXBsaWNpdGx5IG9wZW4gb3IgY2xvc2UKICAgICAqIGFueSBkcmF3ZXJzIGFzIGFwcHJvcHJpYXRlLjwvcD4KICAgICAqCiAgICAgKiBAcGFyYW0gbG9ja01vZGUgVGhlIG5ldyBsb2NrIG1vZGUgZm9yIHRoZSBnaXZlbiBkcmF3ZXIuIE9uZSBvZiB7QGxpbmsgI0xPQ0tfTU9ERV9VTkxPQ0tFRH0sCiAgICAgKiAgICAgICAgICAgICAgICAge0BsaW5rICNMT0NLX01PREVfTE9DS0VEX0NMT1NFRH0gb3Ige0BsaW5rICNMT0NLX01PREVfTE9DS0VEX09QRU59LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREcmF3ZXJMb2NrTW9kZShATG9ja01vZGUgaW50IGxvY2tNb2RlKSB7CiAgICAgICAgc2V0RHJhd2VyTG9ja01vZGUobG9ja01vZGUsIEdyYXZpdHkuTEVGVCk7CiAgICAgICAgc2V0RHJhd2VyTG9ja01vZGUobG9ja01vZGUsIEdyYXZpdHkuUklHSFQpOwogICAgfQoKICAgIC8qKgogICAgICogRW5hYmxlIG9yIGRpc2FibGUgaW50ZXJhY3Rpb24gd2l0aCB0aGUgZ2l2ZW4gZHJhd2VyLgogICAgICoKICAgICAqIDxwPlRoaXMgYWxsb3dzIHRoZSBhcHBsaWNhdGlvbiB0byByZXN0cmljdCB0aGUgdXNlcidzIGFiaWxpdHkgdG8gb3BlbiBvciBjbG9zZQogICAgICogdGhlIGdpdmVuIGRyYXdlci4gRHJhd2VyTGF5b3V0IHdpbGwgc3RpbGwgcmVzcG9uZCB0byBjYWxscyB0byB7QGxpbmsgI29wZW5EcmF3ZXIoaW50KX0sCiAgICAgKiB7QGxpbmsgI2Nsb3NlRHJhd2VyKGludCl9IGFuZCBmcmllbmRzIGlmIGEgZHJhd2VyIGlzIGxvY2tlZC48L3A+CiAgICAgKgogICAgICogPHA+TG9ja2luZyBhIGRyYXdlciBvcGVuIG9yIGNsb3NlZCB3aWxsIGltcGxpY2l0bHkgb3BlbiBvciBjbG9zZQogICAgICogdGhhdCBkcmF3ZXIgYXMgYXBwcm9wcmlhdGUuPC9wPgogICAgICoKICAgICAqIEBwYXJhbSBsb2NrTW9kZSBUaGUgbmV3IGxvY2sgbW9kZSBmb3IgdGhlIGdpdmVuIGRyYXdlci4gT25lIG9mIHtAbGluayAjTE9DS19NT0RFX1VOTE9DS0VEfSwKICAgICAqICAgICAgICAgICAgICAgICB7QGxpbmsgI0xPQ0tfTU9ERV9MT0NLRURfQ0xPU0VEfSBvciB7QGxpbmsgI0xPQ0tfTU9ERV9MT0NLRURfT1BFTn0uCiAgICAgKiBAcGFyYW0gZWRnZUdyYXZpdHkgR3Jhdml0eS5MRUZULCBSSUdIVCwgU1RBUlQgb3IgRU5ELgogICAgICogICAgICAgICAgICAgICAgICAgIEV4cHJlc3NlcyB3aGljaCBkcmF3ZXIgdG8gY2hhbmdlIHRoZSBtb2RlIGZvci4KICAgICAqCiAgICAgKiBAc2VlICNMT0NLX01PREVfVU5MT0NLRUQKICAgICAqIEBzZWUgI0xPQ0tfTU9ERV9MT0NLRURfQ0xPU0VECiAgICAgKiBAc2VlICNMT0NLX01PREVfTE9DS0VEX09QRU4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RHJhd2VyTG9ja01vZGUoQExvY2tNb2RlIGludCBsb2NrTW9kZSwgQEVkZ2VHcmF2aXR5IGludCBlZGdlR3Jhdml0eSkgewogICAgICAgIGZpbmFsIGludCBhYnNHcmF2aXR5ID0gR3Jhdml0eUNvbXBhdC5nZXRBYnNvbHV0ZUdyYXZpdHkoZWRnZUdyYXZpdHksCiAgICAgICAgICAgICAgICBWaWV3Q29tcGF0LmdldExheW91dERpcmVjdGlvbih0aGlzKSk7CgogICAgICAgIHN3aXRjaCAoZWRnZUdyYXZpdHkpIHsKICAgICAgICAgICAgY2FzZSBHcmF2aXR5LkxFRlQ6CiAgICAgICAgICAgICAgICBtTG9ja01vZGVMZWZ0ID0gbG9ja01vZGU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBHcmF2aXR5LlJJR0hUOgogICAgICAgICAgICAgICAgbUxvY2tNb2RlUmlnaHQgPSBsb2NrTW9kZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEdyYXZpdHlDb21wYXQuU1RBUlQ6CiAgICAgICAgICAgICAgICBtTG9ja01vZGVTdGFydCA9IGxvY2tNb2RlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgR3Jhdml0eUNvbXBhdC5FTkQ6CiAgICAgICAgICAgICAgICBtTG9ja01vZGVFbmQgPSBsb2NrTW9kZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKGxvY2tNb2RlICE9IExPQ0tfTU9ERV9VTkxPQ0tFRCkgewogICAgICAgICAgICAvLyBDYW5jZWwgaW50ZXJhY3Rpb24gaW4gcHJvZ3Jlc3MKICAgICAgICAgICAgZmluYWwgVmlld0RyYWdIZWxwZXIgaGVscGVyID0gYWJzR3Jhdml0eSA9PSBHcmF2aXR5LkxFRlQgPyBtTGVmdERyYWdnZXIgOiBtUmlnaHREcmFnZ2VyOwogICAgICAgICAgICBoZWxwZXIuY2FuY2VsKCk7CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAobG9ja01vZGUpIHsKICAgICAgICAgICAgY2FzZSBMT0NLX01PREVfTE9DS0VEX09QRU46CiAgICAgICAgICAgICAgICBmaW5hbCBWaWV3IHRvT3BlbiA9IGZpbmREcmF3ZXJXaXRoR3Jhdml0eShhYnNHcmF2aXR5KTsKICAgICAgICAgICAgICAgIGlmICh0b09wZW4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIG9wZW5EcmF3ZXIodG9PcGVuKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIExPQ0tfTU9ERV9MT0NLRURfQ0xPU0VEOgogICAgICAgICAgICAgICAgZmluYWwgVmlldyB0b0Nsb3NlID0gZmluZERyYXdlcldpdGhHcmF2aXR5KGFic0dyYXZpdHkpOwogICAgICAgICAgICAgICAgaWYgKHRvQ2xvc2UgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNsb3NlRHJhd2VyKHRvQ2xvc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IGRvIG5vdGhpbmcKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmFibGUgb3IgZGlzYWJsZSBpbnRlcmFjdGlvbiB3aXRoIHRoZSBnaXZlbiBkcmF3ZXIuCiAgICAgKgogICAgICogPHA+VGhpcyBhbGxvd3MgdGhlIGFwcGxpY2F0aW9uIHRvIHJlc3RyaWN0IHRoZSB1c2VyJ3MgYWJpbGl0eSB0byBvcGVuIG9yIGNsb3NlCiAgICAgKiB0aGUgZ2l2ZW4gZHJhd2VyLiBEcmF3ZXJMYXlvdXQgd2lsbCBzdGlsbCByZXNwb25kIHRvIGNhbGxzIHRvIHtAbGluayAjb3BlbkRyYXdlcihpbnQpfSwKICAgICAqIHtAbGluayAjY2xvc2VEcmF3ZXIoaW50KX0gYW5kIGZyaWVuZHMgaWYgYSBkcmF3ZXIgaXMgbG9ja2VkLjwvcD4KICAgICAqCiAgICAgKiA8cD5Mb2NraW5nIGEgZHJhd2VyIG9wZW4gb3IgY2xvc2VkIHdpbGwgaW1wbGljaXRseSBvcGVuIG9yIGNsb3NlCiAgICAgKiB0aGF0IGRyYXdlciBhcyBhcHByb3ByaWF0ZS48L3A+CiAgICAgKgogICAgICogQHBhcmFtIGxvY2tNb2RlIFRoZSBuZXcgbG9jayBtb2RlIGZvciB0aGUgZ2l2ZW4gZHJhd2VyLiBPbmUgb2Yge0BsaW5rICNMT0NLX01PREVfVU5MT0NLRUR9LAogICAgICogICAgICAgICAgICAgICAgIHtAbGluayAjTE9DS19NT0RFX0xPQ0tFRF9DTE9TRUR9IG9yIHtAbGluayAjTE9DS19NT0RFX0xPQ0tFRF9PUEVOfS4KICAgICAqIEBwYXJhbSBkcmF3ZXJWaWV3IFRoZSBkcmF3ZXIgdmlldyB0byBjaGFuZ2UgdGhlIGxvY2sgbW9kZSBmb3IKICAgICAqCiAgICAgKiBAc2VlICNMT0NLX01PREVfVU5MT0NLRUQKICAgICAqIEBzZWUgI0xPQ0tfTU9ERV9MT0NLRURfQ0xPU0VECiAgICAgKiBAc2VlICNMT0NLX01PREVfTE9DS0VEX09QRU4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RHJhd2VyTG9ja01vZGUoQExvY2tNb2RlIGludCBsb2NrTW9kZSwgQE5vbk51bGwgVmlldyBkcmF3ZXJWaWV3KSB7CiAgICAgICAgaWYgKCFpc0RyYXdlclZpZXcoZHJhd2VyVmlldykpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiVmlldyAiICsgZHJhd2VyVmlldyArICIgaXMgbm90IGEgIgogICAgICAgICAgICAgICAgICAgICsgImRyYXdlciB3aXRoIGFwcHJvcHJpYXRlIGxheW91dF9ncmF2aXR5Iik7CiAgICAgICAgfQogICAgICAgIGZpbmFsIGludCBncmF2aXR5ID0gKChhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMpIGRyYXdlclZpZXcuZ2V0TGF5b3V0UGFyYW1zKCkpLmdyYXZpdHk7CiAgICAgICAgc2V0RHJhd2VyTG9ja01vZGUobG9ja01vZGUsIGdyYXZpdHkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgdGhlIGxvY2sgbW9kZSBvZiB0aGUgZHJhd2VyIHdpdGggdGhlIGdpdmVuIGdyYXZpdHkuCiAgICAgKgogICAgICogQHBhcmFtIGVkZ2VHcmF2aXR5IEdyYXZpdHkgb2YgdGhlIGRyYXdlciB0byBjaGVjawogICAgICogQHJldHVybiBvbmUgb2Yge0BsaW5rICNMT0NLX01PREVfVU5MT0NLRUR9LCB7QGxpbmsgI0xPQ0tfTU9ERV9MT0NLRURfQ0xPU0VEfSBvcgogICAgICogICAgICAgICB7QGxpbmsgI0xPQ0tfTU9ERV9MT0NLRURfT1BFTn0uCiAgICAgKi8KICAgIEBMb2NrTW9kZQogICAgcHVibGljIGludCBnZXREcmF3ZXJMb2NrTW9kZShARWRnZUdyYXZpdHkgaW50IGVkZ2VHcmF2aXR5KSB7CiAgICAgICAgaW50IGxheW91dERpcmVjdGlvbiA9IFZpZXdDb21wYXQuZ2V0TGF5b3V0RGlyZWN0aW9uKHRoaXMpOwoKICAgICAgICBzd2l0Y2ggKGVkZ2VHcmF2aXR5KSB7CiAgICAgICAgICAgIGNhc2UgR3Jhdml0eS5MRUZUOgogICAgICAgICAgICAgICAgaWYgKG1Mb2NrTW9kZUxlZnQgIT0gTE9DS19NT0RFX1VOREVGSU5FRCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtTG9ja01vZGVMZWZ0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW50IGxlZnRMb2NrTW9kZSA9IChsYXlvdXREaXJlY3Rpb24gPT0gVmlld0NvbXBhdC5MQVlPVVRfRElSRUNUSU9OX0xUUikKICAgICAgICAgICAgICAgICAgICAgICAgPyBtTG9ja01vZGVTdGFydCA6IG1Mb2NrTW9kZUVuZDsKICAgICAgICAgICAgICAgIGlmIChsZWZ0TG9ja01vZGUgIT0gTE9DS19NT0RFX1VOREVGSU5FRCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0TG9ja01vZGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBHcmF2aXR5LlJJR0hUOgogICAgICAgICAgICAgICAgaWYgKG1Mb2NrTW9kZVJpZ2h0ICE9IExPQ0tfTU9ERV9VTkRFRklORUQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbUxvY2tNb2RlUmlnaHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbnQgcmlnaHRMb2NrTW9kZSA9IChsYXlvdXREaXJlY3Rpb24gPT0gVmlld0NvbXBhdC5MQVlPVVRfRElSRUNUSU9OX0xUUikKICAgICAgICAgICAgICAgICAgICAgICAgPyBtTG9ja01vZGVFbmQgOiBtTG9ja01vZGVTdGFydDsKICAgICAgICAgICAgICAgIGlmIChyaWdodExvY2tNb2RlICE9IExPQ0tfTU9ERV9VTkRFRklORUQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmlnaHRMb2NrTW9kZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEdyYXZpdHlDb21wYXQuU1RBUlQ6CiAgICAgICAgICAgICAgICBpZiAobUxvY2tNb2RlU3RhcnQgIT0gTE9DS19NT0RFX1VOREVGSU5FRCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtTG9ja01vZGVTdGFydDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGludCBzdGFydExvY2tNb2RlID0gKGxheW91dERpcmVjdGlvbiA9PSBWaWV3Q29tcGF0LkxBWU9VVF9ESVJFQ1RJT05fTFRSKQogICAgICAgICAgICAgICAgICAgICAgICA/IG1Mb2NrTW9kZUxlZnQgOiBtTG9ja01vZGVSaWdodDsKICAgICAgICAgICAgICAgIGlmIChzdGFydExvY2tNb2RlICE9IExPQ0tfTU9ERV9VTkRFRklORUQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnRMb2NrTW9kZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEdyYXZpdHlDb21wYXQuRU5EOgogICAgICAgICAgICAgICAgaWYgKG1Mb2NrTW9kZUVuZCAhPSBMT0NLX01PREVfVU5ERUZJTkVEKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1Mb2NrTW9kZUVuZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGludCBlbmRMb2NrTW9kZSA9IChsYXlvdXREaXJlY3Rpb24gPT0gVmlld0NvbXBhdC5MQVlPVVRfRElSRUNUSU9OX0xUUikKICAgICAgICAgICAgICAgICAgICAgICAgPyBtTG9ja01vZGVSaWdodCA6IG1Mb2NrTW9kZUxlZnQ7CiAgICAgICAgICAgICAgICBpZiAoZW5kTG9ja01vZGUgIT0gTE9DS19NT0RFX1VOREVGSU5FRCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbmRMb2NrTW9kZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIExPQ0tfTU9ERV9VTkxPQ0tFRDsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoZSBsb2NrIG1vZGUgb2YgdGhlIGdpdmVuIGRyYXdlciB2aWV3LgogICAgICoKICAgICAqIEBwYXJhbSBkcmF3ZXJWaWV3IERyYXdlciB2aWV3IHRvIGNoZWNrIGxvY2sgbW9kZQogICAgICogQHJldHVybiBvbmUgb2Yge0BsaW5rICNMT0NLX01PREVfVU5MT0NLRUR9LCB7QGxpbmsgI0xPQ0tfTU9ERV9MT0NLRURfQ0xPU0VEfSBvcgogICAgICogICAgICAgICB7QGxpbmsgI0xPQ0tfTU9ERV9MT0NLRURfT1BFTn0uCiAgICAgKi8KICAgIEBMb2NrTW9kZQogICAgcHVibGljIGludCBnZXREcmF3ZXJMb2NrTW9kZShATm9uTnVsbCBWaWV3IGRyYXdlclZpZXcpIHsKICAgICAgICBpZiAoIWlzRHJhd2VyVmlldyhkcmF3ZXJWaWV3KSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJWaWV3ICIgKyBkcmF3ZXJWaWV3ICsgIiBpcyBub3QgYSBkcmF3ZXIiKTsKICAgICAgICB9CiAgICAgICAgZmluYWwgaW50IGRyYXdlckdyYXZpdHkgPSAoKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcykgZHJhd2VyVmlldy5nZXRMYXlvdXRQYXJhbXMoKSkuZ3Jhdml0eTsKICAgICAgICByZXR1cm4gZ2V0RHJhd2VyTG9ja01vZGUoZHJhd2VyR3Jhdml0eSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSB0aXRsZSBvZiB0aGUgZHJhd2VyIHdpdGggdGhlIGdpdmVuIGdyYXZpdHkuCiAgICAgKiA8cD4KICAgICAqIFdoZW4gYWNjZXNzaWJpbGl0eSBpcyB0dXJuZWQgb24sIHRoaXMgaXMgdGhlIHRpdGxlIHRoYXQgd2lsbCBiZSB1c2VkIHRvCiAgICAgKiBpZGVudGlmeSB0aGUgZHJhd2VyIHRvIHRoZSBhY3RpdmUgYWNjZXNzaWJpbGl0eSBzZXJ2aWNlLgogICAgICoKICAgICAqIEBwYXJhbSBlZGdlR3Jhdml0eSBHcmF2aXR5LkxFRlQsIFJJR0hULCBTVEFSVCBvciBFTkQuIEV4cHJlc3NlcyB3aGljaAogICAgICogICAgICAgICAgICBkcmF3ZXIgdG8gc2V0IHRoZSB0aXRsZSBmb3IuCiAgICAgKiBAcGFyYW0gdGl0bGUgVGhlIHRpdGxlIGZvciB0aGUgZHJhd2VyLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREcmF3ZXJUaXRsZShARWRnZUdyYXZpdHkgaW50IGVkZ2VHcmF2aXR5LCBATnVsbGFibGUgQ2hhclNlcXVlbmNlIHRpdGxlKSB7CiAgICAgICAgZmluYWwgaW50IGFic0dyYXZpdHkgPSBHcmF2aXR5Q29tcGF0LmdldEFic29sdXRlR3Jhdml0eSgKICAgICAgICAgICAgICAgIGVkZ2VHcmF2aXR5LCBWaWV3Q29tcGF0LmdldExheW91dERpcmVjdGlvbih0aGlzKSk7CiAgICAgICAgaWYgKGFic0dyYXZpdHkgPT0gR3Jhdml0eS5MRUZUKSB7CiAgICAgICAgICAgIG1UaXRsZUxlZnQgPSB0aXRsZTsKICAgICAgICB9IGVsc2UgaWYgKGFic0dyYXZpdHkgPT0gR3Jhdml0eS5SSUdIVCkgewogICAgICAgICAgICBtVGl0bGVSaWdodCA9IHRpdGxlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHRpdGxlIG9mIHRoZSBkcmF3ZXIgd2l0aCB0aGUgZ2l2ZW4gZ3Jhdml0eS4KICAgICAqCiAgICAgKiBAcGFyYW0gZWRnZUdyYXZpdHkgR3Jhdml0eS5MRUZULCBSSUdIVCwgU1RBUlQgb3IgRU5ELiBFeHByZXNzZXMgd2hpY2gKICAgICAqICAgICAgICAgICAgZHJhd2VyIHRvIHJldHVybiB0aGUgdGl0bGUgZm9yLgogICAgICogQHJldHVybiBUaGUgdGl0bGUgb2YgdGhlIGRyYXdlciwgb3IgbnVsbCBpZiBub25lIHNldC4KICAgICAqIEBzZWUgI3NldERyYXdlclRpdGxlKGludCwgQ2hhclNlcXVlbmNlKQogICAgICovCiAgICBATnVsbGFibGUKICAgIHB1YmxpYyBDaGFyU2VxdWVuY2UgZ2V0RHJhd2VyVGl0bGUoQEVkZ2VHcmF2aXR5IGludCBlZGdlR3Jhdml0eSkgewogICAgICAgIGZpbmFsIGludCBhYnNHcmF2aXR5ID0gR3Jhdml0eUNvbXBhdC5nZXRBYnNvbHV0ZUdyYXZpdHkoCiAgICAgICAgICAgICAgICBlZGdlR3Jhdml0eSwgVmlld0NvbXBhdC5nZXRMYXlvdXREaXJlY3Rpb24odGhpcykpOwogICAgICAgIGlmIChhYnNHcmF2aXR5ID09IEdyYXZpdHkuTEVGVCkgewogICAgICAgICAgICByZXR1cm4gbVRpdGxlTGVmdDsKICAgICAgICB9IGVsc2UgaWYgKGFic0dyYXZpdHkgPT0gR3Jhdml0eS5SSUdIVCkgewogICAgICAgICAgICByZXR1cm4gbVRpdGxlUmlnaHQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHggYW5kIHkgY29vcmQgaW4gRHJhd2VyTGF5b3V0J3MgY29vcmRpbmF0ZSBzcGFjZSBhcmUgaW5zaWRlIHRoZSBib3VuZHMgb2YgdGhlCiAgICAgKiBjaGlsZCdzIGNvb3JkaW5hdGUgc3BhY2UuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0luQm91bmRzT2ZDaGlsZChmbG9hdCB4LCBmbG9hdCB5LCBWaWV3IGNoaWxkKSB7CiAgICAgICAgaWYgKG1DaGlsZEhpdFJlY3QgPT0gbnVsbCkgewogICAgICAgICAgICBtQ2hpbGRIaXRSZWN0ID0gbmV3IFJlY3QoKTsKICAgICAgICB9CiAgICAgICAgY2hpbGQuZ2V0SGl0UmVjdChtQ2hpbGRIaXRSZWN0KTsKICAgICAgICByZXR1cm4gbUNoaWxkSGl0UmVjdC5jb250YWlucygoaW50KSB4LCAoaW50KSB5KTsKICAgIH0KCiAgICAvKioKICAgICAqIENvcGllZCBmcm9tIFZpZXdHcm91cCNkaXNwYXRjaFRyYW5zZm9ybWVkR2VuZXJpY1BvaW50ZXJFdmVudChNb3Rpb25FdmVudCwgVmlldykgdGhlbiBtb2RpZmllZAogICAgICogaW4gb3JkZXIgdG8gbWFrZSBjYWxscyB0aGF0IGFyZSBvdGhlcndpc2UgdG9vIHZpc2liaWxpdHkgcmVzdHJpY3RlZCB0byBtYWtlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gZGlzcGF0Y2hUcmFuc2Zvcm1lZEdlbmVyaWNQb2ludGVyRXZlbnQoTW90aW9uRXZlbnQgZXZlbnQsIFZpZXcgY2hpbGQpIHsKICAgICAgICBib29sZWFuIGhhbmRsZWQ7CiAgICAgICAgZmluYWwgTWF0cml4IGNoaWxkTWF0cml4ID0gY2hpbGQuZ2V0TWF0cml4KCk7CiAgICAgICAgaWYgKCFjaGlsZE1hdHJpeC5pc0lkZW50aXR5KCkpIHsKICAgICAgICAgICAgTW90aW9uRXZlbnQgdHJhbnNmb3JtZWRFdmVudCA9IGdldFRyYW5zZm9ybWVkTW90aW9uRXZlbnQoZXZlbnQsIGNoaWxkKTsKICAgICAgICAgICAgaGFuZGxlZCA9IGNoaWxkLmRpc3BhdGNoR2VuZXJpY01vdGlvbkV2ZW50KHRyYW5zZm9ybWVkRXZlbnQpOwogICAgICAgICAgICB0cmFuc2Zvcm1lZEV2ZW50LnJlY3ljbGUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaW5hbCBmbG9hdCBvZmZzZXRYID0gZ2V0U2Nyb2xsWCgpIC0gY2hpbGQuZ2V0TGVmdCgpOwogICAgICAgICAgICBmaW5hbCBmbG9hdCBvZmZzZXRZID0gZ2V0U2Nyb2xsWSgpIC0gY2hpbGQuZ2V0VG9wKCk7CiAgICAgICAgICAgIGV2ZW50Lm9mZnNldExvY2F0aW9uKG9mZnNldFgsIG9mZnNldFkpOwogICAgICAgICAgICBoYW5kbGVkID0gY2hpbGQuZGlzcGF0Y2hHZW5lcmljTW90aW9uRXZlbnQoZXZlbnQpOwogICAgICAgICAgICBldmVudC5vZmZzZXRMb2NhdGlvbigtb2Zmc2V0WCwgLW9mZnNldFkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaGFuZGxlZDsKICAgIH0KCiAgICAvKioKICAgICAqIENvcGllZCBmcm9tIFZpZXdHcm91cCNnZXRUcmFuc2Zvcm1lZE1vdGlvbkV2ZW50KE1vdGlvbkV2ZW50LCBWaWV3KSB0aGVuICBtb2RpZmllZCBpbiBvcmRlciB0bwogICAgICogbWFrZSBjYWxscyB0aGF0IGFyZSBvdGhlcndpc2UgdG9vIHZpc2liaWxpdHkgcmVzdHJpY3RlZCB0byBtYWtlLgogICAgICovCiAgICBwcml2YXRlIE1vdGlvbkV2ZW50IGdldFRyYW5zZm9ybWVkTW90aW9uRXZlbnQoTW90aW9uRXZlbnQgZXZlbnQsIFZpZXcgY2hpbGQpIHsKICAgICAgICBmaW5hbCBmbG9hdCBvZmZzZXRYID0gZ2V0U2Nyb2xsWCgpIC0gY2hpbGQuZ2V0TGVmdCgpOwogICAgICAgIGZpbmFsIGZsb2F0IG9mZnNldFkgPSBnZXRTY3JvbGxZKCkgLSBjaGlsZC5nZXRUb3AoKTsKICAgICAgICBmaW5hbCBNb3Rpb25FdmVudCB0cmFuc2Zvcm1lZEV2ZW50ID0gTW90aW9uRXZlbnQub2J0YWluKGV2ZW50KTsKICAgICAgICB0cmFuc2Zvcm1lZEV2ZW50Lm9mZnNldExvY2F0aW9uKG9mZnNldFgsIG9mZnNldFkpOwogICAgICAgIGZpbmFsIE1hdHJpeCBjaGlsZE1hdHJpeCA9IGNoaWxkLmdldE1hdHJpeCgpOwogICAgICAgIGlmICghY2hpbGRNYXRyaXguaXNJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIGlmIChtQ2hpbGRJbnZlcnRlZE1hdHJpeCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBtQ2hpbGRJbnZlcnRlZE1hdHJpeCA9IG5ldyBNYXRyaXgoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGlsZE1hdHJpeC5pbnZlcnQobUNoaWxkSW52ZXJ0ZWRNYXRyaXgpOwogICAgICAgICAgICB0cmFuc2Zvcm1lZEV2ZW50LnRyYW5zZm9ybShtQ2hpbGRJbnZlcnRlZE1hdHJpeCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cmFuc2Zvcm1lZEV2ZW50OwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSB0aGUgc2hhcmVkIHN0YXRlIG9mIGFsbCBkcmF3ZXJzIGZyb20gdGhlIGNvbXBvbmVudCBWaWV3RHJhZ0hlbHBlcnMuCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIGEgVmlld0RyYWdIZWxwZXIncyBzdGF0ZSBjaGFuZ2VzLgogICAgICovCiAgICB2b2lkIHVwZGF0ZURyYXdlclN0YXRlKGludCBmb3JHcmF2aXR5LCBAU3RhdGUgaW50IGFjdGl2ZVN0YXRlLCBWaWV3IGFjdGl2ZURyYXdlcikgewogICAgICAgIGZpbmFsIGludCBsZWZ0U3RhdGUgPSBtTGVmdERyYWdnZXIuZ2V0Vmlld0RyYWdTdGF0ZSgpOwogICAgICAgIGZpbmFsIGludCByaWdodFN0YXRlID0gbVJpZ2h0RHJhZ2dlci5nZXRWaWV3RHJhZ1N0YXRlKCk7CgogICAgICAgIGZpbmFsIGludCBzdGF0ZTsKICAgICAgICBpZiAobGVmdFN0YXRlID09IFNUQVRFX0RSQUdHSU5HIHx8IHJpZ2h0U3RhdGUgPT0gU1RBVEVfRFJBR0dJTkcpIHsKICAgICAgICAgICAgc3RhdGUgPSBTVEFURV9EUkFHR0lORzsKICAgICAgICB9IGVsc2UgaWYgKGxlZnRTdGF0ZSA9PSBTVEFURV9TRVRUTElORyB8fCByaWdodFN0YXRlID09IFNUQVRFX1NFVFRMSU5HKSB7CiAgICAgICAgICAgIHN0YXRlID0gU1RBVEVfU0VUVExJTkc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdGUgPSBTVEFURV9JRExFOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFjdGl2ZURyYXdlciAhPSBudWxsICYmIGFjdGl2ZVN0YXRlID09IFNUQVRFX0lETEUpIHsKICAgICAgICAgICAgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zIGxwID0gKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcykgYWN0aXZlRHJhd2VyLmdldExheW91dFBhcmFtcygpOwogICAgICAgICAgICBpZiAobHAub25TY3JlZW4gPT0gMCkgewogICAgICAgICAgICAgICAgZGlzcGF0Y2hPbkRyYXdlckNsb3NlZChhY3RpdmVEcmF3ZXIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxwLm9uU2NyZWVuID09IDEpIHsKICAgICAgICAgICAgICAgIGRpc3BhdGNoT25EcmF3ZXJPcGVuZWQoYWN0aXZlRHJhd2VyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHN0YXRlICE9IG1EcmF3ZXJTdGF0ZSkgewogICAgICAgICAgICBtRHJhd2VyU3RhdGUgPSBzdGF0ZTsKCiAgICAgICAgICAgIGlmIChtTGlzdGVuZXJzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIE5vdGlmeSB0aGUgbGlzdGVuZXJzLiBEbyB0aGF0IGZyb20gdGhlIGVuZCBvZiB0aGUgbGlzdCBzbyB0aGF0IGlmIGEgbGlzdGVuZXIKICAgICAgICAgICAgICAgIC8vIHJlbW92ZXMgaXRzZWxmIGFzIHRoZSByZXN1bHQgb2YgYmVpbmcgY2FsbGVkLCBpdCB3b24ndCBtZXNzIHVwIHdpdGggb3VyIGl0ZXJhdGlvbgogICAgICAgICAgICAgICAgaW50IGxpc3RlbmVyQ291bnQgPSBtTGlzdGVuZXJzLnNpemUoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSBsaXN0ZW5lckNvdW50IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICBtTGlzdGVuZXJzLmdldChpKS5vbkRyYXdlclN0YXRlQ2hhbmdlZChzdGF0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgdm9pZCBkaXNwYXRjaE9uRHJhd2VyQ2xvc2VkKFZpZXcgZHJhd2VyVmlldykgewogICAgICAgIGZpbmFsIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcyBscCA9IChhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMpIGRyYXdlclZpZXcuZ2V0TGF5b3V0UGFyYW1zKCk7CiAgICAgICAgaWYgKChscC5vcGVuU3RhdGUgJiBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMuRkxBR19JU19PUEVORUQpID09IDEpIHsKICAgICAgICAgICAgbHAub3BlblN0YXRlID0gMDsKCiAgICAgICAgICAgIGlmIChtTGlzdGVuZXJzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIE5vdGlmeSB0aGUgbGlzdGVuZXJzLiBEbyB0aGF0IGZyb20gdGhlIGVuZCBvZiB0aGUgbGlzdCBzbyB0aGF0IGlmIGEgbGlzdGVuZXIKICAgICAgICAgICAgICAgIC8vIHJlbW92ZXMgaXRzZWxmIGFzIHRoZSByZXN1bHQgb2YgYmVpbmcgY2FsbGVkLCBpdCB3b24ndCBtZXNzIHVwIHdpdGggb3VyIGl0ZXJhdGlvbgogICAgICAgICAgICAgICAgaW50IGxpc3RlbmVyQ291bnQgPSBtTGlzdGVuZXJzLnNpemUoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSBsaXN0ZW5lckNvdW50IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICBtTGlzdGVuZXJzLmdldChpKS5vbkRyYXdlckNsb3NlZChkcmF3ZXJWaWV3KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdXBkYXRlQ2hpbGRyZW5JbXBvcnRhbnRGb3JBY2Nlc3NpYmlsaXR5KGRyYXdlclZpZXcsIGZhbHNlKTsKCiAgICAgICAgICAgIC8vIE9ubHkgc2VuZCBXSU5ET1dfU1RBVEVfQ0hBTkdFIGlmIHRoZSBob3N0IGhhcyB3aW5kb3cgZm9jdXMuIFRoaXMKICAgICAgICAgICAgLy8gbWF5IGNoYW5nZSBpZiBzdXBwb3J0IGZvciBtdWx0aXBsZSBmb3JlZ3JvdW5kIHdpbmRvd3MgKGUuZy4gSU1FKQogICAgICAgICAgICAvLyBpbXByb3Zlcy4KICAgICAgICAgICAgaWYgKGhhc1dpbmRvd0ZvY3VzKCkpIHsKICAgICAgICAgICAgICAgIGZpbmFsIFZpZXcgcm9vdFZpZXcgPSBnZXRSb290VmlldygpOwogICAgICAgICAgICAgICAgaWYgKHJvb3RWaWV3ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICByb290Vmlldy5zZW5kQWNjZXNzaWJpbGl0eUV2ZW50KEFjY2Vzc2liaWxpdHlFdmVudC5UWVBFX1dJTkRPV19TVEFURV9DSEFOR0VEKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICB2b2lkIGRpc3BhdGNoT25EcmF3ZXJPcGVuZWQoVmlldyBkcmF3ZXJWaWV3KSB7CiAgICAgICAgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zIGxwID0gKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcykgZHJhd2VyVmlldy5nZXRMYXlvdXRQYXJhbXMoKTsKICAgICAgICBpZiAoKGxwLm9wZW5TdGF0ZSAmIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcy5GTEFHX0lTX09QRU5FRCkgPT0gMCkgewogICAgICAgICAgICBscC5vcGVuU3RhdGUgPSBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMuRkxBR19JU19PUEVORUQ7CiAgICAgICAgICAgIGlmIChtTGlzdGVuZXJzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIE5vdGlmeSB0aGUgbGlzdGVuZXJzLiBEbyB0aGF0IGZyb20gdGhlIGVuZCBvZiB0aGUgbGlzdCBzbyB0aGF0IGlmIGEgbGlzdGVuZXIKICAgICAgICAgICAgICAgIC8vIHJlbW92ZXMgaXRzZWxmIGFzIHRoZSByZXN1bHQgb2YgYmVpbmcgY2FsbGVkLCBpdCB3b24ndCBtZXNzIHVwIHdpdGggb3VyIGl0ZXJhdGlvbgogICAgICAgICAgICAgICAgaW50IGxpc3RlbmVyQ291bnQgPSBtTGlzdGVuZXJzLnNpemUoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSBsaXN0ZW5lckNvdW50IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICBtTGlzdGVuZXJzLmdldChpKS5vbkRyYXdlck9wZW5lZChkcmF3ZXJWaWV3KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdXBkYXRlQ2hpbGRyZW5JbXBvcnRhbnRGb3JBY2Nlc3NpYmlsaXR5KGRyYXdlclZpZXcsIHRydWUpOwoKICAgICAgICAgICAgLy8gT25seSBzZW5kIFdJTkRPV19TVEFURV9DSEFOR0UgaWYgdGhlIGhvc3QgaGFzIHdpbmRvdyBmb2N1cy4KICAgICAgICAgICAgaWYgKGhhc1dpbmRvd0ZvY3VzKCkpIHsKICAgICAgICAgICAgICAgIHNlbmRBY2Nlc3NpYmlsaXR5RXZlbnQoQWNjZXNzaWJpbGl0eUV2ZW50LlRZUEVfV0lORE9XX1NUQVRFX0NIQU5HRUQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCB1cGRhdGVDaGlsZHJlbkltcG9ydGFudEZvckFjY2Vzc2liaWxpdHkoVmlldyBkcmF3ZXJWaWV3LCBib29sZWFuIGlzRHJhd2VyT3BlbikgewogICAgICAgIGZpbmFsIGludCBjaGlsZENvdW50ID0gZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2hpbGRDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGZpbmFsIFZpZXcgY2hpbGQgPSBnZXRDaGlsZEF0KGkpOwogICAgICAgICAgICBpZiAoKCFpc0RyYXdlck9wZW4gJiYgIWlzRHJhd2VyVmlldyhjaGlsZCkpIHx8IChpc0RyYXdlck9wZW4gJiYgY2hpbGQgPT0gZHJhd2VyVmlldykpIHsKICAgICAgICAgICAgICAgIC8vIERyYXdlciBpcyBjbG9zZWQgYW5kIHRoaXMgaXMgYSBjb250ZW50IHZpZXcgb3IgdGhpcyBpcyBhbgogICAgICAgICAgICAgICAgLy8gb3BlbiBkcmF3ZXIgdmlldywgc28gaXQgc2hvdWxkIGJlIHZpc2libGUuCiAgICAgICAgICAgICAgICBWaWV3Q29tcGF0LnNldEltcG9ydGFudEZvckFjY2Vzc2liaWxpdHkoY2hpbGQsCiAgICAgICAgICAgICAgICAgICAgICAgIFZpZXdDb21wYXQuSU1QT1JUQU5UX0ZPUl9BQ0NFU1NJQklMSVRZX1lFUyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBWaWV3Q29tcGF0LnNldEltcG9ydGFudEZvckFjY2Vzc2liaWxpdHkoY2hpbGQsCiAgICAgICAgICAgICAgICAgICAgICAgIFZpZXdDb21wYXQuSU1QT1JUQU5UX0ZPUl9BQ0NFU1NJQklMSVRZX05PX0hJREVfREVTQ0VOREFOVFMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgZGlzcGF0Y2hPbkRyYXdlclNsaWRlKFZpZXcgZHJhd2VyVmlldywgZmxvYXQgc2xpZGVPZmZzZXQpIHsKICAgICAgICBpZiAobUxpc3RlbmVycyAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIE5vdGlmeSB0aGUgbGlzdGVuZXJzLiBEbyB0aGF0IGZyb20gdGhlIGVuZCBvZiB0aGUgbGlzdCBzbyB0aGF0IGlmIGEgbGlzdGVuZXIKICAgICAgICAgICAgLy8gcmVtb3ZlcyBpdHNlbGYgYXMgdGhlIHJlc3VsdCBvZiBiZWluZyBjYWxsZWQsIGl0IHdvbid0IG1lc3MgdXAgd2l0aCBvdXIgaXRlcmF0aW9uCiAgICAgICAgICAgIGludCBsaXN0ZW5lckNvdW50ID0gbUxpc3RlbmVycy5zaXplKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSBsaXN0ZW5lckNvdW50IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIG1MaXN0ZW5lcnMuZ2V0KGkpLm9uRHJhd2VyU2xpZGUoZHJhd2VyVmlldywgc2xpZGVPZmZzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgc2V0RHJhd2VyVmlld09mZnNldChWaWV3IGRyYXdlclZpZXcsIGZsb2F0IHNsaWRlT2Zmc2V0KSB7CiAgICAgICAgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zIGxwID0gKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcykgZHJhd2VyVmlldy5nZXRMYXlvdXRQYXJhbXMoKTsKICAgICAgICBpZiAoc2xpZGVPZmZzZXQgPT0gbHAub25TY3JlZW4pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbHAub25TY3JlZW4gPSBzbGlkZU9mZnNldDsKICAgICAgICBkaXNwYXRjaE9uRHJhd2VyU2xpZGUoZHJhd2VyVmlldywgc2xpZGVPZmZzZXQpOwogICAgfQoKICAgIGZsb2F0IGdldERyYXdlclZpZXdPZmZzZXQoVmlldyBkcmF3ZXJWaWV3KSB7CiAgICAgICAgcmV0dXJuICgoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKSBkcmF3ZXJWaWV3LmdldExheW91dFBhcmFtcygpKS5vblNjcmVlbjsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4gdGhlIGFic29sdXRlIGdyYXZpdHkgb2YgdGhlIGNoaWxkIGRyYXdlclZpZXcsIHJlc29sdmVkIGFjY29yZGluZwogICAgICogICAgICAgICB0byB0aGUgY3VycmVudCBsYXlvdXQgZGlyZWN0aW9uCiAgICAgKi8KICAgIGludCBnZXREcmF3ZXJWaWV3QWJzb2x1dGVHcmF2aXR5KFZpZXcgZHJhd2VyVmlldykgewogICAgICAgIGZpbmFsIGludCBncmF2aXR5ID0gKChhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMpIGRyYXdlclZpZXcuZ2V0TGF5b3V0UGFyYW1zKCkpLmdyYXZpdHk7CiAgICAgICAgcmV0dXJuIEdyYXZpdHlDb21wYXQuZ2V0QWJzb2x1dGVHcmF2aXR5KGdyYXZpdHksIFZpZXdDb21wYXQuZ2V0TGF5b3V0RGlyZWN0aW9uKHRoaXMpKTsKICAgIH0KCiAgICBib29sZWFuIGNoZWNrRHJhd2VyVmlld0Fic29sdXRlR3Jhdml0eShWaWV3IGRyYXdlclZpZXcsIGludCBjaGVja0ZvcikgewogICAgICAgIGZpbmFsIGludCBhYnNHcmF2aXR5ID0gZ2V0RHJhd2VyVmlld0Fic29sdXRlR3Jhdml0eShkcmF3ZXJWaWV3KTsKICAgICAgICByZXR1cm4gKGFic0dyYXZpdHkgJiBjaGVja0ZvcikgPT0gY2hlY2tGb3I7CiAgICB9CgogICAgVmlldyBmaW5kT3BlbkRyYXdlcigpIHsKICAgICAgICBmaW5hbCBpbnQgY2hpbGRDb3VudCA9IGdldENoaWxkQ291bnQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkQ291bnQ7IGkrKykgewogICAgICAgICAgICBmaW5hbCBWaWV3IGNoaWxkID0gZ2V0Q2hpbGRBdChpKTsKICAgICAgICAgICAgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zIGNoaWxkTHAgPSAoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKSBjaGlsZC5nZXRMYXlvdXRQYXJhbXMoKTsKICAgICAgICAgICAgaWYgKChjaGlsZExwLm9wZW5TdGF0ZSAmIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcy5GTEFHX0lTX09QRU5FRCkgPT0gMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHZvaWQgbW92ZURyYXdlclRvT2Zmc2V0KFZpZXcgZHJhd2VyVmlldywgZmxvYXQgc2xpZGVPZmZzZXQpIHsKICAgICAgICBmaW5hbCBmbG9hdCBvbGRPZmZzZXQgPSBnZXREcmF3ZXJWaWV3T2Zmc2V0KGRyYXdlclZpZXcpOwogICAgICAgIGZpbmFsIGludCB3aWR0aCA9IGRyYXdlclZpZXcuZ2V0V2lkdGgoKTsKICAgICAgICBmaW5hbCBpbnQgb2xkUG9zID0gKGludCkgKHdpZHRoICogb2xkT2Zmc2V0KTsKICAgICAgICBmaW5hbCBpbnQgbmV3UG9zID0gKGludCkgKHdpZHRoICogc2xpZGVPZmZzZXQpOwogICAgICAgIGZpbmFsIGludCBkeCA9IG5ld1BvcyAtIG9sZFBvczsKCiAgICAgICAgZHJhd2VyVmlldy5vZmZzZXRMZWZ0QW5kUmlnaHQoCiAgICAgICAgICAgICAgICBjaGVja0RyYXdlclZpZXdBYnNvbHV0ZUdyYXZpdHkoZHJhd2VyVmlldywgR3Jhdml0eS5MRUZUKSA/IGR4IDogLWR4KTsKICAgICAgICBzZXREcmF3ZXJWaWV3T2Zmc2V0KGRyYXdlclZpZXcsIHNsaWRlT2Zmc2V0KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBwYXJhbSBncmF2aXR5IHRoZSBncmF2aXR5IG9mIHRoZSBjaGlsZCB0byByZXR1cm4uIElmIHNwZWNpZmllZCBhcyBhCiAgICAgKiAgICAgICAgICAgIHJlbGF0aXZlIHZhbHVlLCBpdCB3aWxsIGJlIHJlc29sdmVkIGFjY29yZGluZyB0byB0aGUgY3VycmVudAogICAgICogICAgICAgICAgICBsYXlvdXQgZGlyZWN0aW9uLgogICAgICogQHJldHVybiB0aGUgZHJhd2VyIHdpdGggdGhlIHNwZWNpZmllZCBncmF2aXR5CiAgICAgKi8KICAgIFZpZXcgZmluZERyYXdlcldpdGhHcmF2aXR5KGludCBncmF2aXR5KSB7CiAgICAgICAgZmluYWwgaW50IGFic0hvcml6R3Jhdml0eSA9IEdyYXZpdHlDb21wYXQuZ2V0QWJzb2x1dGVHcmF2aXR5KAogICAgICAgICAgICAgICAgZ3Jhdml0eSwgVmlld0NvbXBhdC5nZXRMYXlvdXREaXJlY3Rpb24odGhpcykpICYgR3Jhdml0eS5IT1JJWk9OVEFMX0dSQVZJVFlfTUFTSzsKICAgICAgICBmaW5hbCBpbnQgY2hpbGRDb3VudCA9IGdldENoaWxkQ291bnQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkQ291bnQ7IGkrKykgewogICAgICAgICAgICBmaW5hbCBWaWV3IGNoaWxkID0gZ2V0Q2hpbGRBdChpKTsKICAgICAgICAgICAgZmluYWwgaW50IGNoaWxkQWJzR3Jhdml0eSA9IGdldERyYXdlclZpZXdBYnNvbHV0ZUdyYXZpdHkoY2hpbGQpOwogICAgICAgICAgICBpZiAoKGNoaWxkQWJzR3Jhdml0eSAmIEdyYXZpdHkuSE9SSVpPTlRBTF9HUkFWSVRZX01BU0spID09IGFic0hvcml6R3Jhdml0eSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogU2ltcGxlIGdyYXZpdHkgdG8gc3RyaW5nIC0gb25seSBzdXBwb3J0cyBMRUZUIGFuZCBSSUdIVCBmb3IgZGVidWdnaW5nIG91dHB1dC4KICAgICAqCiAgICAgKiBAcGFyYW0gZ3Jhdml0eSBBYnNvbHV0ZSBncmF2aXR5IHZhbHVlCiAgICAgKiBAcmV0dXJuIExFRlQgb3IgUklHSFQgYXMgYXBwcm9wcmlhdGUsIG9yIGEgaGV4IHN0cmluZwogICAgICovCiAgICBzdGF0aWMgU3RyaW5nIGdyYXZpdHlUb1N0cmluZyhARWRnZUdyYXZpdHkgaW50IGdyYXZpdHkpIHsKICAgICAgICBpZiAoKGdyYXZpdHkgJiBHcmF2aXR5LkxFRlQpID09IEdyYXZpdHkuTEVGVCkgewogICAgICAgICAgICByZXR1cm4gIkxFRlQiOwogICAgICAgIH0KICAgICAgICBpZiAoKGdyYXZpdHkgJiBHcmF2aXR5LlJJR0hUKSA9PSBHcmF2aXR5LlJJR0hUKSB7CiAgICAgICAgICAgIHJldHVybiAiUklHSFQiOwogICAgICAgIH0KICAgICAgICByZXR1cm4gSW50ZWdlci50b0hleFN0cmluZyhncmF2aXR5KTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIG9uRGV0YWNoZWRGcm9tV2luZG93KCkgewogICAgICAgIHN1cGVyLm9uRGV0YWNoZWRGcm9tV2luZG93KCk7CiAgICAgICAgbUZpcnN0TGF5b3V0ID0gdHJ1ZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIG9uQXR0YWNoZWRUb1dpbmRvdygpIHsKICAgICAgICBzdXBlci5vbkF0dGFjaGVkVG9XaW5kb3coKTsKICAgICAgICBtRmlyc3RMYXlvdXQgPSB0cnVlOwogICAgfQoKICAgIEBTdXBwcmVzc0xpbnQoIldyb25nQ29uc3RhbnQiKQogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBvbk1lYXN1cmUoaW50IHdpZHRoTWVhc3VyZVNwZWMsIGludCBoZWlnaHRNZWFzdXJlU3BlYykgewogICAgICAgIGludCB3aWR0aE1vZGUgPSBNZWFzdXJlU3BlYy5nZXRNb2RlKHdpZHRoTWVhc3VyZVNwZWMpOwogICAgICAgIGludCBoZWlnaHRNb2RlID0gTWVhc3VyZVNwZWMuZ2V0TW9kZShoZWlnaHRNZWFzdXJlU3BlYyk7CiAgICAgICAgaW50IHdpZHRoU2l6ZSA9IE1lYXN1cmVTcGVjLmdldFNpemUod2lkdGhNZWFzdXJlU3BlYyk7CiAgICAgICAgaW50IGhlaWdodFNpemUgPSBNZWFzdXJlU3BlYy5nZXRTaXplKGhlaWdodE1lYXN1cmVTcGVjKTsKCiAgICAgICAgaWYgKHdpZHRoTW9kZSAhPSBNZWFzdXJlU3BlYy5FWEFDVExZIHx8IGhlaWdodE1vZGUgIT0gTWVhc3VyZVNwZWMuRVhBQ1RMWSkgewogICAgICAgICAgICBpZiAoaXNJbkVkaXRNb2RlKCkpIHsKICAgICAgICAgICAgICAgIC8vIERvbid0IGNyYXNoIHRoZSBsYXlvdXQgZWRpdG9yLiBDb25zdW1lIGFsbCBvZiB0aGUgc3BhY2UgaWYgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICAvLyBvciBwaWNrIGEgbWFnaWMgbnVtYmVyIGZyb20gdGhpbiBhaXIgb3RoZXJ3aXNlLgogICAgICAgICAgICAgICAgLy8gVE9ETyBCZXR0ZXIgY29tbXVuaWNhdGlvbiB3aXRoIHRvb2xzIG9mIHRoaXMgYm9ndXMgc3RhdGUuCiAgICAgICAgICAgICAgICAvLyBJdCB3aWxsIGNyYXNoIG9uIGEgcmVhbCBkZXZpY2UuCiAgICAgICAgICAgICAgICBpZiAod2lkdGhNb2RlID09IE1lYXN1cmVTcGVjLkFUX01PU1QpIHsKICAgICAgICAgICAgICAgICAgICB3aWR0aE1vZGUgPSBNZWFzdXJlU3BlYy5FWEFDVExZOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aWR0aE1vZGUgPT0gTWVhc3VyZVNwZWMuVU5TUEVDSUZJRUQpIHsKICAgICAgICAgICAgICAgICAgICB3aWR0aE1vZGUgPSBNZWFzdXJlU3BlYy5FWEFDVExZOwogICAgICAgICAgICAgICAgICAgIHdpZHRoU2l6ZSA9IDMwMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChoZWlnaHRNb2RlID09IE1lYXN1cmVTcGVjLkFUX01PU1QpIHsKICAgICAgICAgICAgICAgICAgICBoZWlnaHRNb2RlID0gTWVhc3VyZVNwZWMuRVhBQ1RMWTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVpZ2h0TW9kZSA9PSBNZWFzdXJlU3BlYy5VTlNQRUNJRklFRCkgewogICAgICAgICAgICAgICAgICAgIGhlaWdodE1vZGUgPSBNZWFzdXJlU3BlYy5FWEFDVExZOwogICAgICAgICAgICAgICAgICAgIGhlaWdodFNpemUgPSAzMDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiRHJhd2VyTGF5b3V0IG11c3QgYmUgbWVhc3VyZWQgd2l0aCBNZWFzdXJlU3BlYy5FWEFDVExZLiIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzZXRNZWFzdXJlZERpbWVuc2lvbih3aWR0aFNpemUsIGhlaWdodFNpemUpOwoKICAgICAgICBmaW5hbCBib29sZWFuIGFwcGx5SW5zZXRzID0gbUxhc3RJbnNldHMgIT0gbnVsbCAmJiBWaWV3Q29tcGF0LmdldEZpdHNTeXN0ZW1XaW5kb3dzKHRoaXMpOwogICAgICAgIGZpbmFsIGludCBsYXlvdXREaXJlY3Rpb24gPSBWaWV3Q29tcGF0LmdldExheW91dERpcmVjdGlvbih0aGlzKTsKCiAgICAgICAgLy8gT25seSBvbmUgZHJhd2VyIGlzIHBlcm1pdHRlZCBhbG9uZyBlYWNoIHZlcnRpY2FsIGVkZ2UgKGxlZnQgLyByaWdodCkuIFRoZXNlIHR3byBib29sZWFucwogICAgICAgIC8vIGFyZSB0cmFja2luZyB0aGUgcHJlc2VuY2Ugb2YgdGhlIGVkZ2UgZHJhd2Vycy4KICAgICAgICBib29sZWFuIGhhc0RyYXdlck9uTGVmdEVkZ2UgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGhhc0RyYXdlck9uUmlnaHRFZGdlID0gZmFsc2U7CiAgICAgICAgZmluYWwgaW50IGNoaWxkQ291bnQgPSBnZXRDaGlsZENvdW50KCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjaGlsZENvdW50OyBpKyspIHsKICAgICAgICAgICAgZmluYWwgVmlldyBjaGlsZCA9IGdldENoaWxkQXQoaSk7CgogICAgICAgICAgICBpZiAoY2hpbGQuZ2V0VmlzaWJpbGl0eSgpID09IEdPTkUpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmaW5hbCBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMgbHAgPSAoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKSBjaGlsZC5nZXRMYXlvdXRQYXJhbXMoKTsKCiAgICAgICAgICAgIGlmIChhcHBseUluc2V0cykgewogICAgICAgICAgICAgICAgZmluYWwgaW50IGNncmF2ID0gR3Jhdml0eUNvbXBhdC5nZXRBYnNvbHV0ZUdyYXZpdHkobHAuZ3Jhdml0eSwgbGF5b3V0RGlyZWN0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChWaWV3Q29tcGF0LmdldEZpdHNTeXN0ZW1XaW5kb3dzKGNoaWxkKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChCdWlsZC5WRVJTSU9OLlNES19JTlQgPj0gMjEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgV2luZG93SW5zZXRzIHdpID0gKFdpbmRvd0luc2V0cykgbUxhc3RJbnNldHM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjZ3JhdiA9PSBHcmF2aXR5LkxFRlQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpID0gd2kucmVwbGFjZVN5c3RlbVdpbmRvd0luc2V0cyh3aS5nZXRTeXN0ZW1XaW5kb3dJbnNldExlZnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2kuZ2V0U3lzdGVtV2luZG93SW5zZXRUb3AoKSwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2kuZ2V0U3lzdGVtV2luZG93SW5zZXRCb3R0b20oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2dyYXYgPT0gR3Jhdml0eS5SSUdIVCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2kgPSB3aS5yZXBsYWNlU3lzdGVtV2luZG93SW5zZXRzKDAsIHdpLmdldFN5c3RlbVdpbmRvd0luc2V0VG9wKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpLmdldFN5c3RlbVdpbmRvd0luc2V0UmlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2kuZ2V0U3lzdGVtV2luZG93SW5zZXRCb3R0b20oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuZGlzcGF0Y2hBcHBseVdpbmRvd0luc2V0cyh3aSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoQnVpbGQuVkVSU0lPTi5TREtfSU5UID49IDIxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdpbmRvd0luc2V0cyB3aSA9IChXaW5kb3dJbnNldHMpIG1MYXN0SW5zZXRzOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2dyYXYgPT0gR3Jhdml0eS5MRUZUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aSA9IHdpLnJlcGxhY2VTeXN0ZW1XaW5kb3dJbnNldHMod2kuZ2V0U3lzdGVtV2luZG93SW5zZXRMZWZ0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpLmdldFN5c3RlbVdpbmRvd0luc2V0VG9wKCksIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpLmdldFN5c3RlbVdpbmRvd0luc2V0Qm90dG9tKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNncmF2ID09IEdyYXZpdHkuUklHSFQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpID0gd2kucmVwbGFjZVN5c3RlbVdpbmRvd0luc2V0cygwLCB3aS5nZXRTeXN0ZW1XaW5kb3dJbnNldFRvcCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aS5nZXRTeXN0ZW1XaW5kb3dJbnNldFJpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpLmdldFN5c3RlbVdpbmRvd0luc2V0Qm90dG9tKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGxwLmxlZnRNYXJnaW4gPSB3aS5nZXRTeXN0ZW1XaW5kb3dJbnNldExlZnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbHAudG9wTWFyZ2luID0gd2kuZ2V0U3lzdGVtV2luZG93SW5zZXRUb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbHAucmlnaHRNYXJnaW4gPSB3aS5nZXRTeXN0ZW1XaW5kb3dJbnNldFJpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxwLmJvdHRvbU1hcmdpbiA9IHdpLmdldFN5c3RlbVdpbmRvd0luc2V0Qm90dG9tKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNDb250ZW50VmlldyhjaGlsZCkpIHsKICAgICAgICAgICAgICAgIC8vIENvbnRlbnQgdmlld3MgZ2V0IG1lYXN1cmVkIGF0IGV4YWN0bHkgdGhlIGxheW91dCdzIHNpemUuCiAgICAgICAgICAgICAgICBmaW5hbCBpbnQgY29udGVudFdpZHRoU3BlYyA9IE1lYXN1cmVTcGVjLm1ha2VNZWFzdXJlU3BlYygKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGhTaXplIC0gbHAubGVmdE1hcmdpbiAtIGxwLnJpZ2h0TWFyZ2luLCBNZWFzdXJlU3BlYy5FWEFDVExZKTsKICAgICAgICAgICAgICAgIGZpbmFsIGludCBjb250ZW50SGVpZ2h0U3BlYyA9IE1lYXN1cmVTcGVjLm1ha2VNZWFzdXJlU3BlYygKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0U2l6ZSAtIGxwLnRvcE1hcmdpbiAtIGxwLmJvdHRvbU1hcmdpbiwgTWVhc3VyZVNwZWMuRVhBQ1RMWSk7CiAgICAgICAgICAgICAgICBjaGlsZC5tZWFzdXJlKGNvbnRlbnRXaWR0aFNwZWMsIGNvbnRlbnRIZWlnaHRTcGVjKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChpc0RyYXdlclZpZXcoY2hpbGQpKSB7CiAgICAgICAgICAgICAgICBpZiAoU0VUX0RSQVdFUl9TSEFET1dfRlJPTV9FTEVWQVRJT04pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoVmlld0NvbXBhdC5nZXRFbGV2YXRpb24oY2hpbGQpICE9IG1EcmF3ZXJFbGV2YXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgVmlld0NvbXBhdC5zZXRFbGV2YXRpb24oY2hpbGQsIG1EcmF3ZXJFbGV2YXRpb24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpbmFsIEBFZGdlR3Jhdml0eSBpbnQgY2hpbGRHcmF2aXR5ID0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RHJhd2VyVmlld0Fic29sdXRlR3Jhdml0eShjaGlsZCkgJiBHcmF2aXR5LkhPUklaT05UQUxfR1JBVklUWV9NQVNLOwogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoZSBpc0RyYXdlclZpZXcgY2hlY2sgZ3VhcmFudGVlcyB0aGF0IGNoaWxkR3Jhdml0eSBoZXJlIGlzIGVpdGhlcgogICAgICAgICAgICAgICAgLy8gTEVGVCBvciBSSUdIVAogICAgICAgICAgICAgICAgYm9vbGVhbiBpc0xlZnRFZGdlRHJhd2VyID0gKGNoaWxkR3Jhdml0eSA9PSBHcmF2aXR5LkxFRlQpOwogICAgICAgICAgICAgICAgaWYgKChpc0xlZnRFZGdlRHJhd2VyICYmIGhhc0RyYXdlck9uTGVmdEVkZ2UpCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICghaXNMZWZ0RWRnZURyYXdlciAmJiBoYXNEcmF3ZXJPblJpZ2h0RWRnZSkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJDaGlsZCBkcmF3ZXIgaGFzIGFic29sdXRlIGdyYXZpdHkgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBncmF2aXR5VG9TdHJpbmcoY2hpbGRHcmF2aXR5KSArICIgYnV0IHRoaXMgIiArIFRBRyArICIgYWxyZWFkeSBoYXMgYSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArICJkcmF3ZXIgdmlldyBhbG9uZyB0aGF0IGVkZ2UiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpc0xlZnRFZGdlRHJhd2VyKSB7CiAgICAgICAgICAgICAgICAgICAgaGFzRHJhd2VyT25MZWZ0RWRnZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGhhc0RyYXdlck9uUmlnaHRFZGdlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpbmFsIGludCBkcmF3ZXJXaWR0aFNwZWMgPSBnZXRDaGlsZE1lYXN1cmVTcGVjKHdpZHRoTWVhc3VyZVNwZWMsCiAgICAgICAgICAgICAgICAgICAgICAgIG1NaW5EcmF3ZXJNYXJnaW4gKyBscC5sZWZ0TWFyZ2luICsgbHAucmlnaHRNYXJnaW4sCiAgICAgICAgICAgICAgICAgICAgICAgIGxwLndpZHRoKTsKICAgICAgICAgICAgICAgIGZpbmFsIGludCBkcmF3ZXJIZWlnaHRTcGVjID0gZ2V0Q2hpbGRNZWFzdXJlU3BlYyhoZWlnaHRNZWFzdXJlU3BlYywKICAgICAgICAgICAgICAgICAgICAgICAgbHAudG9wTWFyZ2luICsgbHAuYm90dG9tTWFyZ2luLAogICAgICAgICAgICAgICAgICAgICAgICBscC5oZWlnaHQpOwogICAgICAgICAgICAgICAgY2hpbGQubWVhc3VyZShkcmF3ZXJXaWR0aFNwZWMsIGRyYXdlckhlaWdodFNwZWMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigiQ2hpbGQgIiArIGNoaWxkICsgIiBhdCBpbmRleCAiICsgaQogICAgICAgICAgICAgICAgICAgICAgICArICIgZG9lcyBub3QgaGF2ZSBhIHZhbGlkIGxheW91dF9ncmF2aXR5IC0gbXVzdCBiZSBHcmF2aXR5LkxFRlQsICIKICAgICAgICAgICAgICAgICAgICAgICAgKyAiR3Jhdml0eS5SSUdIVCBvciBHcmF2aXR5Lk5PX0dSQVZJVFkiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZVNoYWRvd0RyYXdhYmxlcygpIHsKICAgICAgICBpZiAoU0VUX0RSQVdFUl9TSEFET1dfRlJPTV9FTEVWQVRJT04pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBtU2hhZG93TGVmdFJlc29sdmVkID0gcmVzb2x2ZUxlZnRTaGFkb3coKTsKICAgICAgICBtU2hhZG93UmlnaHRSZXNvbHZlZCA9IHJlc29sdmVSaWdodFNoYWRvdygpOwogICAgfQoKICAgIHByaXZhdGUgRHJhd2FibGUgcmVzb2x2ZUxlZnRTaGFkb3coKSB7CiAgICAgICAgaW50IGxheW91dERpcmVjdGlvbiA9IFZpZXdDb21wYXQuZ2V0TGF5b3V0RGlyZWN0aW9uKHRoaXMpOwogICAgICAgIC8vIFByZWZlciBzaGFkb3dzIGRlZmluZWQgd2l0aCBzdGFydC9lbmQgZ3Jhdml0eSBvdmVyIGxlZnQgYW5kIHJpZ2h0LgogICAgICAgIGlmIChsYXlvdXREaXJlY3Rpb24gPT0gVmlld0NvbXBhdC5MQVlPVVRfRElSRUNUSU9OX0xUUikgewogICAgICAgICAgICBpZiAobVNoYWRvd1N0YXJ0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIENvcnJlY3QgZHJhd2FibGUgbGF5b3V0IGRpcmVjdGlvbiwgaWYgbmVlZGVkLgogICAgICAgICAgICAgICAgbWlycm9yKG1TaGFkb3dTdGFydCwgbGF5b3V0RGlyZWN0aW9uKTsKICAgICAgICAgICAgICAgIHJldHVybiBtU2hhZG93U3RhcnQ7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobVNoYWRvd0VuZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBDb3JyZWN0IGRyYXdhYmxlIGxheW91dCBkaXJlY3Rpb24sIGlmIG5lZWRlZC4KICAgICAgICAgICAgICAgIG1pcnJvcihtU2hhZG93RW5kLCBsYXlvdXREaXJlY3Rpb24pOwogICAgICAgICAgICAgICAgcmV0dXJuIG1TaGFkb3dFbmQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1TaGFkb3dMZWZ0OwogICAgfQoKICAgIHByaXZhdGUgRHJhd2FibGUgcmVzb2x2ZVJpZ2h0U2hhZG93KCkgewogICAgICAgIGludCBsYXlvdXREaXJlY3Rpb24gPSBWaWV3Q29tcGF0LmdldExheW91dERpcmVjdGlvbih0aGlzKTsKICAgICAgICBpZiAobGF5b3V0RGlyZWN0aW9uID09IFZpZXdDb21wYXQuTEFZT1VUX0RJUkVDVElPTl9MVFIpIHsKICAgICAgICAgICAgaWYgKG1TaGFkb3dFbmQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gQ29ycmVjdCBkcmF3YWJsZSBsYXlvdXQgZGlyZWN0aW9uLCBpZiBuZWVkZWQuCiAgICAgICAgICAgICAgICBtaXJyb3IobVNoYWRvd0VuZCwgbGF5b3V0RGlyZWN0aW9uKTsKICAgICAgICAgICAgICAgIHJldHVybiBtU2hhZG93RW5kOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKG1TaGFkb3dTdGFydCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBDb3JyZWN0IGRyYXdhYmxlIGxheW91dCBkaXJlY3Rpb24sIGlmIG5lZWRlZC4KICAgICAgICAgICAgICAgIG1pcnJvcihtU2hhZG93U3RhcnQsIGxheW91dERpcmVjdGlvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gbVNoYWRvd1N0YXJ0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBtU2hhZG93UmlnaHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIGxheW91dCBkaXJlY3Rpb24gb2YgdGhlIGdpdmVuIGRyYXdhYmxlLgogICAgICogUmV0dXJuIHRydWUgaWYgYXV0by1taXJyb3IgaXMgc3VwcG9ydGVkIGFuZCBkcmF3YWJsZSdzIGxheW91dCBkaXJlY3Rpb24gY2FuIGJlIGNoYW5nZWQuCiAgICAgKiBPdGhlcndpc2UsIHJldHVybiBmYWxzZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIG1pcnJvcihEcmF3YWJsZSBkcmF3YWJsZSwgaW50IGxheW91dERpcmVjdGlvbikgewogICAgICAgIGlmIChkcmF3YWJsZSA9PSBudWxsIHx8ICFEcmF3YWJsZUNvbXBhdC5pc0F1dG9NaXJyb3JlZChkcmF3YWJsZSkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgRHJhd2FibGVDb21wYXQuc2V0TGF5b3V0RGlyZWN0aW9uKGRyYXdhYmxlLCBsYXlvdXREaXJlY3Rpb24pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgb25MYXlvdXQoYm9vbGVhbiBjaGFuZ2VkLCBpbnQgbCwgaW50IHQsIGludCByLCBpbnQgYikgewogICAgICAgIG1JbkxheW91dCA9IHRydWU7CiAgICAgICAgZmluYWwgaW50IHdpZHRoID0gciAtIGw7CiAgICAgICAgZmluYWwgaW50IGNoaWxkQ291bnQgPSBnZXRDaGlsZENvdW50KCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjaGlsZENvdW50OyBpKyspIHsKICAgICAgICAgICAgZmluYWwgVmlldyBjaGlsZCA9IGdldENoaWxkQXQoaSk7CgogICAgICAgICAgICBpZiAoY2hpbGQuZ2V0VmlzaWJpbGl0eSgpID09IEdPTkUpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmaW5hbCBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMgbHAgPSAoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKSBjaGlsZC5nZXRMYXlvdXRQYXJhbXMoKTsKCiAgICAgICAgICAgIGlmIChpc0NvbnRlbnRWaWV3KGNoaWxkKSkgewogICAgICAgICAgICAgICAgY2hpbGQubGF5b3V0KGxwLmxlZnRNYXJnaW4sIGxwLnRvcE1hcmdpbiwKICAgICAgICAgICAgICAgICAgICAgICAgbHAubGVmdE1hcmdpbiArIGNoaWxkLmdldE1lYXN1cmVkV2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgbHAudG9wTWFyZ2luICsgY2hpbGQuZ2V0TWVhc3VyZWRIZWlnaHQoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7IC8vIERyYXdlciwgaWYgaXQgd2Fzbid0IG9uTWVhc3VyZSB3b3VsZCBoYXZlIHRocm93biBhbiBleGNlcHRpb24uCiAgICAgICAgICAgICAgICBmaW5hbCBpbnQgY2hpbGRXaWR0aCA9IGNoaWxkLmdldE1lYXN1cmVkV2lkdGgoKTsKICAgICAgICAgICAgICAgIGZpbmFsIGludCBjaGlsZEhlaWdodCA9IGNoaWxkLmdldE1lYXN1cmVkSGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBpbnQgY2hpbGRMZWZ0OwoKICAgICAgICAgICAgICAgIGZpbmFsIGZsb2F0IG5ld09mZnNldDsKICAgICAgICAgICAgICAgIGlmIChjaGVja0RyYXdlclZpZXdBYnNvbHV0ZUdyYXZpdHkoY2hpbGQsIEdyYXZpdHkuTEVGVCkpIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZExlZnQgPSAtY2hpbGRXaWR0aCArIChpbnQpIChjaGlsZFdpZHRoICogbHAub25TY3JlZW4pOwogICAgICAgICAgICAgICAgICAgIG5ld09mZnNldCA9IChmbG9hdCkgKGNoaWxkV2lkdGggKyBjaGlsZExlZnQpIC8gY2hpbGRXaWR0aDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIFJpZ2h0OyBvbk1lYXN1cmUgY2hlY2tlZCBmb3IgdXMuCiAgICAgICAgICAgICAgICAgICAgY2hpbGRMZWZ0ID0gd2lkdGggLSAoaW50KSAoY2hpbGRXaWR0aCAqIGxwLm9uU2NyZWVuKTsKICAgICAgICAgICAgICAgICAgICBuZXdPZmZzZXQgPSAoZmxvYXQpICh3aWR0aCAtIGNoaWxkTGVmdCkgLyBjaGlsZFdpZHRoOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZpbmFsIGJvb2xlYW4gY2hhbmdlT2Zmc2V0ID0gbmV3T2Zmc2V0ICE9IGxwLm9uU2NyZWVuOwoKICAgICAgICAgICAgICAgIGZpbmFsIGludCB2Z3JhdiA9IGxwLmdyYXZpdHkgJiBHcmF2aXR5LlZFUlRJQ0FMX0dSQVZJVFlfTUFTSzsKCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHZncmF2KSB7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjYXNlIEdyYXZpdHkuVE9QOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLmxheW91dChjaGlsZExlZnQsIGxwLnRvcE1hcmdpbiwgY2hpbGRMZWZ0ICsgY2hpbGRXaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBscC50b3BNYXJnaW4gKyBjaGlsZEhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY2FzZSBHcmF2aXR5LkJPVFRPTTogewogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBpbnQgaGVpZ2h0ID0gYiAtIHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLmxheW91dChjaGlsZExlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0IC0gbHAuYm90dG9tTWFyZ2luIC0gY2hpbGQuZ2V0TWVhc3VyZWRIZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZExlZnQgKyBjaGlsZFdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCAtIGxwLmJvdHRvbU1hcmdpbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY2FzZSBHcmF2aXR5LkNFTlRFUl9WRVJUSUNBTDogewogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBpbnQgaGVpZ2h0ID0gYiAtIHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGludCBjaGlsZFRvcCA9IChoZWlnaHQgLSBjaGlsZEhlaWdodCkgLyAyOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gT2Zmc2V0IGZvciBtYXJnaW5zLiBJZiB0aGluZ3MgZG9uJ3QgZml0IHJpZ2h0IGJlY2F1c2Ugb2YKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmFkIG1lYXN1cmVtZW50IGJlZm9yZSwgb2ggd2VsbC4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkVG9wIDwgbHAudG9wTWFyZ2luKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFRvcCA9IGxwLnRvcE1hcmdpbjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGlsZFRvcCArIGNoaWxkSGVpZ2h0ID4gaGVpZ2h0IC0gbHAuYm90dG9tTWFyZ2luKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFRvcCA9IGhlaWdodCAtIGxwLmJvdHRvbU1hcmdpbiAtIGNoaWxkSGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLmxheW91dChjaGlsZExlZnQsIGNoaWxkVG9wLCBjaGlsZExlZnQgKyBjaGlsZFdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkVG9wICsgY2hpbGRIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGNoYW5nZU9mZnNldCkgewogICAgICAgICAgICAgICAgICAgIHNldERyYXdlclZpZXdPZmZzZXQoY2hpbGQsIG5ld09mZnNldCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZmluYWwgaW50IG5ld1Zpc2liaWxpdHkgPSBscC5vblNjcmVlbiA+IDAgPyBWSVNJQkxFIDogSU5WSVNJQkxFOwogICAgICAgICAgICAgICAgaWYgKGNoaWxkLmdldFZpc2liaWxpdHkoKSAhPSBuZXdWaXNpYmlsaXR5KSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0VmlzaWJpbGl0eShuZXdWaXNpYmlsaXR5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBtSW5MYXlvdXQgPSBmYWxzZTsKICAgICAgICBtRmlyc3RMYXlvdXQgPSBmYWxzZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHJlcXVlc3RMYXlvdXQoKSB7CiAgICAgICAgaWYgKCFtSW5MYXlvdXQpIHsKICAgICAgICAgICAgc3VwZXIucmVxdWVzdExheW91dCgpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGNvbXB1dGVTY3JvbGwoKSB7CiAgICAgICAgZmluYWwgaW50IGNoaWxkQ291bnQgPSBnZXRDaGlsZENvdW50KCk7CiAgICAgICAgZmxvYXQgc2NyaW1PcGFjaXR5ID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkQ291bnQ7IGkrKykgewogICAgICAgICAgICBmaW5hbCBmbG9hdCBvbnNjcmVlbiA9ICgoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKSBnZXRDaGlsZEF0KGkpLmdldExheW91dFBhcmFtcygpKS5vblNjcmVlbjsKICAgICAgICAgICAgc2NyaW1PcGFjaXR5ID0gTWF0aC5tYXgoc2NyaW1PcGFjaXR5LCBvbnNjcmVlbik7CiAgICAgICAgfQogICAgICAgIG1TY3JpbU9wYWNpdHkgPSBzY3JpbU9wYWNpdHk7CgogICAgICAgIGJvb2xlYW4gbGVmdERyYWdnZXJTZXR0bGluZyA9IG1MZWZ0RHJhZ2dlci5jb250aW51ZVNldHRsaW5nKHRydWUpOwogICAgICAgIGJvb2xlYW4gcmlnaHREcmFnZ2VyU2V0dGxpbmcgPSBtUmlnaHREcmFnZ2VyLmNvbnRpbnVlU2V0dGxpbmcodHJ1ZSk7CiAgICAgICAgaWYgKGxlZnREcmFnZ2VyU2V0dGxpbmcgfHwgcmlnaHREcmFnZ2VyU2V0dGxpbmcpIHsKICAgICAgICAgICAgVmlld0NvbXBhdC5wb3N0SW52YWxpZGF0ZU9uQW5pbWF0aW9uKHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGhhc09wYXF1ZUJhY2tncm91bmQoVmlldyB2KSB7CiAgICAgICAgZmluYWwgRHJhd2FibGUgYmcgPSB2LmdldEJhY2tncm91bmQoKTsKICAgICAgICBpZiAoYmcgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gYmcuZ2V0T3BhY2l0eSgpID09IFBpeGVsRm9ybWF0Lk9QQVFVRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGEgZHJhd2FibGUgdG8gZHJhdyBpbiB0aGUgaW5zZXRzIGFyZWEgZm9yIHRoZSBzdGF0dXMgYmFyLgogICAgICogTm90ZSB0aGF0IHRoaXMgd2lsbCBvbmx5IGJlIGFjdGl2YXRlZCBpZiB0aGlzIERyYXdlckxheW91dCBmaXRzU3lzdGVtV2luZG93cy4KICAgICAqCiAgICAgKiBAcGFyYW0gYmcgQmFja2dyb3VuZCBkcmF3YWJsZSB0byBkcmF3IGJlaGluZCB0aGUgc3RhdHVzIGJhcgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTdGF0dXNCYXJCYWNrZ3JvdW5kKEBOdWxsYWJsZSBEcmF3YWJsZSBiZykgewogICAgICAgIG1TdGF0dXNCYXJCYWNrZ3JvdW5kID0gYmc7CiAgICAgICAgaW52YWxpZGF0ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUgZHJhd2FibGUgdXNlZCB0byBkcmF3IGluIHRoZSBpbnNldHMgYXJlYSBmb3IgdGhlIHN0YXR1cyBiYXIuCiAgICAgKgogICAgICogQHJldHVybiBUaGUgc3RhdHVzIGJhciBiYWNrZ3JvdW5kIGRyYXdhYmxlLCBvciBudWxsIGlmIG5vbmUgc2V0CiAgICAgKi8KICAgIEBOdWxsYWJsZQogICAgcHVibGljIERyYXdhYmxlIGdldFN0YXR1c0JhckJhY2tncm91bmREcmF3YWJsZSgpIHsKICAgICAgICByZXR1cm4gbVN0YXR1c0JhckJhY2tncm91bmQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYSBkcmF3YWJsZSB0byBkcmF3IGluIHRoZSBpbnNldHMgYXJlYSBmb3IgdGhlIHN0YXR1cyBiYXIuCiAgICAgKiBOb3RlIHRoYXQgdGhpcyB3aWxsIG9ubHkgYmUgYWN0aXZhdGVkIGlmIHRoaXMgRHJhd2VyTGF5b3V0IGZpdHNTeXN0ZW1XaW5kb3dzLgogICAgICoKICAgICAqIEBwYXJhbSByZXNJZCBSZXNvdXJjZSBpZCBvZiBhIGJhY2tncm91bmQgZHJhd2FibGUgdG8gZHJhdyBiZWhpbmQgdGhlIHN0YXR1cyBiYXIKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U3RhdHVzQmFyQmFja2dyb3VuZChpbnQgcmVzSWQpIHsKICAgICAgICBtU3RhdHVzQmFyQmFja2dyb3VuZCA9IHJlc0lkICE9IDAgPyBDb250ZXh0Q29tcGF0LmdldERyYXdhYmxlKGdldENvbnRleHQoKSwgcmVzSWQpIDogbnVsbDsKICAgICAgICBpbnZhbGlkYXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYSBkcmF3YWJsZSB0byBkcmF3IGluIHRoZSBpbnNldHMgYXJlYSBmb3IgdGhlIHN0YXR1cyBiYXIuCiAgICAgKiBOb3RlIHRoYXQgdGhpcyB3aWxsIG9ubHkgYmUgYWN0aXZhdGVkIGlmIHRoaXMgRHJhd2VyTGF5b3V0IGZpdHNTeXN0ZW1XaW5kb3dzLgogICAgICoKICAgICAqIEBwYXJhbSBjb2xvciBDb2xvciB0byB1c2UgYXMgYSBiYWNrZ3JvdW5kIGRyYXdhYmxlIHRvIGRyYXcgYmVoaW5kIHRoZSBzdGF0dXMgYmFyCiAgICAgKiAgICAgICAgICAgICAgaW4gMHhBQVJSR0dCQiBmb3JtYXQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFN0YXR1c0JhckJhY2tncm91bmRDb2xvcihAQ29sb3JJbnQgaW50IGNvbG9yKSB7CiAgICAgICAgbVN0YXR1c0JhckJhY2tncm91bmQgPSBuZXcgQ29sb3JEcmF3YWJsZShjb2xvcik7CiAgICAgICAgaW52YWxpZGF0ZSgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgb25SdGxQcm9wZXJ0aWVzQ2hhbmdlZChpbnQgbGF5b3V0RGlyZWN0aW9uKSB7CiAgICAgICAgcmVzb2x2ZVNoYWRvd0RyYXdhYmxlcygpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgb25EcmF3KENhbnZhcyBjKSB7CiAgICAgICAgc3VwZXIub25EcmF3KGMpOwogICAgICAgIGlmIChtRHJhd1N0YXR1c0JhckJhY2tncm91bmQgJiYgbVN0YXR1c0JhckJhY2tncm91bmQgIT0gbnVsbCkgewogICAgICAgICAgICBmaW5hbCBpbnQgaW5zZXQ7CiAgICAgICAgICAgIGlmIChCdWlsZC5WRVJTSU9OLlNES19JTlQgPj0gMjEpIHsKICAgICAgICAgICAgICAgIGluc2V0ID0gbUxhc3RJbnNldHMgIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICA/ICgoV2luZG93SW5zZXRzKSBtTGFzdEluc2V0cykuZ2V0U3lzdGVtV2luZG93SW5zZXRUb3AoKSA6IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpbnNldCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGluc2V0ID4gMCkgewogICAgICAgICAgICAgICAgbVN0YXR1c0JhckJhY2tncm91bmQuc2V0Qm91bmRzKDAsIDAsIGdldFdpZHRoKCksIGluc2V0KTsKICAgICAgICAgICAgICAgIG1TdGF0dXNCYXJCYWNrZ3JvdW5kLmRyYXcoYyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBkcmF3Q2hpbGQoQ2FudmFzIGNhbnZhcywgVmlldyBjaGlsZCwgbG9uZyBkcmF3aW5nVGltZSkgewogICAgICAgIGZpbmFsIGludCBoZWlnaHQgPSBnZXRIZWlnaHQoKTsKICAgICAgICBmaW5hbCBib29sZWFuIGRyYXdpbmdDb250ZW50ID0gaXNDb250ZW50VmlldyhjaGlsZCk7CiAgICAgICAgaW50IGNsaXBMZWZ0ID0gMCwgY2xpcFJpZ2h0ID0gZ2V0V2lkdGgoKTsKCiAgICAgICAgZmluYWwgaW50IHJlc3RvcmVDb3VudCA9IGNhbnZhcy5zYXZlKCk7CiAgICAgICAgaWYgKGRyYXdpbmdDb250ZW50KSB7CiAgICAgICAgICAgIGZpbmFsIGludCBjaGlsZENvdW50ID0gZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkQ291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgZmluYWwgVmlldyB2ID0gZ2V0Q2hpbGRBdChpKTsKICAgICAgICAgICAgICAgIGlmICh2ID09IGNoaWxkIHx8IHYuZ2V0VmlzaWJpbGl0eSgpICE9IFZJU0lCTEUKICAgICAgICAgICAgICAgICAgICAgICAgfHwgIWhhc09wYXF1ZUJhY2tncm91bmQodikgfHwgIWlzRHJhd2VyVmlldyh2KQogICAgICAgICAgICAgICAgICAgICAgICB8fCB2LmdldEhlaWdodCgpIDwgaGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGNoZWNrRHJhd2VyVmlld0Fic29sdXRlR3Jhdml0eSh2LCBHcmF2aXR5LkxFRlQpKSB7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgaW50IHZyaWdodCA9IHYuZ2V0UmlnaHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodnJpZ2h0ID4gY2xpcExlZnQpIGNsaXBMZWZ0ID0gdnJpZ2h0OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmaW5hbCBpbnQgdmxlZnQgPSB2LmdldExlZnQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodmxlZnQgPCBjbGlwUmlnaHQpIGNsaXBSaWdodCA9IHZsZWZ0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhbnZhcy5jbGlwUmVjdChjbGlwTGVmdCwgMCwgY2xpcFJpZ2h0LCBnZXRIZWlnaHQoKSk7CiAgICAgICAgfQogICAgICAgIGZpbmFsIGJvb2xlYW4gcmVzdWx0ID0gc3VwZXIuZHJhd0NoaWxkKGNhbnZhcywgY2hpbGQsIGRyYXdpbmdUaW1lKTsKICAgICAgICBjYW52YXMucmVzdG9yZVRvQ291bnQocmVzdG9yZUNvdW50KTsKCiAgICAgICAgaWYgKG1TY3JpbU9wYWNpdHkgPiAwICYmIGRyYXdpbmdDb250ZW50KSB7CiAgICAgICAgICAgIGZpbmFsIGludCBiYXNlQWxwaGEgPSAobVNjcmltQ29sb3IgJiAweGZmMDAwMDAwKSA+Pj4gMjQ7CiAgICAgICAgICAgIGZpbmFsIGludCBpbWFnID0gKGludCkgKGJhc2VBbHBoYSAqIG1TY3JpbU9wYWNpdHkpOwogICAgICAgICAgICBmaW5hbCBpbnQgY29sb3IgPSBpbWFnIDw8IDI0IHwgKG1TY3JpbUNvbG9yICYgMHhmZmZmZmYpOwogICAgICAgICAgICBtU2NyaW1QYWludC5zZXRDb2xvcihjb2xvcik7CgogICAgICAgICAgICBjYW52YXMuZHJhd1JlY3QoY2xpcExlZnQsIDAsIGNsaXBSaWdodCwgZ2V0SGVpZ2h0KCksIG1TY3JpbVBhaW50KTsKICAgICAgICB9IGVsc2UgaWYgKG1TaGFkb3dMZWZ0UmVzb2x2ZWQgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgIGNoZWNrRHJhd2VyVmlld0Fic29sdXRlR3Jhdml0eShjaGlsZCwgR3Jhdml0eS5MRUZUKSkgewogICAgICAgICAgICBmaW5hbCBpbnQgc2hhZG93V2lkdGggPSBtU2hhZG93TGVmdFJlc29sdmVkLmdldEludHJpbnNpY1dpZHRoKCk7CiAgICAgICAgICAgIGZpbmFsIGludCBjaGlsZFJpZ2h0ID0gY2hpbGQuZ2V0UmlnaHQoKTsKICAgICAgICAgICAgZmluYWwgaW50IGRyYXdlclBlZWtEaXN0YW5jZSA9IG1MZWZ0RHJhZ2dlci5nZXRFZGdlU2l6ZSgpOwogICAgICAgICAgICBmaW5hbCBmbG9hdCBhbHBoYSA9CiAgICAgICAgICAgICAgICAgICAgTWF0aC5tYXgoMCwgTWF0aC5taW4oKGZsb2F0KSBjaGlsZFJpZ2h0IC8gZHJhd2VyUGVla0Rpc3RhbmNlLCAxLmYpKTsKICAgICAgICAgICAgbVNoYWRvd0xlZnRSZXNvbHZlZC5zZXRCb3VuZHMoY2hpbGRSaWdodCwgY2hpbGQuZ2V0VG9wKCksCiAgICAgICAgICAgICAgICAgICAgY2hpbGRSaWdodCArIHNoYWRvd1dpZHRoLCBjaGlsZC5nZXRCb3R0b20oKSk7CiAgICAgICAgICAgIG1TaGFkb3dMZWZ0UmVzb2x2ZWQuc2V0QWxwaGEoKGludCkgKDB4ZmYgKiBhbHBoYSkpOwogICAgICAgICAgICBtU2hhZG93TGVmdFJlc29sdmVkLmRyYXcoY2FudmFzKTsKICAgICAgICB9IGVsc2UgaWYgKG1TaGFkb3dSaWdodFJlc29sdmVkICE9IG51bGwKICAgICAgICAgICAgICAgICYmICBjaGVja0RyYXdlclZpZXdBYnNvbHV0ZUdyYXZpdHkoY2hpbGQsIEdyYXZpdHkuUklHSFQpKSB7CiAgICAgICAgICAgIGZpbmFsIGludCBzaGFkb3dXaWR0aCA9IG1TaGFkb3dSaWdodFJlc29sdmVkLmdldEludHJpbnNpY1dpZHRoKCk7CiAgICAgICAgICAgIGZpbmFsIGludCBjaGlsZExlZnQgPSBjaGlsZC5nZXRMZWZ0KCk7CiAgICAgICAgICAgIGZpbmFsIGludCBzaG93aW5nID0gZ2V0V2lkdGgoKSAtIGNoaWxkTGVmdDsKICAgICAgICAgICAgZmluYWwgaW50IGRyYXdlclBlZWtEaXN0YW5jZSA9IG1SaWdodERyYWdnZXIuZ2V0RWRnZVNpemUoKTsKICAgICAgICAgICAgZmluYWwgZmxvYXQgYWxwaGEgPQogICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KDAsIE1hdGgubWluKChmbG9hdCkgc2hvd2luZyAvIGRyYXdlclBlZWtEaXN0YW5jZSwgMS5mKSk7CiAgICAgICAgICAgIG1TaGFkb3dSaWdodFJlc29sdmVkLnNldEJvdW5kcyhjaGlsZExlZnQgLSBzaGFkb3dXaWR0aCwgY2hpbGQuZ2V0VG9wKCksCiAgICAgICAgICAgICAgICAgICAgY2hpbGRMZWZ0LCBjaGlsZC5nZXRCb3R0b20oKSk7CiAgICAgICAgICAgIG1TaGFkb3dSaWdodFJlc29sdmVkLnNldEFscGhhKChpbnQpICgweGZmICogYWxwaGEpKTsKICAgICAgICAgICAgbVNoYWRvd1JpZ2h0UmVzb2x2ZWQuZHJhdyhjYW52YXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGJvb2xlYW4gaXNDb250ZW50VmlldyhWaWV3IGNoaWxkKSB7CiAgICAgICAgcmV0dXJuICgoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKSBjaGlsZC5nZXRMYXlvdXRQYXJhbXMoKSkuZ3Jhdml0eSA9PSBHcmF2aXR5Lk5PX0dSQVZJVFk7CiAgICB9CgogICAgYm9vbGVhbiBpc0RyYXdlclZpZXcoVmlldyBjaGlsZCkgewogICAgICAgIGZpbmFsIGludCBncmF2aXR5ID0gKChhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMpIGNoaWxkLmdldExheW91dFBhcmFtcygpKS5ncmF2aXR5OwogICAgICAgIGZpbmFsIGludCBhYnNHcmF2aXR5ID0gR3Jhdml0eUNvbXBhdC5nZXRBYnNvbHV0ZUdyYXZpdHkoZ3Jhdml0eSwKICAgICAgICAgICAgICAgIFZpZXdDb21wYXQuZ2V0TGF5b3V0RGlyZWN0aW9uKGNoaWxkKSk7CiAgICAgICAgaWYgKChhYnNHcmF2aXR5ICYgR3Jhdml0eS5MRUZUKSAhPSAwKSB7CiAgICAgICAgICAgIC8vIFRoaXMgY2hpbGQgaXMgYSBsZWZ0LWVkZ2UgZHJhd2VyCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoKGFic0dyYXZpdHkgJiBHcmF2aXR5LlJJR0hUKSAhPSAwKSB7CiAgICAgICAgICAgIC8vIFRoaXMgY2hpbGQgaXMgYSByaWdodC1lZGdlIGRyYXdlcgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJTaG9ydENpcmN1aXRCb29sZWFuIikKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJvb2xlYW4gb25JbnRlcmNlcHRUb3VjaEV2ZW50KE1vdGlvbkV2ZW50IGV2KSB7CiAgICAgICAgZmluYWwgaW50IGFjdGlvbiA9IGV2LmdldEFjdGlvbk1hc2tlZCgpOwoKICAgICAgICAvLyAifCIgdXNlZCBkZWxpYmVyYXRlbHkgaGVyZTsgYm90aCBtZXRob2RzIHNob3VsZCBiZSBpbnZva2VkLgogICAgICAgIGZpbmFsIGJvb2xlYW4gaW50ZXJjZXB0Rm9yRHJhZyA9IG1MZWZ0RHJhZ2dlci5zaG91bGRJbnRlcmNlcHRUb3VjaEV2ZW50KGV2KQogICAgICAgICAgICAgICAgfCBtUmlnaHREcmFnZ2VyLnNob3VsZEludGVyY2VwdFRvdWNoRXZlbnQoZXYpOwoKICAgICAgICBib29sZWFuIGludGVyY2VwdEZvclRhcCA9IGZhbHNlOwoKICAgICAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgICBjYXNlIE1vdGlvbkV2ZW50LkFDVElPTl9ET1dOOiB7CiAgICAgICAgICAgICAgICBmaW5hbCBmbG9hdCB4ID0gZXYuZ2V0WCgpOwogICAgICAgICAgICAgICAgZmluYWwgZmxvYXQgeSA9IGV2LmdldFkoKTsKICAgICAgICAgICAgICAgIG1Jbml0aWFsTW90aW9uWCA9IHg7CiAgICAgICAgICAgICAgICBtSW5pdGlhbE1vdGlvblkgPSB5OwogICAgICAgICAgICAgICAgaWYgKG1TY3JpbU9wYWNpdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgVmlldyBjaGlsZCA9IG1MZWZ0RHJhZ2dlci5maW5kVG9wQ2hpbGRVbmRlcigoaW50KSB4LCAoaW50KSB5KTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQgIT0gbnVsbCAmJiBpc0NvbnRlbnRWaWV3KGNoaWxkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmNlcHRGb3JUYXAgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1EaXNhbGxvd0ludGVyY2VwdFJlcXVlc3RlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgbUNoaWxkcmVuQ2FuY2VsZWRUb3VjaCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgTW90aW9uRXZlbnQuQUNUSU9OX01PVkU6IHsKICAgICAgICAgICAgICAgIC8vIElmIHdlIGNyb3NzIHRoZSB0b3VjaCBzbG9wLCBkb24ndCBwZXJmb3JtIHRoZSBkZWxheWVkIHBlZWsgZm9yIGFuIGVkZ2UgdG91Y2guCiAgICAgICAgICAgICAgICBpZiAobUxlZnREcmFnZ2VyLmNoZWNrVG91Y2hTbG9wKFZpZXdEcmFnSGVscGVyLkRJUkVDVElPTl9BTEwpKSB7CiAgICAgICAgICAgICAgICAgICAgbUxlZnRDYWxsYmFjay5yZW1vdmVDYWxsYmFja3MoKTsKICAgICAgICAgICAgICAgICAgICBtUmlnaHRDYWxsYmFjay5yZW1vdmVDYWxsYmFja3MoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlIE1vdGlvbkV2ZW50LkFDVElPTl9DQU5DRUw6CiAgICAgICAgICAgIGNhc2UgTW90aW9uRXZlbnQuQUNUSU9OX1VQOiB7CiAgICAgICAgICAgICAgICBjbG9zZURyYXdlcnModHJ1ZSk7CiAgICAgICAgICAgICAgICBtRGlzYWxsb3dJbnRlcmNlcHRSZXF1ZXN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIG1DaGlsZHJlbkNhbmNlbGVkVG91Y2ggPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGludGVyY2VwdEZvckRyYWcgfHwgaW50ZXJjZXB0Rm9yVGFwIHx8IGhhc1BlZWtpbmdEcmF3ZXIoKSB8fCBtQ2hpbGRyZW5DYW5jZWxlZFRvdWNoOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJvb2xlYW4gZGlzcGF0Y2hHZW5lcmljTW90aW9uRXZlbnQoTW90aW9uRXZlbnQgZXZlbnQpIHsKCiAgICAgICAgLy8gSWYgdGhpcyBpcyBub3QgYSBwb2ludGVyIGV2ZW50LCBvciBpZiB0aGlzIGlzIGFuIGhvdmVyIGV4aXQsIG9yIHdlIGFyZSBub3QgZGlzcGxheWluZwogICAgICAgIC8vIHRoYXQgdGhlIGNvbnRlbnQgdmlldyBjYW4ndCBiZSBpbnRlcmFjdGVkIHdpdGgsIHRoZW4gZG9uJ3Qgb3ZlcnJpZGUgYW5kIGRvIGFueXRoaW5nCiAgICAgICAgLy8gc3BlY2lhbC4KICAgICAgICBpZiAoKGV2ZW50LmdldFNvdXJjZSgpICYgSW5wdXREZXZpY2UuU09VUkNFX0NMQVNTX1BPSU5URVIpID09IDAKICAgICAgICAgICAgICAgIHx8IGV2ZW50LmdldEFjdGlvbigpID09IE1vdGlvbkV2ZW50LkFDVElPTl9IT1ZFUl9FWElUCiAgICAgICAgICAgICAgICB8fCBtU2NyaW1PcGFjaXR5IDw9IDApIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmRpc3BhdGNoR2VuZXJpY01vdGlvbkV2ZW50KGV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGZpbmFsIGludCBjaGlsZHJlbkNvdW50ID0gZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgIGlmIChjaGlsZHJlbkNvdW50ICE9IDApIHsKICAgICAgICAgICAgZmluYWwgZmxvYXQgeCA9IGV2ZW50LmdldFgoKTsKICAgICAgICAgICAgZmluYWwgZmxvYXQgeSA9IGV2ZW50LmdldFkoKTsKCiAgICAgICAgICAgIC8vIFdhbGsgdGhyb3VnaCBjaGlsZHJlbiBmcm9tIHRvcCB0byBib3R0b20uCiAgICAgICAgICAgIGZvciAoaW50IGkgPSBjaGlsZHJlbkNvdW50IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGZpbmFsIFZpZXcgY2hpbGQgPSBnZXRDaGlsZEF0KGkpOwoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBldmVudCBpcyBvdXQgb2YgYm91bmRzIG9yIHRoZSBjaGlsZCBpcyB0aGUgY29udGVudCB2aWV3LCBkb24ndCBkaXNwYXRjaAogICAgICAgICAgICAgICAgLy8gdG8gaXQuCiAgICAgICAgICAgICAgICBpZiAoIWlzSW5Cb3VuZHNPZkNoaWxkKHgsIHksIGNoaWxkKSB8fCBpc0NvbnRlbnRWaWV3KGNoaWxkKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIElmIGEgY2hpbGQgaGFuZGxlcyBpdCwgcmV0dXJuIHRydWUuCiAgICAgICAgICAgICAgICBpZiAoZGlzcGF0Y2hUcmFuc2Zvcm1lZEdlbmVyaWNQb2ludGVyRXZlbnQoZXZlbnQsIGNoaWxkKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgYm9vbGVhbiBvblRvdWNoRXZlbnQoTW90aW9uRXZlbnQgZXYpIHsKICAgICAgICBtTGVmdERyYWdnZXIucHJvY2Vzc1RvdWNoRXZlbnQoZXYpOwogICAgICAgIG1SaWdodERyYWdnZXIucHJvY2Vzc1RvdWNoRXZlbnQoZXYpOwoKICAgICAgICBmaW5hbCBpbnQgYWN0aW9uID0gZXYuZ2V0QWN0aW9uKCk7CiAgICAgICAgYm9vbGVhbiB3YW50VG91Y2hFdmVudHMgPSB0cnVlOwoKICAgICAgICBzd2l0Y2ggKGFjdGlvbiAmIE1vdGlvbkV2ZW50LkFDVElPTl9NQVNLKSB7CiAgICAgICAgICAgIGNhc2UgTW90aW9uRXZlbnQuQUNUSU9OX0RPV046IHsKICAgICAgICAgICAgICAgIGZpbmFsIGZsb2F0IHggPSBldi5nZXRYKCk7CiAgICAgICAgICAgICAgICBmaW5hbCBmbG9hdCB5ID0gZXYuZ2V0WSgpOwogICAgICAgICAgICAgICAgbUluaXRpYWxNb3Rpb25YID0geDsKICAgICAgICAgICAgICAgIG1Jbml0aWFsTW90aW9uWSA9IHk7CiAgICAgICAgICAgICAgICBtRGlzYWxsb3dJbnRlcmNlcHRSZXF1ZXN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIG1DaGlsZHJlbkNhbmNlbGVkVG91Y2ggPSBmYWxzZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlIE1vdGlvbkV2ZW50LkFDVElPTl9VUDogewogICAgICAgICAgICAgICAgZmluYWwgZmxvYXQgeCA9IGV2LmdldFgoKTsKICAgICAgICAgICAgICAgIGZpbmFsIGZsb2F0IHkgPSBldi5nZXRZKCk7CiAgICAgICAgICAgICAgICBib29sZWFuIHBlZWtpbmdPbmx5ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGZpbmFsIFZpZXcgdG91Y2hlZFZpZXcgPSBtTGVmdERyYWdnZXIuZmluZFRvcENoaWxkVW5kZXIoKGludCkgeCwgKGludCkgeSk7CiAgICAgICAgICAgICAgICBpZiAodG91Y2hlZFZpZXcgIT0gbnVsbCAmJiBpc0NvbnRlbnRWaWV3KHRvdWNoZWRWaWV3KSkgewogICAgICAgICAgICAgICAgICAgIGZpbmFsIGZsb2F0IGR4ID0geCAtIG1Jbml0aWFsTW90aW9uWDsKICAgICAgICAgICAgICAgICAgICBmaW5hbCBmbG9hdCBkeSA9IHkgLSBtSW5pdGlhbE1vdGlvblk7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgaW50IHNsb3AgPSBtTGVmdERyYWdnZXIuZ2V0VG91Y2hTbG9wKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGR4ICogZHggKyBkeSAqIGR5IDwgc2xvcCAqIHNsb3ApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGFwcyBjbG9zZSBhIGRpbW1lZCBvcGVuIGRyYXdlciBidXQgb25seSBpZiBpdCBpc24ndCBsb2NrZWQgb3Blbi4KICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgVmlldyBvcGVuRHJhd2VyID0gZmluZE9wZW5EcmF3ZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wZW5EcmF3ZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVla2luZ09ubHkgPSBnZXREcmF3ZXJMb2NrTW9kZShvcGVuRHJhd2VyKSA9PSBMT0NLX01PREVfTE9DS0VEX09QRU47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjbG9zZURyYXdlcnMocGVla2luZ09ubHkpOwogICAgICAgICAgICAgICAgbURpc2FsbG93SW50ZXJjZXB0UmVxdWVzdGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSBNb3Rpb25FdmVudC5BQ1RJT05fQ0FOQ0VMOiB7CiAgICAgICAgICAgICAgICBjbG9zZURyYXdlcnModHJ1ZSk7CiAgICAgICAgICAgICAgICBtRGlzYWxsb3dJbnRlcmNlcHRSZXF1ZXN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIG1DaGlsZHJlbkNhbmNlbGVkVG91Y2ggPSBmYWxzZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gd2FudFRvdWNoRXZlbnRzOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgcmVxdWVzdERpc2FsbG93SW50ZXJjZXB0VG91Y2hFdmVudChib29sZWFuIGRpc2FsbG93SW50ZXJjZXB0KSB7CiAgICAgICAgaWYgKENISUxEUkVOX0RJU0FMTE9XX0lOVEVSQ0VQVAogICAgICAgICAgICAgICAgfHwgKCFtTGVmdERyYWdnZXIuaXNFZGdlVG91Y2hlZChWaWV3RHJhZ0hlbHBlci5FREdFX0xFRlQpCiAgICAgICAgICAgICAgICAmJiAhbVJpZ2h0RHJhZ2dlci5pc0VkZ2VUb3VjaGVkKFZpZXdEcmFnSGVscGVyLkVER0VfUklHSFQpKSkgewogICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGFuIGVkZ2UgdG91Y2ggd2Ugd2FudCB0byBza2lwIHRoaXMgYW5kIHRyYWNrIGl0IGZvciBsYXRlciBpbnN0ZWFkLgogICAgICAgICAgICBzdXBlci5yZXF1ZXN0RGlzYWxsb3dJbnRlcmNlcHRUb3VjaEV2ZW50KGRpc2FsbG93SW50ZXJjZXB0KTsKICAgICAgICB9CiAgICAgICAgbURpc2FsbG93SW50ZXJjZXB0UmVxdWVzdGVkID0gZGlzYWxsb3dJbnRlcmNlcHQ7CiAgICAgICAgaWYgKGRpc2FsbG93SW50ZXJjZXB0KSB7CiAgICAgICAgICAgIGNsb3NlRHJhd2Vycyh0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9zZSBhbGwgY3VycmVudGx5IG9wZW4gZHJhd2VyIHZpZXdzIGJ5IGFuaW1hdGluZyB0aGVtIG91dCBvZiB2aWV3LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbG9zZURyYXdlcnMoKSB7CiAgICAgICAgY2xvc2VEcmF3ZXJzKGZhbHNlKTsKICAgIH0KCiAgICB2b2lkIGNsb3NlRHJhd2Vycyhib29sZWFuIHBlZWtpbmdPbmx5KSB7CiAgICAgICAgYm9vbGVhbiBuZWVkc0ludmFsaWRhdGUgPSBmYWxzZTsKICAgICAgICBmaW5hbCBpbnQgY2hpbGRDb3VudCA9IGdldENoaWxkQ291bnQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkQ291bnQ7IGkrKykgewogICAgICAgICAgICBmaW5hbCBWaWV3IGNoaWxkID0gZ2V0Q2hpbGRBdChpKTsKICAgICAgICAgICAgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zIGxwID0gKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcykgY2hpbGQuZ2V0TGF5b3V0UGFyYW1zKCk7CgogICAgICAgICAgICBpZiAoIWlzRHJhd2VyVmlldyhjaGlsZCkgfHwgKHBlZWtpbmdPbmx5ICYmICFscC5pc1BlZWtpbmcpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmluYWwgaW50IGNoaWxkV2lkdGggPSBjaGlsZC5nZXRXaWR0aCgpOwoKICAgICAgICAgICAgaWYgKGNoZWNrRHJhd2VyVmlld0Fic29sdXRlR3Jhdml0eShjaGlsZCwgR3Jhdml0eS5MRUZUKSkgewogICAgICAgICAgICAgICAgbmVlZHNJbnZhbGlkYXRlIHw9IG1MZWZ0RHJhZ2dlci5zbW9vdGhTbGlkZVZpZXdUbyhjaGlsZCwKICAgICAgICAgICAgICAgICAgICAgICAgLWNoaWxkV2lkdGgsIGNoaWxkLmdldFRvcCgpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5lZWRzSW52YWxpZGF0ZSB8PSBtUmlnaHREcmFnZ2VyLnNtb290aFNsaWRlVmlld1RvKGNoaWxkLAogICAgICAgICAgICAgICAgICAgICAgICBnZXRXaWR0aCgpLCBjaGlsZC5nZXRUb3AoKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxwLmlzUGVla2luZyA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgbUxlZnRDYWxsYmFjay5yZW1vdmVDYWxsYmFja3MoKTsKICAgICAgICBtUmlnaHRDYWxsYmFjay5yZW1vdmVDYWxsYmFja3MoKTsKCiAgICAgICAgaWYgKG5lZWRzSW52YWxpZGF0ZSkgewogICAgICAgICAgICBpbnZhbGlkYXRlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogT3BlbiB0aGUgc3BlY2lmaWVkIGRyYXdlciB2aWV3IGJ5IGFuaW1hdGluZyBpdCBpbnRvIHZpZXcuCiAgICAgKgogICAgICogQHBhcmFtIGRyYXdlclZpZXcgRHJhd2VyIHZpZXcgdG8gb3BlbgogICAgICovCiAgICBwdWJsaWMgdm9pZCBvcGVuRHJhd2VyKEBOb25OdWxsIFZpZXcgZHJhd2VyVmlldykgewogICAgICAgIG9wZW5EcmF3ZXIoZHJhd2VyVmlldywgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcGVuIHRoZSBzcGVjaWZpZWQgZHJhd2VyIHZpZXcuCiAgICAgKgogICAgICogQHBhcmFtIGRyYXdlclZpZXcgRHJhd2VyIHZpZXcgdG8gb3BlbgogICAgICogQHBhcmFtIGFuaW1hdGUgV2hldGhlciBvcGVuaW5nIG9mIHRoZSBkcmF3ZXIgc2hvdWxkIGJlIGFuaW1hdGVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBvcGVuRHJhd2VyKEBOb25OdWxsIFZpZXcgZHJhd2VyVmlldywgYm9vbGVhbiBhbmltYXRlKSB7CiAgICAgICAgaWYgKCFpc0RyYXdlclZpZXcoZHJhd2VyVmlldykpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiVmlldyAiICsgZHJhd2VyVmlldyArICIgaXMgbm90IGEgc2xpZGluZyBkcmF3ZXIiKTsKICAgICAgICB9CgogICAgICAgIGZpbmFsIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcyBscCA9IChhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMpIGRyYXdlclZpZXcuZ2V0TGF5b3V0UGFyYW1zKCk7CiAgICAgICAgaWYgKG1GaXJzdExheW91dCkgewogICAgICAgICAgICBscC5vblNjcmVlbiA9IDEuZjsKICAgICAgICAgICAgbHAub3BlblN0YXRlID0gYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zLkZMQUdfSVNfT1BFTkVEOwoKICAgICAgICAgICAgdXBkYXRlQ2hpbGRyZW5JbXBvcnRhbnRGb3JBY2Nlc3NpYmlsaXR5KGRyYXdlclZpZXcsIHRydWUpOwogICAgICAgIH0gZWxzZSBpZiAoYW5pbWF0ZSkgewogICAgICAgICAgICBscC5vcGVuU3RhdGUgfD0gYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zLkZMQUdfSVNfT1BFTklORzsKCiAgICAgICAgICAgIGlmIChjaGVja0RyYXdlclZpZXdBYnNvbHV0ZUdyYXZpdHkoZHJhd2VyVmlldywgR3Jhdml0eS5MRUZUKSkgewogICAgICAgICAgICAgICAgbUxlZnREcmFnZ2VyLnNtb290aFNsaWRlVmlld1RvKGRyYXdlclZpZXcsIDAsIGRyYXdlclZpZXcuZ2V0VG9wKCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbVJpZ2h0RHJhZ2dlci5zbW9vdGhTbGlkZVZpZXdUbyhkcmF3ZXJWaWV3LCBnZXRXaWR0aCgpIC0gZHJhd2VyVmlldy5nZXRXaWR0aCgpLAogICAgICAgICAgICAgICAgICAgICAgICBkcmF3ZXJWaWV3LmdldFRvcCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vdmVEcmF3ZXJUb09mZnNldChkcmF3ZXJWaWV3LCAxLmYpOwogICAgICAgICAgICB1cGRhdGVEcmF3ZXJTdGF0ZShscC5ncmF2aXR5LCBTVEFURV9JRExFLCBkcmF3ZXJWaWV3KTsKICAgICAgICAgICAgZHJhd2VyVmlldy5zZXRWaXNpYmlsaXR5KFZJU0lCTEUpOwogICAgICAgIH0KICAgICAgICBpbnZhbGlkYXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcGVuIHRoZSBzcGVjaWZpZWQgZHJhd2VyIGJ5IGFuaW1hdGluZyBpdCBvdXQgb2Ygdmlldy4KICAgICAqCiAgICAgKiBAcGFyYW0gZ3Jhdml0eSBHcmF2aXR5LkxFRlQgdG8gbW92ZSB0aGUgbGVmdCBkcmF3ZXIgb3IgR3Jhdml0eS5SSUdIVCBmb3IgdGhlIHJpZ2h0LgogICAgICogICAgICAgICAgICAgICAgR3Jhdml0eUNvbXBhdC5TVEFSVCBvciBHcmF2aXR5Q29tcGF0LkVORCBtYXkgYWxzbyBiZSB1c2VkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBvcGVuRHJhd2VyKEBFZGdlR3Jhdml0eSBpbnQgZ3Jhdml0eSkgewogICAgICAgIG9wZW5EcmF3ZXIoZ3Jhdml0eSwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcGVuIHRoZSBzcGVjaWZpZWQgZHJhd2VyLgogICAgICoKICAgICAqIEBwYXJhbSBncmF2aXR5IEdyYXZpdHkuTEVGVCB0byBtb3ZlIHRoZSBsZWZ0IGRyYXdlciBvciBHcmF2aXR5LlJJR0hUIGZvciB0aGUgcmlnaHQuCiAgICAgKiAgICAgICAgICAgICAgICBHcmF2aXR5Q29tcGF0LlNUQVJUIG9yIEdyYXZpdHlDb21wYXQuRU5EIG1heSBhbHNvIGJlIHVzZWQuCiAgICAgKiBAcGFyYW0gYW5pbWF0ZSBXaGV0aGVyIG9wZW5pbmcgb2YgdGhlIGRyYXdlciBzaG91bGQgYmUgYW5pbWF0ZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIG9wZW5EcmF3ZXIoQEVkZ2VHcmF2aXR5IGludCBncmF2aXR5LCBib29sZWFuIGFuaW1hdGUpIHsKICAgICAgICBmaW5hbCBWaWV3IGRyYXdlclZpZXcgPSBmaW5kRHJhd2VyV2l0aEdyYXZpdHkoZ3Jhdml0eSk7CiAgICAgICAgaWYgKGRyYXdlclZpZXcgPT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJObyBkcmF3ZXIgdmlldyBmb3VuZCB3aXRoIGdyYXZpdHkgIgogICAgICAgICAgICAgICAgICAgICsgZ3Jhdml0eVRvU3RyaW5nKGdyYXZpdHkpKTsKICAgICAgICB9CiAgICAgICAgb3BlbkRyYXdlcihkcmF3ZXJWaWV3LCBhbmltYXRlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBzcGVjaWZpZWQgZHJhd2VyIHZpZXcgYnkgYW5pbWF0aW5nIGl0IGludG8gdmlldy4KICAgICAqCiAgICAgKiBAcGFyYW0gZHJhd2VyVmlldyBEcmF3ZXIgdmlldyB0byBjbG9zZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbG9zZURyYXdlcihATm9uTnVsbCBWaWV3IGRyYXdlclZpZXcpIHsKICAgICAgICBjbG9zZURyYXdlcihkcmF3ZXJWaWV3LCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBzcGVjaWZpZWQgZHJhd2VyIHZpZXcuCiAgICAgKgogICAgICogQHBhcmFtIGRyYXdlclZpZXcgRHJhd2VyIHZpZXcgdG8gY2xvc2UKICAgICAqIEBwYXJhbSBhbmltYXRlIFdoZXRoZXIgY2xvc2luZyBvZiB0aGUgZHJhd2VyIHNob3VsZCBiZSBhbmltYXRlZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xvc2VEcmF3ZXIoQE5vbk51bGwgVmlldyBkcmF3ZXJWaWV3LCBib29sZWFuIGFuaW1hdGUpIHsKICAgICAgICBpZiAoIWlzRHJhd2VyVmlldyhkcmF3ZXJWaWV3KSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJWaWV3ICIgKyBkcmF3ZXJWaWV3ICsgIiBpcyBub3QgYSBzbGlkaW5nIGRyYXdlciIpOwogICAgICAgIH0KCiAgICAgICAgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zIGxwID0gKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcykgZHJhd2VyVmlldy5nZXRMYXlvdXRQYXJhbXMoKTsKICAgICAgICBpZiAobUZpcnN0TGF5b3V0KSB7CiAgICAgICAgICAgIGxwLm9uU2NyZWVuID0gMC5mOwogICAgICAgICAgICBscC5vcGVuU3RhdGUgPSAwOwogICAgICAgIH0gZWxzZSBpZiAoYW5pbWF0ZSkgewogICAgICAgICAgICBscC5vcGVuU3RhdGUgfD0gYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zLkZMQUdfSVNfQ0xPU0lORzsKCiAgICAgICAgICAgIGlmIChjaGVja0RyYXdlclZpZXdBYnNvbHV0ZUdyYXZpdHkoZHJhd2VyVmlldywgR3Jhdml0eS5MRUZUKSkgewogICAgICAgICAgICAgICAgbUxlZnREcmFnZ2VyLnNtb290aFNsaWRlVmlld1RvKGRyYXdlclZpZXcsIC1kcmF3ZXJWaWV3LmdldFdpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGRyYXdlclZpZXcuZ2V0VG9wKCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbVJpZ2h0RHJhZ2dlci5zbW9vdGhTbGlkZVZpZXdUbyhkcmF3ZXJWaWV3LCBnZXRXaWR0aCgpLCBkcmF3ZXJWaWV3LmdldFRvcCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vdmVEcmF3ZXJUb09mZnNldChkcmF3ZXJWaWV3LCAwLmYpOwogICAgICAgICAgICB1cGRhdGVEcmF3ZXJTdGF0ZShscC5ncmF2aXR5LCBTVEFURV9JRExFLCBkcmF3ZXJWaWV3KTsKICAgICAgICAgICAgZHJhd2VyVmlldy5zZXRWaXNpYmlsaXR5KElOVklTSUJMRSk7CiAgICAgICAgfQogICAgICAgIGludmFsaWRhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBzcGVjaWZpZWQgZHJhd2VyIGJ5IGFuaW1hdGluZyBpdCBvdXQgb2Ygdmlldy4KICAgICAqCiAgICAgKiBAcGFyYW0gZ3Jhdml0eSBHcmF2aXR5LkxFRlQgdG8gbW92ZSB0aGUgbGVmdCBkcmF3ZXIgb3IgR3Jhdml0eS5SSUdIVCBmb3IgdGhlIHJpZ2h0LgogICAgICogICAgICAgICAgICAgICAgR3Jhdml0eUNvbXBhdC5TVEFSVCBvciBHcmF2aXR5Q29tcGF0LkVORCBtYXkgYWxzbyBiZSB1c2VkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbG9zZURyYXdlcihARWRnZUdyYXZpdHkgaW50IGdyYXZpdHkpIHsKICAgICAgICBjbG9zZURyYXdlcihncmF2aXR5LCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBzcGVjaWZpZWQgZHJhd2VyLgogICAgICoKICAgICAqIEBwYXJhbSBncmF2aXR5IEdyYXZpdHkuTEVGVCB0byBtb3ZlIHRoZSBsZWZ0IGRyYXdlciBvciBHcmF2aXR5LlJJR0hUIGZvciB0aGUgcmlnaHQuCiAgICAgKiAgICAgICAgICAgICAgICBHcmF2aXR5Q29tcGF0LlNUQVJUIG9yIEdyYXZpdHlDb21wYXQuRU5EIG1heSBhbHNvIGJlIHVzZWQuCiAgICAgKiBAcGFyYW0gYW5pbWF0ZSBXaGV0aGVyIGNsb3Npbmcgb2YgdGhlIGRyYXdlciBzaG91bGQgYmUgYW5pbWF0ZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsb3NlRHJhd2VyKEBFZGdlR3Jhdml0eSBpbnQgZ3Jhdml0eSwgYm9vbGVhbiBhbmltYXRlKSB7CiAgICAgICAgZmluYWwgVmlldyBkcmF3ZXJWaWV3ID0gZmluZERyYXdlcldpdGhHcmF2aXR5KGdyYXZpdHkpOwogICAgICAgIGlmIChkcmF3ZXJWaWV3ID09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiTm8gZHJhd2VyIHZpZXcgZm91bmQgd2l0aCBncmF2aXR5ICIKICAgICAgICAgICAgICAgICAgICArIGdyYXZpdHlUb1N0cmluZyhncmF2aXR5KSk7CiAgICAgICAgfQogICAgICAgIGNsb3NlRHJhd2VyKGRyYXdlclZpZXcsIGFuaW1hdGUpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGdpdmVuIGRyYXdlciB2aWV3IGlzIGN1cnJlbnRseSBpbiBhbiBvcGVuIHN0YXRlLgogICAgICogVG8gYmUgY29uc2lkZXJlZCAib3BlbiIgdGhlIGRyYXdlciBtdXN0IGhhdmUgc2V0dGxlZCBpbnRvIGl0cyBmdWxseQogICAgICogdmlzaWJsZSBzdGF0ZS4gVG8gY2hlY2sgZm9yIHBhcnRpYWwgdmlzaWJpbGl0eSB1c2UKICAgICAqIHtAbGluayAjaXNEcmF3ZXJWaXNpYmxlKGFuZHJvaWQudmlldy5WaWV3KX0uCiAgICAgKgogICAgICogQHBhcmFtIGRyYXdlciBEcmF3ZXIgdmlldyB0byBjaGVjawogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiBkcmF3ZXIgdmlldyBpcyBpbiBhbiBvcGVuIHN0YXRlCiAgICAgKiBAc2VlICNpc0RyYXdlclZpc2libGUoYW5kcm9pZC52aWV3LlZpZXcpCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRHJhd2VyT3BlbihATm9uTnVsbCBWaWV3IGRyYXdlcikgewogICAgICAgIGlmICghaXNEcmF3ZXJWaWV3KGRyYXdlcikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiVmlldyAiICsgZHJhd2VyICsgIiBpcyBub3QgYSBkcmF3ZXIiKTsKICAgICAgICB9CiAgICAgICAgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zIGRyYXdlckxwID0gKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcykgZHJhd2VyLmdldExheW91dFBhcmFtcygpOwogICAgICAgIHJldHVybiAoZHJhd2VyTHAub3BlblN0YXRlICYgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zLkZMQUdfSVNfT1BFTkVEKSA9PSAxOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGdpdmVuIGRyYXdlciB2aWV3IGlzIGN1cnJlbnRseSBpbiBhbiBvcGVuIHN0YXRlLgogICAgICogVG8gYmUgY29uc2lkZXJlZCAib3BlbiIgdGhlIGRyYXdlciBtdXN0IGhhdmUgc2V0dGxlZCBpbnRvIGl0cyBmdWxseQogICAgICogdmlzaWJsZSBzdGF0ZS4gSWYgdGhlcmUgaXMgbm8gZHJhd2VyIHdpdGggdGhlIGdpdmVuIGdyYXZpdHkgdGhpcyBtZXRob2QKICAgICAqIHdpbGwgcmV0dXJuIGZhbHNlLgogICAgICoKICAgICAqIEBwYXJhbSBkcmF3ZXJHcmF2aXR5IEdyYXZpdHkgb2YgdGhlIGRyYXdlciB0byBjaGVjawogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiBkcmF3ZXIgdmlldyBpcyBpbiBhbiBvcGVuIHN0YXRlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRHJhd2VyT3BlbihARWRnZUdyYXZpdHkgaW50IGRyYXdlckdyYXZpdHkpIHsKICAgICAgICBmaW5hbCBWaWV3IGRyYXdlclZpZXcgPSBmaW5kRHJhd2VyV2l0aEdyYXZpdHkoZHJhd2VyR3Jhdml0eSk7CiAgICAgICAgaWYgKGRyYXdlclZpZXcgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gaXNEcmF3ZXJPcGVuKGRyYXdlclZpZXcpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGdpdmVuIGRyYXdlciB2aWV3IGlzIGN1cnJlbnRseSB2aXNpYmxlIG9uLXNjcmVlbi4gVGhlIGRyYXdlcgogICAgICogbWF5IGJlIG9ubHkgcGVla2luZyBvbnRvIHRoZSBzY3JlZW4sIGZ1bGx5IGV4dGVuZGVkLCBvciBhbnl3aGVyZSBpbmJldHdlZW4uCiAgICAgKgogICAgICogQHBhcmFtIGRyYXdlciBEcmF3ZXIgdmlldyB0byBjaGVjawogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiBkcmF3ZXIgaXMgdmlzaWJsZSBvbi1zY3JlZW4KICAgICAqIEBzZWUgI2lzRHJhd2VyT3BlbihhbmRyb2lkLnZpZXcuVmlldykKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEcmF3ZXJWaXNpYmxlKEBOb25OdWxsIFZpZXcgZHJhd2VyKSB7CiAgICAgICAgaWYgKCFpc0RyYXdlclZpZXcoZHJhd2VyKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJWaWV3ICIgKyBkcmF3ZXIgKyAiIGlzIG5vdCBhIGRyYXdlciIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKChhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMpIGRyYXdlci5nZXRMYXlvdXRQYXJhbXMoKSkub25TY3JlZW4gPiAwOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBnaXZlbiBkcmF3ZXIgdmlldyBpcyBjdXJyZW50bHkgdmlzaWJsZSBvbi1zY3JlZW4uIFRoZSBkcmF3ZXIKICAgICAqIG1heSBiZSBvbmx5IHBlZWtpbmcgb250byB0aGUgc2NyZWVuLCBmdWxseSBleHRlbmRlZCwgb3IgYW55d2hlcmUgaW4gYmV0d2Vlbi4KICAgICAqIElmIHRoZXJlIGlzIG5vIGRyYXdlciB3aXRoIHRoZSBnaXZlbiBncmF2aXR5IHRoaXMgbWV0aG9kIHdpbGwgcmV0dXJuIGZhbHNlLgogICAgICoKICAgICAqIEBwYXJhbSBkcmF3ZXJHcmF2aXR5IEdyYXZpdHkgb2YgdGhlIGRyYXdlciB0byBjaGVjawogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBnaXZlbiBkcmF3ZXIgaXMgdmlzaWJsZSBvbi1zY3JlZW4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEcmF3ZXJWaXNpYmxlKEBFZGdlR3Jhdml0eSBpbnQgZHJhd2VyR3Jhdml0eSkgewogICAgICAgIGZpbmFsIFZpZXcgZHJhd2VyVmlldyA9IGZpbmREcmF3ZXJXaXRoR3Jhdml0eShkcmF3ZXJHcmF2aXR5KTsKICAgICAgICBpZiAoZHJhd2VyVmlldyAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBpc0RyYXdlclZpc2libGUoZHJhd2VyVmlldyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gaGFzUGVla2luZ0RyYXdlcigpIHsKICAgICAgICBmaW5hbCBpbnQgY2hpbGRDb3VudCA9IGdldENoaWxkQ291bnQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkQ291bnQ7IGkrKykgewogICAgICAgICAgICBmaW5hbCBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMgbHAgPSAoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKSBnZXRDaGlsZEF0KGkpLmdldExheW91dFBhcmFtcygpOwogICAgICAgICAgICBpZiAobHAuaXNQZWVraW5nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgVmlld0dyb3VwLkxheW91dFBhcmFtcyBnZW5lcmF0ZURlZmF1bHRMYXlvdXRQYXJhbXMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zLk1BVENIX1BBUkVOVCwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zLk1BVENIX1BBUkVOVCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgVmlld0dyb3VwLkxheW91dFBhcmFtcyBnZW5lcmF0ZUxheW91dFBhcmFtcyhWaWV3R3JvdXAuTGF5b3V0UGFyYW1zIHApIHsKICAgICAgICByZXR1cm4gcCBpbnN0YW5jZW9mIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcwogICAgICAgICAgICAgICAgPyBuZXcgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKChhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMpIHApCiAgICAgICAgICAgICAgICA6IHAgaW5zdGFuY2VvZiBWaWV3R3JvdXAuTWFyZ2luTGF5b3V0UGFyYW1zCiAgICAgICAgICAgICAgICA/IG5ldyBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMoKE1hcmdpbkxheW91dFBhcmFtcykgcCkKICAgICAgICAgICAgICAgIDogbmV3IGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcyhwKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBib29sZWFuIGNoZWNrTGF5b3V0UGFyYW1zKFZpZXdHcm91cC5MYXlvdXRQYXJhbXMgcCkgewogICAgICAgIHJldHVybiBwIGluc3RhbmNlb2YgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zICYmIHN1cGVyLmNoZWNrTGF5b3V0UGFyYW1zKHApOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFZpZXdHcm91cC5MYXlvdXRQYXJhbXMgZ2VuZXJhdGVMYXlvdXRQYXJhbXMoQXR0cmlidXRlU2V0IGF0dHJzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMoZ2V0Q29udGV4dCgpLCBhdHRycyk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBhZGRGb2N1c2FibGVzKEFycmF5TGlzdDxWaWV3PiB2aWV3cywgaW50IGRpcmVjdGlvbiwgaW50IGZvY3VzYWJsZU1vZGUpIHsKICAgICAgICBpZiAoZ2V0RGVzY2VuZGFudEZvY3VzYWJpbGl0eSgpID09IEZPQ1VTX0JMT0NLX0RFU0NFTkRBTlRTKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIE9ubHkgdGhlIHZpZXdzIGluIHRoZSBvcGVuIGRyYXdlcnMgYXJlIGZvY3VzYWJsZXMuIEFkZCBub3JtYWwgY2hpbGQgdmlld3Mgd2hlbgogICAgICAgIC8vIG5vIGRyYXdlcnMgYXJlIG9wZW5lZC4KICAgICAgICBmaW5hbCBpbnQgY2hpbGRDb3VudCA9IGdldENoaWxkQ291bnQoKTsKICAgICAgICBib29sZWFuIGlzRHJhd2VyT3BlbiA9IGZhbHNlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2hpbGRDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGZpbmFsIFZpZXcgY2hpbGQgPSBnZXRDaGlsZEF0KGkpOwogICAgICAgICAgICBpZiAoaXNEcmF3ZXJWaWV3KGNoaWxkKSkgewogICAgICAgICAgICAgICAgaWYgKGlzRHJhd2VyT3BlbihjaGlsZCkpIHsKICAgICAgICAgICAgICAgICAgICBpc0RyYXdlck9wZW4gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNoaWxkLmFkZEZvY3VzYWJsZXModmlld3MsIGRpcmVjdGlvbiwgZm9jdXNhYmxlTW9kZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtTm9uRHJhd2VyVmlld3MuYWRkKGNoaWxkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCFpc0RyYXdlck9wZW4pIHsKICAgICAgICAgICAgZmluYWwgaW50IG5vbkRyYXdlclZpZXdzQ291bnQgPSBtTm9uRHJhd2VyVmlld3Muc2l6ZSgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG5vbkRyYXdlclZpZXdzQ291bnQ7ICsraSkgewogICAgICAgICAgICAgICAgZmluYWwgVmlldyBjaGlsZCA9IG1Ob25EcmF3ZXJWaWV3cy5nZXQoaSk7CiAgICAgICAgICAgICAgICBpZiAoY2hpbGQuZ2V0VmlzaWJpbGl0eSgpID09IFZpZXcuVklTSUJMRSkgewogICAgICAgICAgICAgICAgICAgIGNoaWxkLmFkZEZvY3VzYWJsZXModmlld3MsIGRpcmVjdGlvbiwgZm9jdXNhYmxlTW9kZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG1Ob25EcmF3ZXJWaWV3cy5jbGVhcigpOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBoYXNWaXNpYmxlRHJhd2VyKCkgewogICAgICAgIHJldHVybiBmaW5kVmlzaWJsZURyYXdlcigpICE9IG51bGw7CiAgICB9CgogICAgVmlldyBmaW5kVmlzaWJsZURyYXdlcigpIHsKICAgICAgICBmaW5hbCBpbnQgY2hpbGRDb3VudCA9IGdldENoaWxkQ291bnQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkQ291bnQ7IGkrKykgewogICAgICAgICAgICBmaW5hbCBWaWV3IGNoaWxkID0gZ2V0Q2hpbGRBdChpKTsKICAgICAgICAgICAgaWYgKGlzRHJhd2VyVmlldyhjaGlsZCkgJiYgaXNEcmF3ZXJWaXNpYmxlKGNoaWxkKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHZvaWQgY2FuY2VsQ2hpbGRWaWV3VG91Y2goKSB7CiAgICAgICAgLy8gQ2FuY2VsIGNoaWxkIHRvdWNoZXMKICAgICAgICBpZiAoIW1DaGlsZHJlbkNhbmNlbGVkVG91Y2gpIHsKICAgICAgICAgICAgZmluYWwgbG9uZyBub3cgPSBTeXN0ZW1DbG9jay51cHRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgZmluYWwgTW90aW9uRXZlbnQgY2FuY2VsRXZlbnQgPSBNb3Rpb25FdmVudC5vYnRhaW4obm93LCBub3csCiAgICAgICAgICAgICAgICAgICAgTW90aW9uRXZlbnQuQUNUSU9OX0NBTkNFTCwgMC4wZiwgMC4wZiwgMCk7CiAgICAgICAgICAgIGZpbmFsIGludCBjaGlsZENvdW50ID0gZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNoaWxkQ291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgZ2V0Q2hpbGRBdChpKS5kaXNwYXRjaFRvdWNoRXZlbnQoY2FuY2VsRXZlbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhbmNlbEV2ZW50LnJlY3ljbGUoKTsKICAgICAgICAgICAgbUNoaWxkcmVuQ2FuY2VsZWRUb3VjaCA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJvb2xlYW4gb25LZXlEb3duKGludCBrZXlDb2RlLCBLZXlFdmVudCBldmVudCkgewogICAgICAgIGlmIChrZXlDb2RlID09IEtleUV2ZW50LktFWUNPREVfQkFDSyAmJiBoYXNWaXNpYmxlRHJhd2VyKCkpIHsKICAgICAgICAgICAgZXZlbnQuc3RhcnRUcmFja2luZygpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cGVyLm9uS2V5RG93bihrZXlDb2RlLCBldmVudCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgYm9vbGVhbiBvbktleVVwKGludCBrZXlDb2RlLCBLZXlFdmVudCBldmVudCkgewogICAgICAgIGlmIChrZXlDb2RlID09IEtleUV2ZW50LktFWUNPREVfQkFDSykgewogICAgICAgICAgICBmaW5hbCBWaWV3IHZpc2libGVEcmF3ZXIgPSBmaW5kVmlzaWJsZURyYXdlcigpOwogICAgICAgICAgICBpZiAodmlzaWJsZURyYXdlciAhPSBudWxsICYmIGdldERyYXdlckxvY2tNb2RlKHZpc2libGVEcmF3ZXIpID09IExPQ0tfTU9ERV9VTkxPQ0tFRCkgewogICAgICAgICAgICAgICAgY2xvc2VEcmF3ZXJzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHZpc2libGVEcmF3ZXIgIT0gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cGVyLm9uS2V5VXAoa2V5Q29kZSwgZXZlbnQpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgb25SZXN0b3JlSW5zdGFuY2VTdGF0ZShQYXJjZWxhYmxlIHN0YXRlKSB7CiAgICAgICAgaWYgKCEoc3RhdGUgaW5zdGFuY2VvZiBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5TYXZlZFN0YXRlKSkgewogICAgICAgICAgICBzdXBlci5vblJlc3RvcmVJbnN0YW5jZVN0YXRlKHN0YXRlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuU2F2ZWRTdGF0ZSBzcyA9IChhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5TYXZlZFN0YXRlKSBzdGF0ZTsKICAgICAgICBzdXBlci5vblJlc3RvcmVJbnN0YW5jZVN0YXRlKHNzLmdldFN1cGVyU3RhdGUoKSk7CgogICAgICAgIGlmIChzcy5vcGVuRHJhd2VyR3Jhdml0eSAhPSBHcmF2aXR5Lk5PX0dSQVZJVFkpIHsKICAgICAgICAgICAgZmluYWwgVmlldyB0b09wZW4gPSBmaW5kRHJhd2VyV2l0aEdyYXZpdHkoc3Mub3BlbkRyYXdlckdyYXZpdHkpOwogICAgICAgICAgICBpZiAodG9PcGVuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIG9wZW5EcmF3ZXIodG9PcGVuKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNzLmxvY2tNb2RlTGVmdCAhPSBMT0NLX01PREVfVU5ERUZJTkVEKSB7CiAgICAgICAgICAgIHNldERyYXdlckxvY2tNb2RlKHNzLmxvY2tNb2RlTGVmdCwgR3Jhdml0eS5MRUZUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNzLmxvY2tNb2RlUmlnaHQgIT0gTE9DS19NT0RFX1VOREVGSU5FRCkgewogICAgICAgICAgICBzZXREcmF3ZXJMb2NrTW9kZShzcy5sb2NrTW9kZVJpZ2h0LCBHcmF2aXR5LlJJR0hUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNzLmxvY2tNb2RlU3RhcnQgIT0gTE9DS19NT0RFX1VOREVGSU5FRCkgewogICAgICAgICAgICBzZXREcmF3ZXJMb2NrTW9kZShzcy5sb2NrTW9kZVN0YXJ0LCBHcmF2aXR5Q29tcGF0LlNUQVJUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNzLmxvY2tNb2RlRW5kICE9IExPQ0tfTU9ERV9VTkRFRklORUQpIHsKICAgICAgICAgICAgc2V0RHJhd2VyTG9ja01vZGUoc3MubG9ja01vZGVFbmQsIEdyYXZpdHlDb21wYXQuRU5EKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgUGFyY2VsYWJsZSBvblNhdmVJbnN0YW5jZVN0YXRlKCkgewogICAgICAgIGZpbmFsIFBhcmNlbGFibGUgc3VwZXJTdGF0ZSA9IHN1cGVyLm9uU2F2ZUluc3RhbmNlU3RhdGUoKTsKICAgICAgICBmaW5hbCBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5TYXZlZFN0YXRlIHNzID0gbmV3IGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LlNhdmVkU3RhdGUoc3VwZXJTdGF0ZSk7CgogICAgICAgIGZpbmFsIGludCBjaGlsZENvdW50ID0gZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2hpbGRDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGZpbmFsIFZpZXcgY2hpbGQgPSBnZXRDaGlsZEF0KGkpOwogICAgICAgICAgICBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMgbHAgPSAoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKSBjaGlsZC5nZXRMYXlvdXRQYXJhbXMoKTsKICAgICAgICAgICAgLy8gSXMgdGhlIGN1cnJlbnQgY2hpbGQgZnVsbHkgb3BlbmVkICh0aGF0IGlzLCBub3QgY2xvc2luZyk/CiAgICAgICAgICAgIGJvb2xlYW4gaXNPcGVuZWRBbmROb3RDbG9zaW5nID0gKGxwLm9wZW5TdGF0ZSA9PSBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMuRkxBR19JU19PUEVORUQpOwogICAgICAgICAgICAvLyBJcyB0aGUgY3VycmVudCBjaGlsZCBvcGVuaW5nPwogICAgICAgICAgICBib29sZWFuIGlzQ2xvc2VkQW5kT3BlbmluZyA9IChscC5vcGVuU3RhdGUgPT0gYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zLkZMQUdfSVNfT1BFTklORyk7CiAgICAgICAgICAgIGlmIChpc09wZW5lZEFuZE5vdENsb3NpbmcgfHwgaXNDbG9zZWRBbmRPcGVuaW5nKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBvbmUgb2YgdGhlIGNvbmRpdGlvbnMgYWJvdmUgaG9sZHMsIHNhdmUgdGhlIGNoaWxkJ3MgZ3Jhdml0eQogICAgICAgICAgICAgICAgLy8gc28gdGhhdCB3ZSBvcGVuIHRoYXQgY2hpbGQgZHVyaW5nIHN0YXRlIHJlc3RvcmUuCiAgICAgICAgICAgICAgICBzcy5vcGVuRHJhd2VyR3Jhdml0eSA9IGxwLmdyYXZpdHk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3MubG9ja01vZGVMZWZ0ID0gbUxvY2tNb2RlTGVmdDsKICAgICAgICBzcy5sb2NrTW9kZVJpZ2h0ID0gbUxvY2tNb2RlUmlnaHQ7CiAgICAgICAgc3MubG9ja01vZGVTdGFydCA9IG1Mb2NrTW9kZVN0YXJ0OwogICAgICAgIHNzLmxvY2tNb2RlRW5kID0gbUxvY2tNb2RlRW5kOwoKICAgICAgICByZXR1cm4gc3M7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBhZGRWaWV3KFZpZXcgY2hpbGQsIGludCBpbmRleCwgVmlld0dyb3VwLkxheW91dFBhcmFtcyBwYXJhbXMpIHsKICAgICAgICBzdXBlci5hZGRWaWV3KGNoaWxkLCBpbmRleCwgcGFyYW1zKTsKCiAgICAgICAgZmluYWwgVmlldyBvcGVuRHJhd2VyID0gZmluZE9wZW5EcmF3ZXIoKTsKICAgICAgICBpZiAob3BlbkRyYXdlciAhPSBudWxsIHx8IGlzRHJhd2VyVmlldyhjaGlsZCkpIHsKICAgICAgICAgICAgLy8gQSBkcmF3ZXIgaXMgYWxyZWFkeSBvcGVuIG9yIHRoZSBuZXcgdmlldyBpcyBhIGRyYXdlciwgc28gdGhlCiAgICAgICAgICAgIC8vIG5ldyB2aWV3IHNob3VsZCBzdGFydCBvdXQgaGlkZGVuLgogICAgICAgICAgICBWaWV3Q29tcGF0LnNldEltcG9ydGFudEZvckFjY2Vzc2liaWxpdHkoY2hpbGQsCiAgICAgICAgICAgICAgICAgICAgVmlld0NvbXBhdC5JTVBPUlRBTlRfRk9SX0FDQ0VTU0lCSUxJVFlfTk9fSElERV9ERVNDRU5EQU5UUyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHRoaXMgaXMgYSBjb250ZW50IHZpZXcgYW5kIG5vIGRyYXdlciBpcyBvcGVuLCBzbyB0aGUKICAgICAgICAgICAgLy8gbmV3IHZpZXcgc2hvdWxkIHN0YXJ0IG91dCB2aXNpYmxlLgogICAgICAgICAgICBWaWV3Q29tcGF0LnNldEltcG9ydGFudEZvckFjY2Vzc2liaWxpdHkoY2hpbGQsCiAgICAgICAgICAgICAgICAgICAgVmlld0NvbXBhdC5JTVBPUlRBTlRfRk9SX0FDQ0VTU0lCSUxJVFlfWUVTKTsKICAgICAgICB9CgogICAgICAgIC8vIFdlIG9ubHkgbmVlZCBhIGRlbGVnYXRlIGhlcmUgaWYgdGhlIGZyYW1ld29yayBkb2Vzbid0IHVuZGVyc3RhbmQKICAgICAgICAvLyBOT19ISURFX0RFU0NFTkRBTlRTIGltcG9ydGFuY2UuCiAgICAgICAgaWYgKCFDQU5fSElERV9ERVNDRU5EQU5UUykgewogICAgICAgICAgICBWaWV3Q29tcGF0LnNldEFjY2Vzc2liaWxpdHlEZWxlZ2F0ZShjaGlsZCwgbUNoaWxkQWNjZXNzaWJpbGl0eURlbGVnYXRlKTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGJvb2xlYW4gaW5jbHVkZUNoaWxkRm9yQWNjZXNzaWJpbGl0eShWaWV3IGNoaWxkKSB7CiAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGlzIG5vdCBpbXBvcnRhbnQgZm9yIGFjY2Vzc2liaWxpdHkgd2UgbWFrZQogICAgICAgIC8vIHN1cmUgdGhpcyBoaWRlcyB0aGUgZW50aXJlIHN1YnRyZWUgcm9vdGVkIGF0IGl0IGFzIHRoZQogICAgICAgIC8vIElNUE9SVEFOVF9GT1JfQUNDRVNTSUJJTElUWV9OT19ISURFX0RFU0NFTkRBVFMgaXMgbm90CiAgICAgICAgLy8gc3VwcG9ydGVkIG9uIG9sZGVyIHBsYXRmb3JtcyBidXQgd2Ugd2FudCB0byBoaWRlIHRoZSBlbnRpcmUKICAgICAgICAvLyBjb250ZW50IGFuZCBub3Qgb3BlbmVkIGRyYXdlcnMgaWYgYSBkcmF3ZXIgaXMgb3BlbmVkLgogICAgICAgIHJldHVybiBWaWV3Q29tcGF0LmdldEltcG9ydGFudEZvckFjY2Vzc2liaWxpdHkoY2hpbGQpCiAgICAgICAgICAgICAgICAhPSBWaWV3Q29tcGF0LklNUE9SVEFOVF9GT1JfQUNDRVNTSUJJTElUWV9OT19ISURFX0RFU0NFTkRBTlRTCiAgICAgICAgICAgICAgICAmJiBWaWV3Q29tcGF0LmdldEltcG9ydGFudEZvckFjY2Vzc2liaWxpdHkoY2hpbGQpCiAgICAgICAgICAgICAgICAhPSBWaWV3Q29tcGF0LklNUE9SVEFOVF9GT1JfQUNDRVNTSUJJTElUWV9OTzsKICAgIH0KCiAgICAvKioKICAgICAqIFN0YXRlIHBlcnNpc3RlZCBhY3Jvc3MgaW5zdGFuY2VzCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgU2F2ZWRTdGF0ZSBleHRlbmRzIEFic1NhdmVkU3RhdGUgewogICAgICAgIGludCBvcGVuRHJhd2VyR3Jhdml0eSA9IEdyYXZpdHkuTk9fR1JBVklUWTsKICAgICAgICBATG9ja01vZGUgaW50IGxvY2tNb2RlTGVmdDsKICAgICAgICBATG9ja01vZGUgaW50IGxvY2tNb2RlUmlnaHQ7CiAgICAgICAgQExvY2tNb2RlIGludCBsb2NrTW9kZVN0YXJ0OwogICAgICAgIEBMb2NrTW9kZSBpbnQgbG9ja01vZGVFbmQ7CgogICAgICAgIHB1YmxpYyBTYXZlZFN0YXRlKEBOb25OdWxsIFBhcmNlbCBpbiwgQE51bGxhYmxlIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgICAgICBzdXBlcihpbiwgbG9hZGVyKTsKICAgICAgICAgICAgb3BlbkRyYXdlckdyYXZpdHkgPSBpbi5yZWFkSW50KCk7CiAgICAgICAgICAgIGxvY2tNb2RlTGVmdCA9IGluLnJlYWRJbnQoKTsKICAgICAgICAgICAgbG9ja01vZGVSaWdodCA9IGluLnJlYWRJbnQoKTsKICAgICAgICAgICAgbG9ja01vZGVTdGFydCA9IGluLnJlYWRJbnQoKTsKICAgICAgICAgICAgbG9ja01vZGVFbmQgPSBpbi5yZWFkSW50KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU2F2ZWRTdGF0ZShATm9uTnVsbCBQYXJjZWxhYmxlIHN1cGVyU3RhdGUpIHsKICAgICAgICAgICAgc3VwZXIoc3VwZXJTdGF0ZSk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCB3cml0ZVRvUGFyY2VsKFBhcmNlbCBkZXN0LCBpbnQgZmxhZ3MpIHsKICAgICAgICAgICAgc3VwZXIud3JpdGVUb1BhcmNlbChkZXN0LCBmbGFncyk7CiAgICAgICAgICAgIGRlc3Qud3JpdGVJbnQob3BlbkRyYXdlckdyYXZpdHkpOwogICAgICAgICAgICBkZXN0LndyaXRlSW50KGxvY2tNb2RlTGVmdCk7CiAgICAgICAgICAgIGRlc3Qud3JpdGVJbnQobG9ja01vZGVSaWdodCk7CiAgICAgICAgICAgIGRlc3Qud3JpdGVJbnQobG9ja01vZGVTdGFydCk7CiAgICAgICAgICAgIGRlc3Qud3JpdGVJbnQobG9ja01vZGVFbmQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBDcmVhdG9yPGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LlNhdmVkU3RhdGU+IENSRUFUT1IgPSBuZXcgQ2xhc3NMb2FkZXJDcmVhdG9yPGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LlNhdmVkU3RhdGU+KCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LlNhdmVkU3RhdGUgY3JlYXRlRnJvbVBhcmNlbChQYXJjZWwgaW4sIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5TYXZlZFN0YXRlKGluLCBsb2FkZXIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LlNhdmVkU3RhdGUgY3JlYXRlRnJvbVBhcmNlbChQYXJjZWwgaW4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuU2F2ZWRTdGF0ZShpbiwgbnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuU2F2ZWRTdGF0ZVtdIG5ld0FycmF5KGludCBzaXplKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LlNhdmVkU3RhdGVbc2l6ZV07CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIHByaXZhdGUgY2xhc3MgVmlld0RyYWdDYWxsYmFjayBleHRlbmRzIFZpZXdEcmFnSGVscGVyLkNhbGxiYWNrIHsKICAgICAgICBwcml2YXRlIGZpbmFsIGludCBtQWJzR3Jhdml0eTsKICAgICAgICBwcml2YXRlIFZpZXdEcmFnSGVscGVyIG1EcmFnZ2VyOwoKICAgICAgICBwcml2YXRlIGZpbmFsIFJ1bm5hYmxlIG1QZWVrUnVubmFibGUgPSBuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZSBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICBwZWVrRHJhd2VyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBWaWV3RHJhZ0NhbGxiYWNrKGludCBncmF2aXR5KSB7CiAgICAgICAgICAgIG1BYnNHcmF2aXR5ID0gZ3Jhdml0eTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldERyYWdnZXIoVmlld0RyYWdIZWxwZXIgZHJhZ2dlcikgewogICAgICAgICAgICBtRHJhZ2dlciA9IGRyYWdnZXI7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCByZW1vdmVDYWxsYmFja3MoKSB7CiAgICAgICAgICAgIGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LnRoaXMucmVtb3ZlQ2FsbGJhY2tzKG1QZWVrUnVubmFibGUpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gdHJ5Q2FwdHVyZVZpZXcoVmlldyBjaGlsZCwgaW50IHBvaW50ZXJJZCkgewogICAgICAgICAgICAvLyBPbmx5IGNhcHR1cmUgdmlld3Mgd2hlcmUgdGhlIGdyYXZpdHkgbWF0Y2hlcyB3aGF0IHdlJ3JlIGxvb2tpbmcgZm9yLgogICAgICAgICAgICAvLyBUaGlzIGxldHMgdXMgdXNlIHR3byBWaWV3RHJhZ0hlbHBlcnMsIG9uZSBmb3IgZWFjaCBzaWRlIGRyYXdlci4KICAgICAgICAgICAgcmV0dXJuIGlzRHJhd2VyVmlldyhjaGlsZCkgJiYgY2hlY2tEcmF3ZXJWaWV3QWJzb2x1dGVHcmF2aXR5KGNoaWxkLCBtQWJzR3Jhdml0eSkKICAgICAgICAgICAgICAgICAgICAmJiBnZXREcmF3ZXJMb2NrTW9kZShjaGlsZCkgPT0gTE9DS19NT0RFX1VOTE9DS0VEOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgb25WaWV3RHJhZ1N0YXRlQ2hhbmdlZChpbnQgc3RhdGUpIHsKICAgICAgICAgICAgdXBkYXRlRHJhd2VyU3RhdGUobUFic0dyYXZpdHksIHN0YXRlLCBtRHJhZ2dlci5nZXRDYXB0dXJlZFZpZXcoKSk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvblZpZXdQb3NpdGlvbkNoYW5nZWQoVmlldyBjaGFuZ2VkVmlldywgaW50IGxlZnQsIGludCB0b3AsIGludCBkeCwgaW50IGR5KSB7CiAgICAgICAgICAgIGZsb2F0IG9mZnNldDsKICAgICAgICAgICAgZmluYWwgaW50IGNoaWxkV2lkdGggPSBjaGFuZ2VkVmlldy5nZXRXaWR0aCgpOwoKICAgICAgICAgICAgLy8gVGhpcyByZXZlcnNlcyB0aGUgcG9zaXRpb25pbmcgc2hvd24gaW4gb25MYXlvdXQuCiAgICAgICAgICAgIGlmIChjaGVja0RyYXdlclZpZXdBYnNvbHV0ZUdyYXZpdHkoY2hhbmdlZFZpZXcsIEdyYXZpdHkuTEVGVCkpIHsKICAgICAgICAgICAgICAgIG9mZnNldCA9IChmbG9hdCkgKGNoaWxkV2lkdGggKyBsZWZ0KSAvIGNoaWxkV2lkdGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmaW5hbCBpbnQgd2lkdGggPSBnZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgb2Zmc2V0ID0gKGZsb2F0KSAod2lkdGggLSBsZWZ0KSAvIGNoaWxkV2lkdGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0RHJhd2VyVmlld09mZnNldChjaGFuZ2VkVmlldywgb2Zmc2V0KTsKICAgICAgICAgICAgY2hhbmdlZFZpZXcuc2V0VmlzaWJpbGl0eShvZmZzZXQgPT0gMCA/IElOVklTSUJMRSA6IFZJU0lCTEUpOwogICAgICAgICAgICBpbnZhbGlkYXRlKCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvblZpZXdDYXB0dXJlZChWaWV3IGNhcHR1cmVkQ2hpbGQsIGludCBhY3RpdmVQb2ludGVySWQpIHsKICAgICAgICAgICAgZmluYWwgYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zIGxwID0gKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LkxheW91dFBhcmFtcykgY2FwdHVyZWRDaGlsZC5nZXRMYXlvdXRQYXJhbXMoKTsKICAgICAgICAgICAgbHAuaXNQZWVraW5nID0gZmFsc2U7CgogICAgICAgICAgICBjbG9zZU90aGVyRHJhd2VyKCk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgY2xvc2VPdGhlckRyYXdlcigpIHsKICAgICAgICAgICAgZmluYWwgaW50IG90aGVyR3JhdiA9IG1BYnNHcmF2aXR5ID09IEdyYXZpdHkuTEVGVCA/IEdyYXZpdHkuUklHSFQgOiBHcmF2aXR5LkxFRlQ7CiAgICAgICAgICAgIGZpbmFsIFZpZXcgdG9DbG9zZSA9IGZpbmREcmF3ZXJXaXRoR3Jhdml0eShvdGhlckdyYXYpOwogICAgICAgICAgICBpZiAodG9DbG9zZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBjbG9zZURyYXdlcih0b0Nsb3NlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgb25WaWV3UmVsZWFzZWQoVmlldyByZWxlYXNlZENoaWxkLCBmbG9hdCB4dmVsLCBmbG9hdCB5dmVsKSB7CiAgICAgICAgICAgIC8vIE9mZnNldCBpcyBob3cgb3BlbiB0aGUgZHJhd2VyIGlzLCB0aGVyZWZvcmUgbGVmdC9yaWdodCB2YWx1ZXMKICAgICAgICAgICAgLy8gYXJlIHJldmVyc2VkIGZyb20gb25lIGFub3RoZXIuCiAgICAgICAgICAgIGZpbmFsIGZsb2F0IG9mZnNldCA9IGdldERyYXdlclZpZXdPZmZzZXQocmVsZWFzZWRDaGlsZCk7CiAgICAgICAgICAgIGZpbmFsIGludCBjaGlsZFdpZHRoID0gcmVsZWFzZWRDaGlsZC5nZXRXaWR0aCgpOwoKICAgICAgICAgICAgaW50IGxlZnQ7CiAgICAgICAgICAgIGlmIChjaGVja0RyYXdlclZpZXdBYnNvbHV0ZUdyYXZpdHkocmVsZWFzZWRDaGlsZCwgR3Jhdml0eS5MRUZUKSkgewogICAgICAgICAgICAgICAgbGVmdCA9IHh2ZWwgPiAwIHx8ICh4dmVsID09IDAgJiYgb2Zmc2V0ID4gMC41ZikgPyAwIDogLWNoaWxkV2lkdGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmaW5hbCBpbnQgd2lkdGggPSBnZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgbGVmdCA9IHh2ZWwgPCAwIHx8ICh4dmVsID09IDAgJiYgb2Zmc2V0ID4gMC41ZikgPyB3aWR0aCAtIGNoaWxkV2lkdGggOiB3aWR0aDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbURyYWdnZXIuc2V0dGxlQ2FwdHVyZWRWaWV3QXQobGVmdCwgcmVsZWFzZWRDaGlsZC5nZXRUb3AoKSk7CiAgICAgICAgICAgIGludmFsaWRhdGUoKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9uRWRnZVRvdWNoZWQoaW50IGVkZ2VGbGFncywgaW50IHBvaW50ZXJJZCkgewogICAgICAgICAgICBwb3N0RGVsYXllZChtUGVla1J1bm5hYmxlLCBQRUVLX0RFTEFZKTsKICAgICAgICB9CgogICAgICAgIHZvaWQgcGVla0RyYXdlcigpIHsKICAgICAgICAgICAgZmluYWwgVmlldyB0b0NhcHR1cmU7CiAgICAgICAgICAgIGZpbmFsIGludCBjaGlsZExlZnQ7CiAgICAgICAgICAgIGZpbmFsIGludCBwZWVrRGlzdGFuY2UgPSBtRHJhZ2dlci5nZXRFZGdlU2l6ZSgpOwogICAgICAgICAgICBmaW5hbCBib29sZWFuIGxlZnRFZGdlID0gbUFic0dyYXZpdHkgPT0gR3Jhdml0eS5MRUZUOwogICAgICAgICAgICBpZiAobGVmdEVkZ2UpIHsKICAgICAgICAgICAgICAgIHRvQ2FwdHVyZSA9IGZpbmREcmF3ZXJXaXRoR3Jhdml0eShHcmF2aXR5LkxFRlQpOwogICAgICAgICAgICAgICAgY2hpbGRMZWZ0ID0gKHRvQ2FwdHVyZSAhPSBudWxsID8gLXRvQ2FwdHVyZS5nZXRXaWR0aCgpIDogMCkgKyBwZWVrRGlzdGFuY2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b0NhcHR1cmUgPSBmaW5kRHJhd2VyV2l0aEdyYXZpdHkoR3Jhdml0eS5SSUdIVCk7CiAgICAgICAgICAgICAgICBjaGlsZExlZnQgPSBnZXRXaWR0aCgpIC0gcGVla0Rpc3RhbmNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIE9ubHkgcGVlayBpZiBpdCB3b3VsZCBtZWFuIG1ha2luZyB0aGUgZHJhd2VyIG1vcmUgdmlzaWJsZSBhbmQgdGhlIGRyYXdlciBpc24ndCBsb2NrZWQKICAgICAgICAgICAgaWYgKHRvQ2FwdHVyZSAhPSBudWxsICYmICgobGVmdEVkZ2UgJiYgdG9DYXB0dXJlLmdldExlZnQoKSA8IGNoaWxkTGVmdCkKICAgICAgICAgICAgICAgICAgICB8fCAoIWxlZnRFZGdlICYmIHRvQ2FwdHVyZS5nZXRMZWZ0KCkgPiBjaGlsZExlZnQpKQogICAgICAgICAgICAgICAgICAgICYmIGdldERyYXdlckxvY2tNb2RlKHRvQ2FwdHVyZSkgPT0gTE9DS19NT0RFX1VOTE9DS0VEKSB7CiAgICAgICAgICAgICAgICBmaW5hbCBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMgbHAgPSAoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuTGF5b3V0UGFyYW1zKSB0b0NhcHR1cmUuZ2V0TGF5b3V0UGFyYW1zKCk7CiAgICAgICAgICAgICAgICBtRHJhZ2dlci5zbW9vdGhTbGlkZVZpZXdUbyh0b0NhcHR1cmUsIGNoaWxkTGVmdCwgdG9DYXB0dXJlLmdldFRvcCgpKTsKICAgICAgICAgICAgICAgIGxwLmlzUGVla2luZyA9IHRydWU7CiAgICAgICAgICAgICAgICBpbnZhbGlkYXRlKCk7CgogICAgICAgICAgICAgICAgY2xvc2VPdGhlckRyYXdlcigpOwoKICAgICAgICAgICAgICAgIGNhbmNlbENoaWxkVmlld1RvdWNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIG9uRWRnZUxvY2soaW50IGVkZ2VGbGFncykgewogICAgICAgICAgICBpZiAoQUxMT1dfRURHRV9MT0NLKSB7CiAgICAgICAgICAgICAgICBmaW5hbCBWaWV3IGRyYXdlciA9IGZpbmREcmF3ZXJXaXRoR3Jhdml0eShtQWJzR3Jhdml0eSk7CiAgICAgICAgICAgICAgICBpZiAoZHJhd2VyICE9IG51bGwgJiYgIWlzRHJhd2VyT3BlbihkcmF3ZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgY2xvc2VEcmF3ZXIoZHJhd2VyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9uRWRnZURyYWdTdGFydGVkKGludCBlZGdlRmxhZ3MsIGludCBwb2ludGVySWQpIHsKICAgICAgICAgICAgZmluYWwgVmlldyB0b0NhcHR1cmU7CiAgICAgICAgICAgIGlmICgoZWRnZUZsYWdzICYgVmlld0RyYWdIZWxwZXIuRURHRV9MRUZUKSA9PSBWaWV3RHJhZ0hlbHBlci5FREdFX0xFRlQpIHsKICAgICAgICAgICAgICAgIHRvQ2FwdHVyZSA9IGZpbmREcmF3ZXJXaXRoR3Jhdml0eShHcmF2aXR5LkxFRlQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdG9DYXB0dXJlID0gZmluZERyYXdlcldpdGhHcmF2aXR5KEdyYXZpdHkuUklHSFQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodG9DYXB0dXJlICE9IG51bGwgJiYgZ2V0RHJhd2VyTG9ja01vZGUodG9DYXB0dXJlKSA9PSBMT0NLX01PREVfVU5MT0NLRUQpIHsKICAgICAgICAgICAgICAgIG1EcmFnZ2VyLmNhcHR1cmVDaGlsZFZpZXcodG9DYXB0dXJlLCBwb2ludGVySWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgaW50IGdldFZpZXdIb3Jpem9udGFsRHJhZ1JhbmdlKFZpZXcgY2hpbGQpIHsKICAgICAgICAgICAgcmV0dXJuIGlzRHJhd2VyVmlldyhjaGlsZCkgPyBjaGlsZC5nZXRXaWR0aCgpIDogMDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBpbnQgY2xhbXBWaWV3UG9zaXRpb25Ib3Jpem9udGFsKFZpZXcgY2hpbGQsIGludCBsZWZ0LCBpbnQgZHgpIHsKICAgICAgICAgICAgaWYgKGNoZWNrRHJhd2VyVmlld0Fic29sdXRlR3Jhdml0eShjaGlsZCwgR3Jhdml0eS5MRUZUKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KC1jaGlsZC5nZXRXaWR0aCgpLCBNYXRoLm1pbihsZWZ0LCAwKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmaW5hbCBpbnQgd2lkdGggPSBnZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KHdpZHRoIC0gY2hpbGQuZ2V0V2lkdGgoKSwgTWF0aC5taW4obGVmdCwgd2lkdGgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGludCBjbGFtcFZpZXdQb3NpdGlvblZlcnRpY2FsKFZpZXcgY2hpbGQsIGludCB0b3AsIGludCBkeSkgewogICAgICAgICAgICByZXR1cm4gY2hpbGQuZ2V0VG9wKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgTGF5b3V0UGFyYW1zIGV4dGVuZHMgVmlld0dyb3VwLk1hcmdpbkxheW91dFBhcmFtcyB7CiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfSVNfT1BFTkVEID0gMHgxOwogICAgICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0lTX09QRU5JTkcgPSAweDI7CiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfSVNfQ0xPU0lORyA9IDB4NDsKCiAgICAgICAgcHVibGljIGludCBncmF2aXR5ID0gR3Jhdml0eS5OT19HUkFWSVRZOwogICAgICAgIGZsb2F0IG9uU2NyZWVuOwogICAgICAgIGJvb2xlYW4gaXNQZWVraW5nOwogICAgICAgIGludCBvcGVuU3RhdGU7CgogICAgICAgIHB1YmxpYyBMYXlvdXRQYXJhbXMoQE5vbk51bGwgQ29udGV4dCBjLCBATnVsbGFibGUgQXR0cmlidXRlU2V0IGF0dHJzKSB7CiAgICAgICAgICAgIHN1cGVyKGMsIGF0dHJzKTsKCiAgICAgICAgICAgIGZpbmFsIFR5cGVkQXJyYXkgYSA9IGMub2J0YWluU3R5bGVkQXR0cmlidXRlcyhhdHRycywgTEFZT1VUX0FUVFJTKTsKICAgICAgICAgICAgdGhpcy5ncmF2aXR5ID0gYS5nZXRJbnQoMCwgR3Jhdml0eS5OT19HUkFWSVRZKTsKICAgICAgICAgICAgYS5yZWN5Y2xlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTGF5b3V0UGFyYW1zKGludCB3aWR0aCwgaW50IGhlaWdodCkgewogICAgICAgICAgICBzdXBlcih3aWR0aCwgaGVpZ2h0KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBMYXlvdXRQYXJhbXMoaW50IHdpZHRoLCBpbnQgaGVpZ2h0LCBpbnQgZ3Jhdml0eSkgewogICAgICAgICAgICB0aGlzKHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICB0aGlzLmdyYXZpdHkgPSBncmF2aXR5OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIExheW91dFBhcmFtcyhATm9uTnVsbCBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0LkRyYXdlckxheW91dC5MYXlvdXRQYXJhbXMgc291cmNlKSB7CiAgICAgICAgICAgIHN1cGVyKHNvdXJjZSk7CiAgICAgICAgICAgIHRoaXMuZ3Jhdml0eSA9IHNvdXJjZS5ncmF2aXR5OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIExheW91dFBhcmFtcyhATm9uTnVsbCBWaWV3R3JvdXAuTGF5b3V0UGFyYW1zIHNvdXJjZSkgewogICAgICAgICAgICBzdXBlcihzb3VyY2UpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIExheW91dFBhcmFtcyhATm9uTnVsbCBWaWV3R3JvdXAuTWFyZ2luTGF5b3V0UGFyYW1zIHNvdXJjZSkgewogICAgICAgICAgICBzdXBlcihzb3VyY2UpOwogICAgICAgIH0KICAgIH0KCiAgICBjbGFzcyBBY2Nlc3NpYmlsaXR5RGVsZWdhdGUgZXh0ZW5kcyBBY2Nlc3NpYmlsaXR5RGVsZWdhdGVDb21wYXQgewogICAgICAgIHByaXZhdGUgZmluYWwgUmVjdCBtVG1wUmVjdCA9IG5ldyBSZWN0KCk7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9uSW5pdGlhbGl6ZUFjY2Vzc2liaWxpdHlOb2RlSW5mbyhWaWV3IGhvc3QsIEFjY2Vzc2liaWxpdHlOb2RlSW5mb0NvbXBhdCBpbmZvKSB7CiAgICAgICAgICAgIGlmIChDQU5fSElERV9ERVNDRU5EQU5UUykgewogICAgICAgICAgICAgICAgc3VwZXIub25Jbml0aWFsaXplQWNjZXNzaWJpbGl0eU5vZGVJbmZvKGhvc3QsIGluZm8pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gT2J0YWluIGEgbm9kZSBmb3IgdGhlIGhvc3QsIHRoZW4gbWFudWFsbHkgZ2VuZXJhdGUgdGhlIGxpc3QKICAgICAgICAgICAgICAgIC8vIG9mIGNoaWxkcmVuIHRvIG9ubHkgaW5jbHVkZSBub24tb2JzY3VyZWQgdmlld3MuCiAgICAgICAgICAgICAgICBmaW5hbCBBY2Nlc3NpYmlsaXR5Tm9kZUluZm9Db21wYXQgc3VwZXJOb2RlID0KICAgICAgICAgICAgICAgICAgICAgICAgQWNjZXNzaWJpbGl0eU5vZGVJbmZvQ29tcGF0Lm9idGFpbihpbmZvKTsKICAgICAgICAgICAgICAgIHN1cGVyLm9uSW5pdGlhbGl6ZUFjY2Vzc2liaWxpdHlOb2RlSW5mbyhob3N0LCBzdXBlck5vZGUpOwoKICAgICAgICAgICAgICAgIGluZm8uc2V0U291cmNlKGhvc3QpOwogICAgICAgICAgICAgICAgZmluYWwgVmlld1BhcmVudCBwYXJlbnQgPSBWaWV3Q29tcGF0LmdldFBhcmVudEZvckFjY2Vzc2liaWxpdHkoaG9zdCk7CiAgICAgICAgICAgICAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgVmlldykgewogICAgICAgICAgICAgICAgICAgIGluZm8uc2V0UGFyZW50KChWaWV3KSBwYXJlbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29weU5vZGVJbmZvTm9DaGlsZHJlbihpbmZvLCBzdXBlck5vZGUpOwogICAgICAgICAgICAgICAgc3VwZXJOb2RlLnJlY3ljbGUoKTsKCiAgICAgICAgICAgICAgICBhZGRDaGlsZHJlbkZvckFjY2Vzc2liaWxpdHkoaW5mbywgKFZpZXdHcm91cCkgaG9zdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGluZm8uc2V0Q2xhc3NOYW1lKGFuZHJvaWR4LmRyYXdlcmxheW91dC53aWRnZXQuRHJhd2VyTGF5b3V0LmNsYXNzLmdldE5hbWUoKSk7CgogICAgICAgICAgICAvLyBUaGlzIHZpZXcgcmVwb3J0cyBpdHNlbGYgYXMgZm9jdXNhYmxlIHNvIHRoYXQgaXQgY2FuIGludGVyY2VwdAogICAgICAgICAgICAvLyB0aGUgYmFjayBidXR0b24sIGJ1dCB3ZSBzaG91bGQgcHJldmVudCB0aGlzIHZpZXcgZnJvbSByZXBvcnRpbmcKICAgICAgICAgICAgLy8gaXRzZWxmIGFzIGZvY3VzYWJsZSB0byBhY2Nlc3NpYmlsaXR5IHNlcnZpY2VzLgogICAgICAgICAgICBpbmZvLnNldEZvY3VzYWJsZShmYWxzZSk7CiAgICAgICAgICAgIGluZm8uc2V0Rm9jdXNlZChmYWxzZSk7CiAgICAgICAgICAgIGluZm8ucmVtb3ZlQWN0aW9uKEFjY2Vzc2liaWxpdHlBY3Rpb25Db21wYXQuQUNUSU9OX0ZPQ1VTKTsKICAgICAgICAgICAgaW5mby5yZW1vdmVBY3Rpb24oQWNjZXNzaWJpbGl0eUFjdGlvbkNvbXBhdC5BQ1RJT05fQ0xFQVJfRk9DVVMpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgb25Jbml0aWFsaXplQWNjZXNzaWJpbGl0eUV2ZW50KFZpZXcgaG9zdCwgQWNjZXNzaWJpbGl0eUV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAgIHN1cGVyLm9uSW5pdGlhbGl6ZUFjY2Vzc2liaWxpdHlFdmVudChob3N0LCBldmVudCk7CgogICAgICAgICAgICBldmVudC5zZXRDbGFzc05hbWUoYW5kcm9pZHguZHJhd2VybGF5b3V0LndpZGdldC5EcmF3ZXJMYXlvdXQuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIGRpc3BhdGNoUG9wdWxhdGVBY2Nlc3NpYmlsaXR5RXZlbnQoVmlldyBob3N0LCBBY2Nlc3NpYmlsaXR5RXZlbnQgZXZlbnQpIHsKICAgICAgICAgICAgLy8gU3BlY2lhbCBjYXNlIHRvIGhhbmRsZSB3aW5kb3cgc3RhdGUgY2hhbmdlIGV2ZW50cy4gQXMgZmFyIGFzCiAgICAgICAgICAgIC8vIGFjY2Vzc2liaWxpdHkgc2VydmljZXMgYXJlIGNvbmNlcm5lZCwgc3RhdGUgY2hhbmdlcyBmcm9tCiAgICAgICAgICAgIC8vIERyYXdlckxheW91dCBpbnZhbGlkYXRlIHRoZSBlbnRpcmUgY29udGVudHMgb2YgdGhlIHNjcmVlbiAobGlrZQogICAgICAgICAgICAvLyBhbiBBY3Rpdml0eSBvciBEaWFsb2cpIGFuZCB0aGV5IHNob3VsZCBhbm5vdW5jZSB0aGUgdGl0bGUgb2YgdGhlCiAgICAgICAgICAgIC8vIG5ldyBjb250ZW50LgogICAgICAgICAgICBpZiAoZXZlbnQuZ2V0RXZlbnRUeXBlKCkgPT0gQWNjZXNzaWJpbGl0eUV2ZW50LlRZUEVfV0lORE9XX1NUQVRFX0NIQU5HRUQpIHsKICAgICAgICAgICAgICAgIGZpbmFsIExpc3Q8Q2hhclNlcXVlbmNlPiBldmVudFRleHQgPSBldmVudC5nZXRUZXh0KCk7CiAgICAgICAgICAgICAgICBmaW5hbCBWaWV3IHZpc2libGVEcmF3ZXIgPSBmaW5kVmlzaWJsZURyYXdlcigpOwogICAgICAgICAgICAgICAgaWYgKHZpc2libGVEcmF3ZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGZpbmFsIGludCBlZGdlR3Jhdml0eSA9IGdldERyYXdlclZpZXdBYnNvbHV0ZUdyYXZpdHkodmlzaWJsZURyYXdlcik7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgQ2hhclNlcXVlbmNlIHRpdGxlID0gZ2V0RHJhd2VyVGl0bGUoZWRnZUdyYXZpdHkpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aXRsZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50VGV4dC5hZGQodGl0bGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmRpc3BhdGNoUG9wdWxhdGVBY2Nlc3NpYmlsaXR5RXZlbnQoaG9zdCwgZXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gb25SZXF1ZXN0U2VuZEFjY2Vzc2liaWxpdHlFdmVudChWaWV3R3JvdXAgaG9zdCwgVmlldyBjaGlsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjY2Vzc2liaWxpdHlFdmVudCBldmVudCkgewogICAgICAgICAgICBpZiAoQ0FOX0hJREVfREVTQ0VOREFOVFMgfHwgaW5jbHVkZUNoaWxkRm9yQWNjZXNzaWJpbGl0eShjaGlsZCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5vblJlcXVlc3RTZW5kQWNjZXNzaWJpbGl0eUV2ZW50KGhvc3QsIGNoaWxkLCBldmVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGFkZENoaWxkcmVuRm9yQWNjZXNzaWJpbGl0eShBY2Nlc3NpYmlsaXR5Tm9kZUluZm9Db21wYXQgaW5mbywgVmlld0dyb3VwIHYpIHsKICAgICAgICAgICAgZmluYWwgaW50IGNoaWxkQ291bnQgPSB2LmdldENoaWxkQ291bnQoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjaGlsZENvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIGZpbmFsIFZpZXcgY2hpbGQgPSB2LmdldENoaWxkQXQoaSk7CiAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZUNoaWxkRm9yQWNjZXNzaWJpbGl0eShjaGlsZCkpIHsKICAgICAgICAgICAgICAgICAgICBpbmZvLmFkZENoaWxkKGNoaWxkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogVGhpcyBzaG91bGQgcmVhbGx5IGJlIGluIEFjY2Vzc2liaWxpdHlOb2RlSW5mb0NvbXBhdCwgYnV0IHRoZXJlIHVuZm9ydHVuYXRlbHkKICAgICAgICAgKiBzZWVtIHRvIGJlIGEgZmV3IGVsZW1lbnRzIHRoYXQgYXJlIG5vdCBlYXNpbHkgY2xvbmVhYmxlIHVzaW5nIHRoZSB1bmRlcmx5aW5nIEFQSS4KICAgICAgICAgKiBMZWF2ZSBpdCBwcml2YXRlIGhlcmUgYXMgaXQncyBub3QgZ2VuZXJhbC1wdXJwb3NlIHVzZWZ1bC4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgY29weU5vZGVJbmZvTm9DaGlsZHJlbihBY2Nlc3NpYmlsaXR5Tm9kZUluZm9Db21wYXQgZGVzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBY2Nlc3NpYmlsaXR5Tm9kZUluZm9Db21wYXQgc3JjKSB7CiAgICAgICAgICAgIGZpbmFsIFJlY3QgcmVjdCA9IG1UbXBSZWN0OwoKICAgICAgICAgICAgc3JjLmdldEJvdW5kc0luUGFyZW50KHJlY3QpOwogICAgICAgICAgICBkZXN0LnNldEJvdW5kc0luUGFyZW50KHJlY3QpOwoKICAgICAgICAgICAgc3JjLmdldEJvdW5kc0luU2NyZWVuKHJlY3QpOwogICAgICAgICAgICBkZXN0LnNldEJvdW5kc0luU2NyZWVuKHJlY3QpOwoKICAgICAgICAgICAgZGVzdC5zZXRWaXNpYmxlVG9Vc2VyKHNyYy5pc1Zpc2libGVUb1VzZXIoKSk7CiAgICAgICAgICAgIGRlc3Quc2V0UGFja2FnZU5hbWUoc3JjLmdldFBhY2thZ2VOYW1lKCkpOwogICAgICAgICAgICBkZXN0LnNldENsYXNzTmFtZShzcmMuZ2V0Q2xhc3NOYW1lKCkpOwogICAgICAgICAgICBkZXN0LnNldENvbnRlbnREZXNjcmlwdGlvbihzcmMuZ2V0Q29udGVudERlc2NyaXB0aW9uKCkpOwoKICAgICAgICAgICAgZGVzdC5zZXRFbmFibGVkKHNyYy5pc0VuYWJsZWQoKSk7CiAgICAgICAgICAgIGRlc3Quc2V0Q2xpY2thYmxlKHNyYy5pc0NsaWNrYWJsZSgpKTsKICAgICAgICAgICAgZGVzdC5zZXRGb2N1c2FibGUoc3JjLmlzRm9jdXNhYmxlKCkpOwogICAgICAgICAgICBkZXN0LnNldEZvY3VzZWQoc3JjLmlzRm9jdXNlZCgpKTsKICAgICAgICAgICAgZGVzdC5zZXRBY2Nlc3NpYmlsaXR5Rm9jdXNlZChzcmMuaXNBY2Nlc3NpYmlsaXR5Rm9jdXNlZCgpKTsKICAgICAgICAgICAgZGVzdC5zZXRTZWxlY3RlZChzcmMuaXNTZWxlY3RlZCgpKTsKICAgICAgICAgICAgZGVzdC5zZXRMb25nQ2xpY2thYmxlKHNyYy5pc0xvbmdDbGlja2FibGUoKSk7CgogICAgICAgICAgICBkZXN0LmFkZEFjdGlvbihzcmMuZ2V0QWN0aW9ucygpKTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGZpbmFsIGNsYXNzIENoaWxkQWNjZXNzaWJpbGl0eURlbGVnYXRlIGV4dGVuZHMgQWNjZXNzaWJpbGl0eURlbGVnYXRlQ29tcGF0IHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvbkluaXRpYWxpemVBY2Nlc3NpYmlsaXR5Tm9kZUluZm8oVmlldyBjaGlsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWNjZXNzaWJpbGl0eU5vZGVJbmZvQ29tcGF0IGluZm8pIHsKICAgICAgICAgICAgc3VwZXIub25Jbml0aWFsaXplQWNjZXNzaWJpbGl0eU5vZGVJbmZvKGNoaWxkLCBpbmZvKTsKCiAgICAgICAgICAgIGlmICghaW5jbHVkZUNoaWxkRm9yQWNjZXNzaWJpbGl0eShjaGlsZCkpIHsKICAgICAgICAgICAgICAgIC8vIElmIHdlIGFyZSBpZ25vcmluZyB0aGUgc3ViLXRyZWUgcm9vdGVkIGF0IHRoZSBjaGlsZCwKICAgICAgICAgICAgICAgIC8vIGJyZWFrIHRoZSBjb25uZWN0aW9uIHRvIHRoZSByZXN0IG9mIHRoZSBub2RlIHRyZWUuCiAgICAgICAgICAgICAgICAvLyBGb3IgZGV0YWlscyByZWZlciB0byBpbmNsdWRlQ2hpbGRGb3JBY2Nlc3NpYmlsaXR5LgogICAgICAgICAgICAgICAgaW5mby5zZXRQYXJlbnQobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0K</text>
      </register>
      <register name="w" type="4">
        <text />
      </register>
      <register name="8" type="2">
        <text encoding="base64">cGFja2FnZSBhbmRyb2lkeC5kcmF3ZXJsYXlvdXQud2lkZ2V0Owo=</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">Cg==</text>
      </register>
      <register name=":" type="4">
        <text>'a,'bs/[ ]*\(.*\)\(deps.*\)/    println(&quot;\1'${\2}'&quot;)/</text>
      </register>
    </registers>
    <search>
      <last-search>activity</last-search>
      <last-offset />
      <last-pattern>activity</last-pattern>
      <last-replace encoding="base64">ICAgIHByaW50bG4oIlwxJyR7XDJ9JyIp</last-replace>
      <last-substitute>[ ]*\(.*\)\(deps.*\)</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>item</entry>
        <entry>prin</entry>
        <entry>Timber</entry>
        <entry>print</entry>
        <entry>ailure</entry>
        <entry>error</entry>
        <entry encoding="base64">XDxmdW5cPg==</entry>
        <entry>context</entry>
        <entry>nullOffset</entry>
        <entry>getCurr</entry>
        <entry>anko</entry>
        <entry encoding="base64">cmV0dXJuIA==</entry>
        <entry>values</entry>
        <entry>lega</entry>
        <entry>Logging</entry>
        <entry>Loggin</entry>
        <entry>Regex</entry>
        <entry>Switch</entry>
        <entry>androidx</entry>
        <entry>activity</entry>
      </history-search>
      <history-cmd>
        <entry>%s/&quot;/\\&quot;/</entry>
        <entry>s/&quot;/\\&quot;/g</entry>
        <entry>W</entry>
        <entry>%s/Delay/Variance</entry>
        <entry>set ic</entry>
        <entry>q!</entry>
        <entry>%s/&quot;$/&quot;,/g</entry>
        <entry>'a,'bs%/imp/hello/</entry>
        <entry>'a,'bs/imp/xxx/g</entry>
        <entry>'a,'bs/deps.*$/${\0}/</entry>
        <entry>'a,'bs/\(^[ ]*\)\(.*\)/\1println(&quot;\2&quot;)/</entry>
        <entry>'a,'bs/\$/'/</entry>
        <entry>'a,'bs/\$/'$/</entry>
        <entry>'a,'bs/&quot;)/'&quot;)/</entry>
        <entry>'a,'bs/'/\\'/</entry>
        <entry>'a,'bs/'/\\'/g</entry>
        <entry>'a,'bs/\\//g</entry>
        <entry>w</entry>
        <entry>'a,'bs/[ ]*\(.*\)\(deps.*\)/    println(&quot;\1'${\2}'&quot;)/</entry>
        <entry>anko</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed B</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed X</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed M</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>shift ctrl pressed 2</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed Y</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed O</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed E</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed OPEN_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed Q</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed 2</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed G</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed H</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed CLOSE_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>shift ctrl pressed 6</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed T</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed I</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>